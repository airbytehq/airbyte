plugins {
    id "org.openapi.generator" version "4.3.0"
    id "java-library"
}

def specFile = "$projectDir/src/main/openapi/config.yaml".toString()

openApiGenerate {
    generatorName = "jaxrs-spec"
    inputSpec = specFile
    outputDir = "$buildDir/generated"

    apiPackage = "io.dataline.api"
    invokerPackage = "io.dataline.api.invoker"
    modelPackage = "io.dataline.api.model"

    importMappings = [
        'SourceSpecification' : 'com.fasterxml.jackson.databind.JsonNode',
        'SourceConfiguration' : 'com.fasterxml.jackson.databind.JsonNode',
        'DestinationSpecification' : 'com.fasterxml.jackson.databind.JsonNode',
        'DestinationConfiguration' : 'com.fasterxml.jackson.databind.JsonNode',
    ]

    generateApiDocumentation = false

    configOptions = [
            dateLibrary  : "java8",
            generatePom  : "false",
            interfaceOnly: "true"
    ]
}

dependencies {
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-annotations'
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind'

    implementation group: 'io.swagger', name: 'swagger-annotations', version: '1.6.2'

    implementation group: 'javax.annotation', name: 'javax.annotation-api', version: '1.3.2'
    implementation group: 'javax.ws.rs', name: 'javax.ws.rs-api', version: '2.1.1'
    implementation group: 'javax.validation', name: 'validation-api', version: '2.0.1.Final'
}

sourceSets {
    main {
        java {
            srcDir "$buildDir/generated/src/gen/java"
        }
        resources {
            srcDir "$projectDir/src/main/openapi/"
        }
    }
}

compileJava.dependsOn tasks.openApiGenerate
