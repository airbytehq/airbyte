name: Connectors up-to-date

on:
  schedule:
    # Runs everyday at 12:00 UTC
    - cron: "0 12 * * *"
  workflow_dispatch:
    inputs:
      connectors-options:
        description: "Options to pass to the 'airbyte-ci connectors' command group."
        default: "--concurrency=1 --language=python --language=low-code"
jobs:
  connectors_up_to_date:
    name: Connectors up-to-date
    runs-on: connector-nightly-xlarge
    permissions:
      pull-requests: write
    timeout-minutes: 1440 # 24 hours
    steps:
      - name: Checkout Airbyte
        uses: actions/checkout@v4
      - name: Run airbyte-ci connectors up-to-date
        id: airbyte-ci-connectors-up-to-date
        uses: ./.github/actions/run-airbyte-ci
        with:
          context: "master"
          dagger_cloud_token: ${{ secrets.DAGGER_CLOUD_TOKEN_2 }}
          docker_hub_password: ${{ secrets.DOCKER_HUB_PASSWORD }}
          docker_hub_username: ${{ secrets.DOCKER_HUB_USERNAME }}
          gcp_gsm_credentials: ${{ secrets.GCP_GSM_CREDENTIALS }}
          gcs_credentials: ${{ secrets.METADATA_SERVICE_PROD_GCS_CREDENTIALS }}
          github_token: ${{ secrets.AUTO_MERGE_GITHUB_TOKEN }}
          sentry_dsn: ${{ secrets.SENTRY_AIRBYTE_CI_DSN }}
          s3_build_cache_access_key_id: ${{ secrets.SELF_RUNNER_AWS_ACCESS_KEY_ID }}
          s3_build_cache_secret_key: ${{ secrets.SELF_RUNNER_AWS_SECRET_ACCESS_KEY }}
          subcommand: "connectors  ${{ github.event.inputs.connectors-options || '--concurrency=1 --language=python --language=low-code' }} up-to-date --create-prs"
