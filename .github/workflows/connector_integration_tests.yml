name: Connector Integration Tests

on:
  workflow_dispatch:
  schedule:
    # 11am UTC is 4am PDT.
    - cron: '0 11 * * *'

jobs:
  launch_integration_tests:
    timeout-minutes: 30
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master'
    steps:
      - name: Checkout Airbyte
        uses: actions/checkout@v2
      - name: Install Java
        uses: actions/setup-java@v1
        with:
          java-version: '17'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install PyYAML requests
      - name: Launch Integration Tests
        run: python ./tools/bin/ci_integration_workflow_launcher.py base-normalization source-acceptance-test source:beta source:GA destination:beta destination:GA
        env:
          GITHUB_TOKEN: ${{ secrets.SLASH_COMMAND_PAT }}
