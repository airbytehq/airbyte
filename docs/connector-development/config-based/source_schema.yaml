---
"$schema": http://json-schema.org/draft-07/schema#
"$id": https://github.com/airbytehq/airbyte/blob/master/airbyte-protocol/models/src/main/resources/airbyte_protocol/connector_builder.yaml #TODO
title: Connector Builder #TODO
type: object
description: Connector Builder structs #TODO
properties:
  version:
    "$ref": "#/definitions/Version"
  streams:
    "$ref": "#/definitions/Streams"
  check:
    "$ref": "#/definitions/ConnectionChecker"
definitions:
  "$options":
    type: object
    additionalProperties: true
  ConnectionChecker:
    type: object
    oneOf:
      - "$ref": "#/definitions/CheckStream"
  CheckStream:
    type: object
    additionalProperties: false
    required:
      - stream_names
    properties:
      "$options":
        "$ref": "#/definitions/$options"
      stream_names:
        type: array
        items:
          type: string
  Version:
    type: string
    description: "connector definition version"
  Streams:
    type: array
    items:
      "$ref": "#/definitions/Stream"
  Stream:
    type: object
    additionalProperties: false
    required:
      - name
      - retriever
    properties:
      "$options":
        "$ref": "#/definitions/$options"
      name:
        type: string
      primary_key:
        "$ref": "#/definitions/PrimaryKey"
      retriever:
        "$ref": "#/definitions/Retriever"
      stream_cursor_field:
        type: object
        oneOf:
          - type: string
          - type: array
            items:
              type: string
      transformations:
        type: array
        items:
          "$ref": "#/definitions/RecordTransformation"
      checkpoint_interval:
        type: integer
    PrimaryKey:
      type: object
      oneOf:
        - string
        - type: array
          items:
            type: string
        - type: array
          items:
            type: array
            items:
              type: string
    Retriever:
      type:
      oneOf:
        - "$ref": "#/definitions/SimpleRetriever"
    SimpleRetriever:
      type: object
      additionalProperties: false
      required:
        - name
        - primary_key
        - requester
        - record_selector
        - stream_slicer
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        name:
          type: string
        primary_key:
          "$ref": "#/definitions/PrimaryKey"
        requester:
          "$ref": "#/definitions/Requester"
        record_selector:
          "$ref": "#/definitions/HttpSelector"
        paginator:
          "$ref": "#/definitions/Paginator"
        stream_slicer:
          "$ref": "#/definitions/StreamSlicer"
    Requester:
      type: object
      oneOf:
        - "$ref": "#/definitions/HttpRequester"
    HttpRequester:
      type: object
      additionalProperties: false
      required:
        - name
        - url_base
        - path
        - http_method
        - request_options_provider
        - authenticator
        - error_handler
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        name:
          type: string
        url_base:
          type: string
          description: "base url"
        path:
          type: string
          description: "path"
        http_method:
          "$ref": "#/definitions/HttpMethod"
        request_options_provider:
          "$ref": "#/definitions/RequestOptionsProvider"
        authenticator:
          "$ref": "#/definitions/Authenticator"
        error_handler:
          "$ref": "#/definitions/ErrorHandler"
    HttpMethod:
      type: string
      enum:
        - GET
        - POST
    RequestOptionsProvider:
      type: object
      oneOf:
        - "$ref": "#/definitions/InterpolatedRequestOptionsProvider"
    InterpolatedRequestOptionsProvider:
      type: object
      additionalProperties: false
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        request_parameters:
          "$ref": "#/definitions/RequestInput"
        request_headers:
          "$ref": "#/definitions/RequestInput"
        request_body_data:
          "$ref": "#/definitions/RequestInput"
        request_body_json:
          "$ref": "#/definitions/RequestInput"
    RequestInput:
      type: object
      additionalProperties: true
    Authenticator:
      type: object
      description: "Authenticator type"
      oneOf:
        - "$ref": "#/definitions/OAuth"
        - "$ref": "#/definitions/ApiKeyAuthenticator"
        - "$ref": "#/definitions/BearerAuthenticator"
        - "$ref": "#/definitions/BasicHttpAuthenticator"
    ApiKeyAuthenticator:
      type: object
      additionalProperties: false
      required:
        - header
        - api_token
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        header:
          type: string
        api_token:
          type: string
    BearerAuthenticator:
      type: object
      additionalProperties: false
      required:
        - api_token
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        api_token:
          type: string
    BasicHttpAuthenticator:
      type: object
      additionalProperties: false
      required:
        - username
        - password
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        username:
          type: string
        password:
          type: string
    OAuth:
      type: object
      additionalProperties: false
      required:
        - token_refresh_endpoint
        - client_id
        - client_secret
        - refresh_token
        - access_token_name
        - expires_in_name
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        token_refresh_endpoint:
          type: string
        client_id:
          type: string
        client_secret:
          type: string
        refresh_token:
          type: string
        scopes:
          type: array
          items:
            type: string
          default: []
        token_expiry_date:
          type: string
        access_token_name:
          type: string
          default: "access_token"
        expires_in_name:
          type: string
          default: "expires_in"
        refresh_request_body:
          type: object
    Paginator:
      type: object
      oneOf:
        - "$ref": "#/definitions/DefaultPaginator"
    DefaultPaginator:
      type: object
      additionalProperties: false
      required:
        - page_token_option
        - pagination_strategy
        - url_base
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        page_size:
          type: integer
        page_size_option:
          "$ref": "#/definitions/RequestOption"
        page_token_option:
          "$ref": "#/definitions/RequestOption"
        pagination_strategy:
          "$ref": "#/definitions/PaginationStrategy"
        url_base:
          type: string
    RequestOption:
      type: object
      additionalProperties: false
      required:
        - inject_into
      properties:
        inject_into:
          "$ref": "#/definitions/RequestOptionType"
        field_name:
          type: string
    RequestOptionType:
      type: string
      enum:
        - request_parameter
        - header
        - path
        - body_data
        - body_json
    PaginationStrategy:
      type: object
      oneOf:
        - "$ref": "#/definitions/CursorPagination"
        - "$ref": "#/definitions/OffsetIncrement"
        - "$ref": "#/definitions/PageIncrement"
    CursorPaginationStrategy:
      type: object
      additionalProperties: false
      required:
        - cursor_value
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        cursor_value:
          type: string
        stop_condition:
          type: string
        page_size:
          type: integer
    OffsetIncrement:
      type: object
      additionalProperties: false
      required:
        - page_size
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        page_size:
          type: integer
    PageIncrement:
      type: object
      additionalProperties: false
      required:
        - page_size
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        page_size:
          type: integer
    HttpSelector:
      type: object
      oneOf:
        - "$ref": "#/definitions/RecordSelector"
    RecordSelector:
      type: object
      required:
        - extractor
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        extractor:
          "$ref": "#/definitions/RecordExtractor"
        record_filter:
          "$ref": "#/definitions/RecordFilter"
    RecordExtractor:
      type: object
      oneOf:
        - "$ref": "#/definitions/DpathExtractor"
    DpathExtractor:
      type: object
      additionalProperties: false
      required:
        - field_pointer
      properties:
        "$options":
          "$ref": "#/definitions/$options"
        field_pointer:
          type: array
          items:
            type: string
      RecordFilter:
        type: object
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          condition:
            type: string
      StreamSlicer:
        type: object
        oneOf:
          - "$ref": "#/definitions/DatetimeStreamSlicer"
          - "$ref": "#/definitions/ListStreamSlicer"
          - "$ref": "#/definitions/CartesianProductStreamSlicer"
          - "$ref": "#/definitions/SubstreamSlicer"
          - "$ref": "#/definitions/SingleSlice"
      SingleSlice:
        type: object
        additionalProperties: false
      SubstreamSlicer:
        type: object
        required:
          - parent_stream_configs
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          parent_stream_configs:
            type: array
            items:
              "$ref": "#/definitions/ParentStreamConfig"
      ParentStreamConfig:
        type: object
        required:
          - stream
          - parent_key
          - stream_slice_field
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          stream:
            "$ref": "#/definitions/Stream"
          parent_key:
            type: string
          stream_slice_field:
            type: string
          request_option:
            "$ref": "#/definitions/RequestOption"
      CartesianProductStreamSlicer:
        type: object
        required:
          - stream_slicers
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          stream_slicers:
            type: array
            items:
              "$ref": "#/definitions/StreamSlicer"
      ListStreamSlicer:
        type: object
        required:
          - slice_values
          - cursor_field
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          slice_values:
            type: array
            items:
              type: string
          cursor_field:
            type: string
          request_option:
            "$ref": "#/definitions/RequestOption"
      DatetimeStreamSlicer:
        type: object
        required:
          - start_datetime
          - end_datetime
          - step
          - cursor_field
          - datetime_format
        additional_properties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          start_datetime:
            "$ref": "#/definitions/MinMaxDatetime"
          end_datetime:
            "$ref": "#/definitions/MinMaxDatetime"
          step:
            type: string
          cursor_field:
            type: string
          datetime_format:
            type: string
          start_time_option:
            "$ref": "#/definitions/RequestOption"
          end_time_option:
            "$ref": "#/definitions/RequestOption"
          stream_state_field_start:
            type: string
          stream_state_field_end:
            type: string
          lookback_window:
            type: string
      MinMaxDatetime:
        type: object
        required:
          - datetime
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          datetime:
            type: string
          datetime_format:
            type: string
          min_datetime:
            type: string
          max_datetime:
            type: string
      ErrorHandler:
        type: object
        description: "Error handler"
        oneOf:
          - "$ref": "#/definitions/DefaultErrorHandler"
          - "$ref": "#/definitions/CompositeErrorHandler"
      DefaultErrorHandler:
        type: object
        required:
          - max_retries
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          response_filters:
            type: array
            items:
              "$ref": "#/definitions/HttpResponseFilter"
          max_retries:
            type: integer
            default: 5
          backoff_strategies:
            type: array
            items:
              "$ref": "#/definitions/BackoffStrategy"
            default: []
      CompositeErrorHandler:
        type: object
        required:
          - error_handlers
        additionalProperties:
          "$options":
            "$ref": "#/definitions/$options"
          error_handlers:
            type: array
            items:
              "$ref": "#/definitions/ErrorHandler"
      HttpResponseFilter:
        type: object
        required:
          - action
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          action:
            "$ref": "#/definitions/ResponseAction"
          http_codes:
            type: array
            items:
              type: integer
            default: []
          error_message_contains:
            type: string
          predicate:
            type: string
      ResponseAction:
        type: string
        enum:
          - SUCCESS
          - FAIL
          - IGNORE
          - RETRY
      BackoffStrategy:
        type: object
        oneOf:
          - "$ref": "#/definitions/ExponentialBackoff"
          - "$ref": "#/definitions/ConstantBackoff"
          - "$ref": "#/definitions/WaitTimeFromHeader"
          - "$ref": "#/definitions/WaitUntilTimeFromHeader"
      ExponentialBackoff:
        type: object
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          factor:
            type: integer
            default: 5
      ConstantBackoff:
        type: object
        additionalProperties: false
        required:
          - backoff_time_in_seconds
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          backoff_time_in_seconds:
            type: number
      WaitTimeFromHeader:
        type: object
        additionalProperties: false
        required:
          - header
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          header:
            type: string
          regex:
            type: string
      WaitUntilTimeFromHeader:
        type: object
        additionalProperties: false
        required:
          - header
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          header:
            type: string
          regex:
            type: string
          min_wait:
            type: float
      RecordTransformation:
        type: object
        oneOf:
          - "$ref": "#/definitions/AddFields"
          - "$ref": "#/definitions/RemoveFields"
      AddFields:
        type: object
        required:
          - fields
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          fields:
            type: array
            items:
              "$ref": "#/definitions/AddedFieldDefinition"
      AddedFieldDefinition:
        type: object
        required:
          - path
          - value
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          path:
            "$ref": "#/definitions/FieldPointer"
          value:
            type: string
      FieldPointer:
        type: array
        items:
          type: string
      RemoveFields:
        type: object
        required:
          - field_pointers
        additionalProperties: false
        properties:
          "$options":
            "$ref": "#/definitions/$options"
          field_pointers:
            type: array
            items:
              "$ref": "#/definitions/FieldPointer"
