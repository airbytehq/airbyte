# Bulk CDK

The Bulk CDK is Airbyte's Kotlin-based CDK for developing connectors optimized for speed using protobuf encoding for data transfer. It uses Micronaut for dependency injection.

- **Extract CDK**: Provides functionality for source connectors including schema discovery, partitioned data reading, state management, CDC support via Debezium, and JDBC toolkits.
- **Load CDK**: Provides functionality for destination connectors including stream-based data loading, parallel pipeline execution, schema evolution, and support for cloud storage (S3, GCS, Azure) and database destinations.
- **Base**: Shared foundational functionality including core operations, protocol encoding/decoding, exception handling, and build tooling.

## Changelog

<details>
  <summary>Expand to review</summary>

| Version | Date       | Pull Request                                             | CDK Component | Subject                                                                                                                                                                                                                                                                                                                                                         |
|---------|------------|----------------------------------------------------------|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0.2.4   | 2025-01-29 |                                                          | Load, Extract | Load and Extract now declare base CDK as an `api` dependency with explicit version (1.0.0), enabling transitive dependency resolution for connectors. Moved micronautVersion to gradle.properties.                                                                                                                                                              |
| 0.2.3   | 2025-01-29 | [72437](https://github.com/airbytehq/airbyte/pull/72437) | Load          | Exposes JsonConverterConfig and LifecycleParallelismConfig.                                                                                                                                                                                                                                                                                                     |
| 0.2.2   | 2025-01-16 | [71803](https://github.com/airbytehq/airbyte/pull/71803) | Extract       | dded validation in `CdcPartitionReader.checkpoint()` to fail if a watchdog timeout occurs during synthetic snapshot. Updated `ValidDebeziumWarmStartState` to require non-null schema history.                                                                                                                                                                  |
| 0.2.1   |            |                                                          | Load          | Revert schema parsing change in `legacy-task-loader` that failed streams when handling empty schemas. Schemas without a `type` field now default to object type again.                                                                                                                                                                                          |
| 0.2.0   |            |                                                          | Load          | Fully separate `legacy-task-loader` toolkit from `core-load`. Drastically simplify `core-load` by removing legacy abstractions.                                                                                                                                                                                                                                 |
| 0.1.108 |            |                                                          | Load          | DataCoercionSuite tests null character in strings                                                                                                                                                                                                                                                                                                               |
| 0.1.107 |            |                                                          | Base          | Add utility to start ssh tunnel + return endpoint                                                                                                                                                                                                                                                                                                               |
| 0.1.106 |            |                                                          | Load          | Add `DEFAULT_AIRBYTE_INTERNAL_NAMESPACE` constant to `core-load` table package. Add README documentation to `legacy-task-loader` and `legacy-task-load-db` toolkits                                                                                                                                                                                             |
| 0.1.105 |            |                                                          | Load          | Schema regression tests use .json extension                                                                                                                                                                                                                                                                                                                     |
| 0.1.104 |            |                                                          | Load          | Add `legacy-task-loader` toolkit containing CDK 0.1.74 code for connectors not yet migrated to the modern tableSchema API. Add `useLegacyTaskLoader` option to `airbyteBulkConnector` plugin to automatically include the toolkit and exclude core-load. Rename `load-db` toolkit to `legacy-task-load-db`. Revert `load-db` to pre components era (cdk 0.1.52) |
| 0.1.103 |            |                                                          | Load          | Add table identifier regression test                                                                                                                                                                                                                                                                                                                            |
| 0.1.102 |            |                                                          | Load          | Add schema regression test                                                                                                                                                                                                                                                                                                                                      |
| 0.1.101 |            |                                                          | Load          | Introduce scope and oauth server uri attributes in iceberg polaris spec                                                                                                                                                                                                                                                                                         |
| 0.1.100 |            |                                                          | Load          | Allow override of socket count in dest connectors                                                                                                                                                                                                                                                                                                               |
| 0.1.99  |            |                                                          | Load          | Enforce maximum parallelism for final aggregate flushes                                                                                                                                                                                                                                                                                                         |
| 0.1.98  |            |                                                          | Extract       | Fix a bug causing query limit pull a negative number of rows                                                                                                                                                                                                                                                                                                    |
| 0.1.97  |            |                                                          | Load          | Slightly refactor schema mapper suite                                                                                                                                                                                                                                                                                                                           |
| 0.1.96  |            |                                                          | Extract       | Allow setting an upper limit for the number of rows pulled in a single query for a sequential partition read                                                                                                                                                                                                                                                    |
| 0.1.95  |            |                                                          | Load          | Add schema mapper test suite                                                                                                                                                                                                                                                                                                                                    |
| 0.1.94  |            |                                                          | Extract       | Fix trigger table handling of empty change tables                                                                                                                                                                                                                                                                                                               |
| 0.1.93  |            |                                                          | Load          | Add KDoc documentation to core destination interfaces: Aggregate, AggregateFactory and RecordDTO                                                                                                                                                                                                                                                                |
| 0.1.92  |            |                                                          | Load          | Datacoercion suite calls ValueCoercer.map                                                                                                                                                                                                                                                                                                                       |
| 0.1.91  |            |                                                          | Load          | Upsert records test uses proper target schema                                                                                                                                                                                                                                                                                                                   |
| 0.1.90  |            |                                                          | Load          | Components tests: data coercion tests cover all data types                                                                                                                                                                                                                                                                                                      |
| 0.1.89  |            |                                                          | Load          | Components tests: data coercion tests for int+number                                                                                                                                                                                                                                                                                                            |
| 0.1.88  |            |                                                          | Load          | Add CDC_CURSOR_COLUMN_NAME constant                                                                                                                                                                                                                                                                                                                             |
| 0.1.87  |            |                                                          | Load          | Properly call NamespaceMapper before calculating final table names                                                                                                                                                                                                                                                                                              |
| 0.1.86  |            |                                                          | Load          | Adds toFinalSchema "escape hatch" for final table schema munging. Refactored Component test fixtures to require explicit StreamTableSchema creation using TableSchemaFactory                                                                                                                                                                                    |
| 0.1.85  |            |                                                          | Extract       | Fix CDC partition reader race condition when draining records after debezium shutdown                                                                                                                                                                                                                                                                           |
| 0.1.84  |            |                                                          | Load          | Move most DB packages into core. Refactor table schema interface into TableSchemaMapper                                                                                                                                                                                                                                                                         |
| 0.1.83  |            |                                                          | Load          | More tests to help guide dependency injection dependency implementations                                                                                                                                                                                                                                                                                        |
| 0.1.82  |            |                                                          | Load          | Components tests: more schema evolution testcases                                                                                                                                                                                                                                                                                                               |
| 0.1.81  |            |                                                          | Load          | Components tests: more coverage on upsert                                                                                                                                                                                                                                                                                                                       |
| 0.1.80  |            |                                                          | Extract       | Fix default partition_id value for `CheckpointOnlyPartitionReader`                                                                                                                                                                                                                                                                                              |
| 0.1.79  |            |                                                          | Extract       | Support multiple ts precision patterns for ts decoding. Expose `columnMetadataFromResultSet` function in `JdbcMetadataQuerier`                                                                                                                                                                                                                                  |
| 0.1.78  |            |                                                          | Load          | Add basic schema evolution test cases                                                                                                                                                                                                                                                                                                                           |
| 0.1.77  |            |                                                          | Extract       | Fix duplicate metadata key in JdbcMetadataQuerier                                                                                                                                                                                                                                                                                                               |
| 0.1.76  |            |                                                          | Load          | Remove a println from our code generating bad logs                                                                                                                                                                                                                                                                                                              |
| 0.1.75  |            |                                                          | Extract       | Improve handling of debezium engine shutdown                                                                                                                                                                                                                                                                                                                    |
| 0.1.74  |            |                                                          | Load          | Split up ensureSchemaMatches into smaller functions                                                                                                                                                                                                                                                                                                             |
| 0.1.73  |            |                                                          | Load          | More changes to `IcebergTableSynchronizer` to get BigLake working                                                                                                                                                                                                                                                                                               |
| 0.1.72  |            |                                                          | Extract       | Fix case sensitivity for table filtering                                                                                                                                                                                                                                                                                                                        |
| 0.1.71  |            |                                                          | Load          | Remove noisy logs                                                                                                                                                                                                                                                                                                                                               |
| 0.1.70  |            |                                                          | Load          | Make getOperation in icebergUtil public                                                                                                                                                                                                                                                                                                                         |
| 0.1.69  |            |                                                          | Load          | Update the IcebergTableSynchronizer to allow for individual update operations commit in preparation for BigLake                                                                                                                                                                                                                                                 |
| 0.1.68  |            |                                                          | Load          | Refactor additional state statistic tracking                                                                                                                                                                                                                                                                                                                    |
| 0.1.67  |            |                                                          | Load          | Fix expectations in basic integration tests related to additional stats                                                                                                                                                                                                                                                                                         |
| 0.1.66  |            |                                                          | Load          | Support for reporting of additional stats in destination state messages. Refactor coercer interface to separate out coercion and validation                                                                                                                                                                                                                     |
| 0.1.65  |            |                                                          | Extract       | Fix bug when getting table metadata that cause timeout                                                                                                                                                                                                                                                                                                          |
| 0.1.64  |            |                                                          | Extract       | Add table filtering to jdbc connectors                                                                                                                                                                                                                                                                                                                          |
| 0.1.63  |            |                                                          | Extract       | Introduce extract-trigger toolkit for trigger-based CDC                                                                                                                                                                                                                                                                                                         |
| 0.1.62  |            |                                                          | Load          | Correctly parse empty schemas                                                                                                                                                                                                                                                                                                                                   |
| 0.1.61  |            |                                                          |               | Fix bug related to state messages indexing in the dataflow CDK                                                                                                                                                                                                                                                                                                  |
| 0.1.60  |            |                                                          | Load          | Extract test-only client                                                                                                                                                                                                                                                                                                                                        |
| 0.1.59  |            |                                                          |               | Fix upsert test                                                                                                                                                                                                                                                                                                                                                 |
| 0.1.58  |            |                                                          | Load          | Log unflushed state diagnostic info                                                                                                                                                                                                                                                                                                                             |
| 0.1.57  |            |                                                          | Extract       | Remove unnecesarry metafield decoration from database views streams in CDC mode                                                                                                                                                                                                                                                                                 |
| 0.1.56  |            |                                                          | Load          | Improve component tests                                                                                                                                                                                                                                                                                                                                         |
| 0.1.55  |            |                                                          | Extract       | Timeout in case of no event comes back from dbz                                                                                                                                                                                                                                                                                                                 |
| 0.1.54  |            |                                                          |               | Update temporal type representation for proto format                                                                                                                                                                                                                                                                                                            |
| 0.1.53  |            |                                                          | Extract       | Handle debezium engine shutdown properly with socket                                                                                                                                                                                                                                                                                                            |
| 0.1.52  |            |                                                          | Load          | Refactor database operations interfaces and establish comprehensive TableOperationsSuite component test suite                                                                                                                                                                                                                                                   |
| 0.1.51  |            |                                                          |               | Polaris support in the iceberg configuration                                                                                                                                                                                                                                                                                                                    |
| 0.1.50  |            |                                                          |               | Better handle interleaved streams in aggregate publishing                                                                                                                                                                                                                                                                                                       |
| 0.1.49  |            |                                                          | Extract       | Support nano sec to preserve precision in TimeAccessor                                                                                                                                                                                                                                                                                                          |
| 0.1.48  |            |                                                          | Extract       | Enable heart beat timeout for CDC sync                                                                                                                                                                                                                                                                                                                          |
| 0.1.47  |            |                                                          | Extract       | Correct encoding of CDC_UPDATED_AT and CDC_DELETED_AT fields in protobuf records                                                                                                                                                                                                                                                                                |
| 0.1.46  |            |                                                          |               | Noop: Move stream lifecyle dispatchers to bean factory                                                                                                                                                                                                                                                                                                          |
| 0.1.45  |            |                                                          |               | Noop release. 0.1.44 suspected to have a bad publish                                                                                                                                                                                                                                                                                                            |
| 0.1.44  |            |                                                          | Load          | Dataflow Load CDK: Set dest stats equal to source stats                                                                                                                                                                                                                                                                                                         |
| 0.1.43  |            |                                                          | Load          | Dataflow Load CDK: Properly handle interleaved per stream states                                                                                                                                                                                                                                                                                                |
| 0.1.42  |            |                                                          | Load          | Dataflow Load CDK: Fixes hang when one of many parallel pipelines fails. Organizes thread pools                                                                                                                                                                                                                                                                 |
| 0.1.41  |            |                                                          | Extract       | Prevent a devision by zero error when a table cannot be partitioned                                                                                                                                                                                                                                                                                             |
| 0.1.40  |            |                                                          |               | Add gradle task to bump CDK version + add changelog entry                                                                                                                                                                                                                                                                                                       |
| 0.1.39  |            |                                                          | Load          | Minor fixes with stream completion logic + proto conversion in Load CDK                                                                                                                                                                                                                                                                                         |
| 0.1.38  |            |                                                          | Load          | Adds stats support for "speed" mode to the Load CDK                                                                                                                                                                                                                                                                                                             |
| 0.1.37  |            |                                                          | Load          | load-s3: S3Client forces path-style access, to enable minio compatibility                                                                                                                                                                                                                                                                                       |
| 0.1.36  |            |                                                          |               | Use dedicated dispatcher for parse+aggregate stage for an individual pipeline + cache column name lookup                                                                                                                                                                                                                                                        |
| 0.1.35  |            |                                                          |               | Fix input stream wiring for dockerized acceptance tests                                                                                                                                                                                                                                                                                                         |
| 0.1.34  |            |                                                          |               | Moved version declaration from build.gradle to version.properties                                                                                                                                                                                                                                                                                               |
| 0.1.33  |            |                                                          | Load          | Load CDK: Low-code API destination support for dynamically defined discover objects and operations                                                                                                                                                                                                                                                              |
| 0.1.32  |            |                                                          | Load          | Fix input stream wiring for non-dockerized acceptance tests in Load CDK                                                                                                                                                                                                                                                                                         |
| 0.1.31  |            |                                                          | Extract       | Pass WhereNode to FromSample node so we can apply filters to the sample query                                                                                                                                                                                                                                                                                   |
| 0.1.30  |            |                                                          |               | Add Low-code API destination support for statically defined discover operations                                                                                                                                                                                                                                                                                 |
| 0.1.29  |            |                                                          | Load          | Use correct field name for generation ID meta column                                                                                                                                                                                                                                                                                                            |
| 0.1.28  |            |                                                          | Extract       | Protobuf encoding fixes to make various types compatible with load(destination) decoding                                                                                                                                                                                                                                                                        |
| 0.1.27  |            |                                                          |               | Allow per-test properties for spec integration test                                                                                                                                                                                                                                                                                                             |
| 0.1.26  |            |                                                          |               | Improve load-azure-blob-storage documentation                                                                                                                                                                                                                                                                                                                   |
| 0.1.25  |            |                                                          |               | Adds proto support to dataflow. Misc transform package cleanup (developer-facing)                                                                                                                                                                                                                                                                               |
| 0.1.24  |            |                                                          |               | Adds byte counts to emitted state stats                                                                                                                                                                                                                                                                                                                         |
| 0.1.23  |            |                                                          |               | Dataflow CDK fails syncs if there are unflushed states at the end of a sync                                                                                                                                                                                                                                                                                     |
| 0.1.22  |            |                                                          |               | Add EntraID support to azure-blob-storage                                                                                                                                                                                                                                                                                                                       |
| 0.1.21  |            |                                                          |               | Adds basic socket support                                                                                                                                                                                                                                                                                                                                       |
| 0.1.20  |            |                                                          |               | Fix hard failure edge case in stream initialization for in dataflow cdk lifecycle                                                                                                                                                                                                                                                                               |
| 0.1.18  |            |                                                          |               | Update load dataflow package accounts for stream completes and dest stats                                                                                                                                                                                                                                                                                       |
| 0.1.17  |            |                                                          |               | Run aggregate and flush steps on different dispatchers (default and IO respectively)                                                                                                                                                                                                                                                                            |
| 0.1.16  |            |                                                          | Load          | Ensure sequential state emission. Remove flushed state/partition keys                                                                                                                                                                                                                                                                                           |
| 0.1.15  |            |                                                          | Extract       | Logs DB version during Check for all JDBC databases                                                                                                                                                                                                                                                                                                             |
| 0.1.14  |            |                                                          | Load          | Add agent to Load CDK                                                                                                                                                                                                                                                                                                                                           |
| 0.1.13  |            |                                                          | Load          | Make the resources being used by the dataflow CDK configurable                                                                                                                                                                                                                                                                                                  |
| 0.1.12  |            |                                                          | Load          | Add teardown to the dataflow pipeline                                                                                                                                                                                                                                                                                                                           |
| 0.1.11  |            |                                                          | Load          | Add finalization to the dataflow pipeline in Load CDK                                                                                                                                                                                                                                                                                                           |
| 0.1.10  |            |                                                          |               | Update the version change check to avoid using deprecated libs                                                                                                                                                                                                                                                                                                  |
| 0.1.7   |            |                                                          |               | Update the log4j to allow us to dynamically set the log level via an env variable                                                                                                                                                                                                                                                                               |
| 0.1.6   |            |                                                          | Load          | Add the dataflow pipeline. It is a more comprehensive way to write the ingestion pipeline steps. The new pipeline isn't ready to be use in this version                                                                                                                                                                                                         |
| 0.1.4   |            |                                                          | Extract       | Fixes for CDC in socket mode - state, partitioning and full refresh streams                                                                                                                                                                                                                                                                                     |
| 0.1.3   |            |                                                          |               |                                                                                                                                                                                                                                                                                                                                                                 |
| 0.1.2   |            |                                                          |               |                                                                                                                                                                                                                                                                                                                                                                 |
| 0.1.1   |            |                                                          |               |                                                                                                                                                                                                                                                                                                                                                                 |
| 0.1.0   |            |                                                          |               | Adopted Semantic Versioning (SemVer) for the CDK to provide more meaningful version numbers, requiring the CDK version to be set manually in the build.gradle file                                                                                                                                                                                              |

</details>
