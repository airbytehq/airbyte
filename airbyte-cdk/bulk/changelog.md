# Bulk CDK

The Bulk CDK is Airbyte's Kotlin-based CDK for developing connectors optimized for speed using protobuf encoding for data transfer. It uses Micronaut for dependency injection.

- **Extract CDK**: Provides functionality for source connectors including schema discovery, partitioned data reading, state management, CDC support via Debezium, and JDBC toolkits.
- **Load CDK**: Provides functionality for destination connectors including stream-based data loading, parallel pipeline execution, schema evolution, and support for cloud storage (S3, GCS, Azure) and database destinations.
- **Base**: Shared foundational functionality including core operations, protocol encoding/decoding, exception handling, and build tooling.

## Changelog

<details>
  <summary>Expand to review</summary>

| Version | Date       | Pull Request | CDK Component | Subject                                                                                                                                                                                                          |
|---------|------------|--------------|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0.2.1   | 2025-01-16 | 71803        | Extract       | Added validation in `CdcPartitionReader.checkpoint()` to fail if a watchdog timeout occurs during synthetic snapshot. Updated `ValidDebeziumWarmStartState` to require non-null schema history. 
| 0.2.0   |            |              | Load          | Fully separate `legacy-task-loader` toolkit from `core-load`. Drastically simplify `core-load` by removing legacy abstractions.                                                                                |
| 0.1.108 |            |              | Load          | Load CDK: DataCoercionSuite tests null character in strings                                                                                                                                                      |
| 0.1.107 |            |              | Base          | Add utility to start ssh tunnel + return endpoint                                                                                                                                                                |
| 0.1.106 |            |              | Load          | Add `DEFAULT_AIRBYTE_INTERNAL_NAMESPACE` constant to `core-load` table package. Add README documentation to `legacy-task-loader` and `legacy-task-load-db` toolkits                                              |
| 0.1.105 |            |              | Load          | Schema regression tests use .json extension                                                                                                                                                                      |
| 0.1.104 |            |              | Load          | Add `legacy-task-loader` toolkit for connectors not yet migrated to modern tableSchema API. Add `useLegacyTaskLoader` option to `airbyteBulkConnector` plugin. Rename `load-db` toolkit to `legacy-task-load-db` |
| 0.1.103 |            |              | Load          | Add table identifier regression test                                                                                                                                                                             |
| 0.1.102 |            |              | Load          | Add schema regression test                                                                                                                                                                                       |
| 0.1.101 |            |              | Load          | Introduce scope and oauth server uri attributes in iceberg polaris spec                                                                                                                                          |
| 0.1.100 |            |              | Load          | Allow override of socket count in dest connectors                                                                                                                                                                |
| 0.1.99  |            |              | Load          | Enforce maximum parallelism for final aggregate flushes                                                                                                                                                          |
| 0.1.98  |            |              | Extract       | Fix a bug causing query limit pull a negative number of rows                                                                                                                                                     |
| 0.1.97  |            |              | Load          | Slightly refactor schema mapper suite                                                                                                                                                                            |
| 0.1.96  |            |              | Extract       | Allow setting an upper limit for the number of rows pulled in a single query for a sequential partition read                                                                                                     |
| 0.1.95  |            |              | Load          | Add schema mapper test suite                                                                                                                                                                                     |
| 0.1.94  |            |              | Extract       | Fix trigger table handling of empty change tables                                                                                                                                                                |
| 0.1.93  |            |              | Load          | Add KDoc documentation to core destination interfaces: Aggregate, AggregateFactory and RecordDTO                                                                                                                 |
| 0.1.92  |            |              | Load          | Datacoercion suite calls ValueCoercer.map                                                                                                                                                                        |
| 0.1.91  |            |              | Load          | Upsert records test uses proper target schema                                                                                                                                                                    |
| 0.1.90  |            |              | Load          | Components tests: data coercion tests cover all data types                                                                                                                                                       |
| 0.1.89  |            |              | Load          | Components tests: data coercion tests for int+number                                                                                                                                                             |
| 0.1.88  |            |              | Load          | Add CDC_CURSOR_COLUMN_NAME constant                                                                                                                                                                              |
| 0.1.87  |            |              | Load          | Properly call NamespaceMapper before calculating final table names                                                                                                                                               |
| 0.1.86  |            |              | Load          | Adds toFinalSchema "escape hatch" for final table schema munging. Refactored Component test fixtures to require explicit StreamTableSchema creation using TableSchemaFactory                                     |
| 0.1.85  |            |              | Extract       | Fix CDC partition reader race condition when draining records after debezium shutdown                                                                                                                            |
| 0.1.84  |            |              | Load          | Move most DB packages into core. Refactor table schema interface into TableSchemaMapper                                                                                                                          |
| 0.1.83  |            |              | Load          | More tests to help guide dependency injection dependency implementations                                                                                                                                         |
| 0.1.82  |            |              | Load          | Components tests: more schema evolution testcases                                                                                                                                                                |
| 0.1.81  |            |              | Load          | Components tests: more coverage on upsert                                                                                                                                                                        |
| 0.1.80  |            |              | Extract       | Fix default partition_id value for CheckpointOnlyPartitionReader                                                                                                                                                 |
| 0.1.79  |            |              | Extract       | Support multiple ts precision patterns for ts decoding. Expose columnMetadataFromResultSet function in JdbcMetadataQuerier                                                                                       |
| 0.1.78  |            |              | Load          | Add basic schema evolution test cases                                                                                                                                                                            |
| 0.1.77  |            |              | Extract       | Fix duplicate metadata key in JdbcMetadataQuerier                                                                                                                                                                |
| 0.1.76  |            |              | Load          | Remove a println from our code generating bad logs                                                                                                                                                               |
| 0.1.75  |            |              | Extract       | Improve handling of debezium engine shutdown                                                                                                                                                                     |
| 0.1.74  |            |              | Load          | Split up ensureSchemaMatches into smaller functions                                                                                                                                                              |
| 0.1.73  |            |              | Load          | More changes to IcebergTableSynchronizer to get BigLake working                                                                                                                                                  |
| 0.1.72  |            |              | Extract       | Fix case sensitivity for table filtering                                                                                                                                                                         |
| 0.1.71  |            |              | Load          | Remove noisy logs                                                                                                                                                                                                |
| 0.1.70  |            |              | Load          | Make getOperation in icebergUtil public                                                                                                                                                                          |
| 0.1.69  |            |              | Load          | Update the IcebergTableSynchronizer to allow for individual update operations commit in preparation for BigLake                                                                                                  |
| 0.1.68  |            |              | Load          | Refactor additional state statistic tracking                                                                                                                                                                     |
| 0.1.67  |            |              | Load          | Fix expectations in basic integration tests related to additional stats                                                                                                                                          |
| 0.1.66  |            |              | Load          | Support for reporting of additional stats in destination state messages. Refactor coercer interface to separate out coercion and validation                                                                      |
| 0.1.65  |            |              | Extract       | Fix bug when getting table metadata that cause timeout                                                                                                                                                           |
| 0.1.64  |            |              | Extract       | Add table filtering to jdbc connectors                                                                                                                                                                           |
| 0.1.63  |            |              | Extract       | Introduce extract-trigger toolkit for trigger-based CDC                                                                                                                                                          |
| 0.1.62  |            |              | Load          | Correctly parse empty schemas                                                                                                                                                                                    |
| 0.1.61  |            |              | L
