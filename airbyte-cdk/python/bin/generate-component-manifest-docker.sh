#!/usr/bin/env bash

# We need to run this script in a docker container because we need to use a
# specific version of datamodel-codegen that generates pydantic v1 models (correctly).
# The newer datamodel-codegen's "pydantic v1" models are different than those v1 models
# generated by the older version of datamodel-codegen.

set -e

ROOT_DIR=${ROOT_DIR:-$(git rev-parse --show-toplevel)}
ROOT_DIR_NAME=${ROOT_DIR##*/}

[ -z "$ROOT_DIR" ] && exit 1

docker run --rm \
  --volume "${ROOT_DIR}:/${ROOT_DIR_NAME}" \
  --workdir "/${ROOT_DIR_NAME}" \
  python:3.10 "/${ROOT_DIR_NAME}/airbyte-cdk/python/bin/generate-component-manifest-files.sh"