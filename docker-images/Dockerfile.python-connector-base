# Migrated from airbyte-ci/connectors/base_images/README.md

# https://hub.docker.com/_/python/tags?name=3.11.11-slim-bookworm
ARG BASE_IMAGE=docker.io/python:3.11.11-slim-bookworm@sha256:081075da77b2b55c23c088251026fb69a7b2bf92471e491ff5fd75c192fd38e5
FROM ${BASE_IMAGE}

RUN ln -snf /usr/share/zoneinfo/Etc/UTC /etc/localtime

# Install dependencies needed for OCR and PDF processing in certain file-based connectors
# TODO: move these out of the base image
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get dist-upgrade -y && \
    apt-get install -y --no-install-recommends \
      socat=1.7.4.4-2 \
      tesseract-ocr=5.3.0-2 \
      poppler-utils=22.12.0-2+deb12u1 && \
    apt-get clean
    
RUN pip install --upgrade \
      pip==24.0 \
      setuptools==78.1.1 && \
    pip install --no-cache-dir \
      poetry==1.8.4

# Set-up groups, users, and directories
RUN adduser --uid 1000 --system --group --no-create-home airbyte && \
    mkdir --mode 755 /airbyte && \
    mkdir --mode 755 /custom_cache && \
    mkdir -p 755 /usr/share/nltk_data && \
    chown -R airbyte:airbyte /airbyte && \
    chown -R airbyte:airbyte /custom_cache && \
    chown -R airbyte:airbyte /secrets && \
    chown -R airbyte:airbyte /config && \
    chown -R airbyte:airbyte /usr/share/pki/ca-trust-source && \
    chown -R airbyte:airbyte /usr/share/pki/nltk_data && \
    chown -R airbyte:airbyte /etc/pki/ca-trust && \
    chown -R airbyte:airbyte /tmp

ENV POETRY_VIRTUALENVS_CREATE=false
ENV POETRY_VIRTUALENVS_IN_PROJECT=false
ENV POETRY_NO_INTERACTION=1
