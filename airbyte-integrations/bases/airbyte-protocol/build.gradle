plugins {
    id 'airbyte-python'
    id 'airbyte-docker'
}

airbytePython {
    moduleDirectory 'airbyte_protocol'
}

dependencies {
    implementation files(project(':airbyte-integrations:bases:base-python').airbyteDocker.outputs)
}

task generateProtocolClassFilesWithoutLicense(type: Exec) {
    environment 'ROOT_DIR', rootDir.absolutePath
    commandLine 'bin/generate-protocol-files.sh'
    dependsOn ':airbyte-integrations:bases:airbyte-protocol:code-generator:buildImage'
}

// todo: figure out dependencies
task generateProtocolClassFiles(dependsOn: [generateProtocolClassFilesWithoutLicense, rootProject.spotlessPython])
rootProject.spotlessPython.mustRunAfter(generateProtocolClassFilesWithoutLicense)
rootProject.build.dependsOn generateProtocolClassFiles
