import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage
plugins {
    id 'com.bmuschko.docker-remote-api'
}

def image = 'airbyte/base-python:dev'

task imageName {
    doLast {
        println "IMAGE $image"
    }
}

task deleteProtocolDefinitions(type: Delete) {
    delete 'airbyte_protocol/airbyte_protocol/types'
}

task copyProtocolDefinitions(type: Copy) {
    from file("$projectDir/../../airbyte-protocol/models/src/main/resources/airbyte_protocol").absolutePath
    into "airbyte_protocol/airbyte_protocol/types"
    dependsOn deleteProtocolDefinitions
}

task buildImage(type: DockerBuildImage) {
    inputDir = projectDir
    images.add(image)
    dependsOn ":airbyte-integrations:base:buildImage", copyProtocolDefinitions
}
