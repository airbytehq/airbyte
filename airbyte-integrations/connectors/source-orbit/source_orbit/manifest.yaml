version: "0.52.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: ["data"]
  requester:
    type: HttpRequester
    url_base: "https://app.orbit.love/api/v1/"
    http_method: "GET"
    authenticator:
      type: BearerAuthenticator
      api_token: "{{ config['api_token'] }}"
    request_parameters:
      start_date: "{{ config.get('start_date') }}"
  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"

  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"

  workspace_stream:
    $ref: "#/definitions/base_stream"
    name: "workspace"
    primary_key: "id"
    $parameters:
      path: "workspaces/{{config['workspace']}}"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          id:
            type:
              - "null"
              - string
          type:
            type:
              - "null"
              - string
          relationships:
            type: object
            properties:
              last_member:
                type:
                  - "null"
                  - object
                properties:
                  data:
                    type:
                      - "null"
                      - object
              last_activity:
                type:
                  - "null"
                  - object
                properties:
                  data:
                    type:
                      - "null"
                      - object
              repositories:
                type:
                  - "null"
                  - object
                properties:
                  data:
                    type:
                      - "null"
                      - array
          attributes:
            type:
              - "null"
              - object
            additionalProperties: true
            properties:
              name:
                type:
                  - "null"
                  - string
              slug:
                type:
                  - "null"
                  - string
              updated_at:
                type:
                  - "null"
                  - string
              created_at:
                type:
                  - "null"
                  - string
              members_count:
                type:
                  - "null"
                  - integer
              activities_count:
                type:
                  - "null"
                  - integer
              tags:
                type:
                  - "null"
                  - object
                additionalProperties: true
                properties: {}
  members_stream:
    $ref: "#/definitions/base_stream"
    name: "members"
    primary_key: "id"
    $parameters:
      path: "{{config['workspace']}}/members"
    retriever:
      $ref: "#/definitions/retriever"
      paginator:
        type: "DefaultPaginator"
        pagination_strategy:
          type: PageIncrement
          start_from_page: 1
          page_size: 100
        page_token_option:
          type: RequestOption
          inject_into: request_parameter
          field_name: page
        page_size_option:
          inject_into: request_parameter
          field_name: items
          type: RequestOption

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          id:
            type:
              - "null"
              - string
          fake:
            type:
              - "null"
              - string
          type:
            type:
              - "null"
              - string
          attributes:
            type:
              - "null"
              - object
            additionalProperties: true
            properties:
              activities_count:
                type:
                  - "null"
                  - integer
              activities_score:
                type:
                  - "null"
                  - number
              avatar_url:
                type:
                  - "null"
                  - string
              bio:
                type:
                  - "null"
                  - string
              birthday:
                type:
                  - "null"
                  - string
              company:
                type:
                  - "null"
                  - string
              title:
                type:
                  - "null"
                  - string
              created_at:
                type:
                  - "null"
                  - string
              deleted_at:
                type:
                  - "null"
                  - string
              first_activity_occurred_at:
                type:
                  - "null"
                  - string
              last_activity_occurred_at:
                type:
                  - "null"
                  - string
              location:
                type:
                  - "null"
                  - string
              name:
                type:
                  - "null"
                  - string
              pronouns:
                type:
                  - "null"
                  - string
              reach:
                type:
                  - "null"
                  - integer
              shipping_address:
                type:
                  - "null"
                  - string
              slug:
                type:
                  - "null"
                  - string
              source:
                type:
                  - "null"
                  - string
              tag_list:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - string
              tags:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - string
              teammate:
                type: boolean
              tshirt:
                type:
                  - "null"
                  - string
              updated_at:
                type:
                  - "null"
                  - string
              merged_at:
                type:
                  - "null"
                  - string
              url:
                type:
                  - "null"
                  - string
              orbit_url:
                type:
                  - "null"
                  - string
              created:
                type:
                  - "null"
                  - boolean
              id:
                type:
                  - "null"
                  - string
              orbit_level:
                type:
                  - "null"
                  - integer
              love:
                type:
                  - "null"
                  - string
              twitter:
                type:
                  - "null"
                  - string
              github:
                type:
                  - "null"
                  - string
              discourse:
                type:
                  - "null"
                  - string
              email:
                type:
                  - "null"
                  - string
              devto:
                type:
                  - "null"
                  - string
              linkedin:
                type:
                  - "null"
                  - string
              discord:
                type:
                  - "null"
                  - string
              github_followers:
                type:
                  - "null"
                  - integer
              twitter_followers:
                type:
                  - "null"
                  - integer
              topics:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - string
              languages:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - string
          relationships:
            type:
              - "null"
              - object
            additionalProperties: true
            properties: {}
streams:
  - "#/definitions/workspace_stream"
  - "#/definitions/members_stream"

check:
  type: CheckStream
  stream_names:
    - "workspace"
