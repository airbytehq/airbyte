version: 4.3.0
type: DeclarativeSource
check:
  type: CheckStream
  stream_names:
    - users
streams:
  - type: DeclarativeStream
    name: users
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          businessPhones:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          displayName:
            type:
              - "null"
              - string
          givenName:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          jobTitle:
            type:
              - "null"
              - string
          mail:
            type:
              - "null"
              - string
          mobilePhone:
            type:
              - "null"
              - string
          officeLocation:
            type:
              - "null"
              - string
          preferredLanguage:
            type:
              - "null"
              - string
          surname:
            type:
              - "null"
              - string
          userPrincipalName:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: users?$top={{ config.get('page_size', 20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: groups
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          classification:
            type:
              - "null"
              - string
          createdDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          creationOptions:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          deletedDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
          displayName:
            type:
              - "null"
              - string
          expirationDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          groupTypes:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          id:
            type:
              - "null"
              - string
          isAssignableToRole:
            type:
              - "null"
              - boolean
          mail:
            type:
              - "null"
              - string
          mailEnabled:
            type:
              - "null"
              - boolean
          mailNickname:
            type:
              - "null"
              - string
          membershipRule:
            type:
              - "null"
              - string
          membershipRuleProcessingState:
            type:
              - "null"
              - string
          onPremisesDomainName:
            type:
              - "null"
              - string
          onPremisesLastSyncDateTime:
            format: date-time
            type:
              - "null"
              - string
          onPremisesNetBiosName:
            type:
              - "null"
              - string
          onPremisesProvisioningErrors:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          onPremisesSamAccountName:
            type:
              - "null"
              - string
          onPremisesSecurityIdentifier:
            type:
              - "null"
              - string
          onPremisesSyncEnabled:
            type:
              - "null"
              - boolean
          preferredDataLocation:
            type:
              - "null"
              - string
          preferredLanguage:
            type:
              - "null"
              - string
          proxyAddresses:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          renewedDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          resourceBehaviorOptions:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          resourceProvisioningOptions:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          securityEnabled:
            type:
              - "null"
              - boolean
          securityIdentifier:
            type:
              - "null"
              - string
          serviceProvisioningErrors:
            items:
              properties:
                createdDateTime:
                  airbyte_type: timestamp_without_timezone
                  format: date-time
                  type:
                    - "null"
                    - string
                isResolved:
                  type:
                    - "null"
                    - boolean
                serviceInstance:
                  type:
                    - "null"
                    - string
              type:
                - "null"
                - object
            type:
              - "null"
              - array
          theme:
            type:
              - "null"
              - string
          visibility:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: groups?$top={{ config.get('page_size', 20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: group_members
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          "@odata.type":
            type:
              - "null"
              - string
          businessPhones:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          displayName:
            type:
              - "null"
              - string
          givenName:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          jobTitle:
            type:
              - "null"
              - string
          mail:
            type:
              - "null"
              - string
          mobilePhone:
            type:
              - "null"
              - string
          officeLocation:
            type:
              - "null"
              - string
          preferredLanguage:
            type:
              - "null"
              - string
          surname:
            type:
              - "null"
              - string
          userPrincipalName:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          groups/{{ stream_partition.group_id }}/members?$top={{ config.get('page_size',
          20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: group_owners
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          "@odata.type":
            type:
              - "null"
              - string
          businessPhones:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          displayName:
            type:
              - "null"
              - string
          givenName:
            type:
              - "null"
              - string
          groupId:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          jobTitle:
            type:
              - "null"
              - string
          mail:
            type:
              - "null"
              - string
          mobilePhone:
            type:
              - "null"
              - string
          officeLocation:
            type:
              - "null"
              - string
          preferredLanguage:
            type:
              - "null"
              - string
          surname:
            type:
              - "null"
              - string
          userPrincipalName:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          groups/{{ stream_partition.group_id }}/owners?$top={{ config.get('page_size',
          20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: conversations
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          groupId:
            type:
              - "null"
              - string
          hasAttachments:
            type:
              - "null"
              - boolean
          id:
            type:
              - "null"
              - string
          lastDeliveredDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          preview:
            type:
              - "null"
              - string
          topic:
            type:
              - "null"
              - string
          uniqueSenders:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          groups/{{ stream_partition.group_id }}/conversations?$top={{ config.get('page_size',
          20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 403
                  error_message: App only access is restricting some resources
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: channels
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          createdDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type: string
          description:
            type:
              - "null"
              - string
          displayName:
            type:
              - "null"
              - string
          email:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          isFavoriteByDefault:
            type:
              - "null"
              - boolean
          membershipType:
            type:
              - "null"
              - string
          tenantId:
            type:
              - "null"
              - string
          webUrl:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: teams/{{ stream_partition.group_id }}/channels
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  predicate: "{{ 'No threadId found for TeamId' in response }}"
                  http_codes:
                    - 404
                  error_message: Resource not found for team Ids
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: NoPagination
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: channel_members
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          "@odata.type":
            type:
              - "null"
              - string
          channelId:
            type:
              - "null"
              - string
          displayName:
            type:
              - "null"
              - string
          email:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          roles:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          tenantId:
            type:
              - "null"
              - string
          userId:
            type:
              - "null"
              - string
          visibleHistoryStartDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          teams/{{ stream_partition.group_id }}/channels/{{
          stream_partition.channel_id }}/members?$top={{ config.get('page_size', 20)
          }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  predicate: "{{ 'No Team found with Group id' in response }}"
                  http_codes:
                    - 404
                  error_message: Resource not found for group Ids
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: channel_id
              stream:
                type: DeclarativeStream
                name: channels
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type: string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      email:
                        type:
                          - "null"
                          - string
                      id:
                        type:
                          - "null"
                          - string
                      isFavoriteByDefault:
                        type:
                          - "null"
                          - boolean
                      membershipType:
                        type:
                          - "null"
                          - string
                      tenantId:
                        type:
                          - "null"
                          - string
                      webUrl:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: teams/{{ stream_partition.group_id }}/channels
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    error_handler:
                      type: CompositeErrorHandler
                      error_handlers:
                        - type: DefaultErrorHandler
                          response_filters:
                            - type: HttpResponseFilter
                              action: IGNORE
                              predicate: "{{ 'No threadId found for TeamId' in response }}"
                              http_codes:
                                - 404
                              error_message: Resource not found for team Ids
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: NoPagination
                  partition_router:
                    - type: SubstreamPartitionRouter
                      parent_stream_configs:
                        - type: ParentStreamConfig
                          parent_key: id
                          partition_field: group_id
                          stream:
                            type: DeclarativeStream
                            name: groups
                            primary_key: []
                            schema_loader:
                              type: InlineSchemaLoader
                              schema:
                                $schema: http://json-schema.org/draft-07/schema#
                                additionalProperties: true
                                properties:
                                  classification:
                                    type:
                                      - "null"
                                      - string
                                  createdDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  creationOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  deletedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  description:
                                    type:
                                      - "null"
                                      - string
                                  displayName:
                                    type:
                                      - "null"
                                      - string
                                  expirationDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  groupTypes:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  id:
                                    type:
                                      - "null"
                                      - string
                                  isAssignableToRole:
                                    type:
                                      - "null"
                                      - boolean
                                  mail:
                                    type:
                                      - "null"
                                      - string
                                  mailEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  mailNickname:
                                    type:
                                      - "null"
                                      - string
                                  membershipRule:
                                    type:
                                      - "null"
                                      - string
                                  membershipRuleProcessingState:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesDomainName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesLastSyncDateTime:
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  onPremisesNetBiosName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesProvisioningErrors:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  onPremisesSamAccountName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSecurityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSyncEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  preferredDataLocation:
                                    type:
                                      - "null"
                                      - string
                                  preferredLanguage:
                                    type:
                                      - "null"
                                      - string
                                  proxyAddresses:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  renewedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  resourceBehaviorOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  resourceProvisioningOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  securityEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  securityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  serviceProvisioningErrors:
                                    items:
                                      properties:
                                        createdDateTime:
                                          airbyte_type: timestamp_without_timezone
                                          format: date-time
                                          type:
                                            - "null"
                                            - string
                                        isResolved:
                                          type:
                                            - "null"
                                            - boolean
                                        serviceInstance:
                                          type:
                                            - "null"
                                            - string
                                      type:
                                        - "null"
                                        - object
                                    type:
                                      - "null"
                                      - array
                                  theme:
                                    type:
                                      - "null"
                                      - string
                                  visibility:
                                    type:
                                      - "null"
                                      - string
                                type:
                                  - "null"
                                  - object
                            retriever:
                              type: SimpleRetriever
                              requester:
                                type: HttpRequester
                                url_base: https://graph.microsoft.com/v1.0/
                                path: groups?$top={{ config.get('page_size', 20) }}
                                http_method: GET
                                request_parameters: {}
                                request_headers: {}
                                authenticator:
                                  type: OAuthAuthenticator
                                  client_id: "{{ config['credentials']['client_id'] }}"
                                  client_secret:
                                    "{{ config['credentials']['client_secret']
                                    }}"
                                  refresh_request_body:
                                    scope: https://graph.microsoft.com/.default
                                  token_refresh_endpoint: >-
                                    https://login.microsoftonline.com/{{
                                    config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                  grant_type: client_credentials
                                  scopes: []
                                  access_token_name: access_token
                                request_body_json: {}
                              record_selector:
                                type: RecordSelector
                                extractor:
                                  type: DpathExtractor
                                  field_path:
                                    - value
                              paginator:
                                type: DefaultPaginator
                                page_token_option:
                                  type: RequestPath
                                pagination_strategy:
                                  type: CursorPagination
                                  cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                                  stop_condition: >-
                                    {{ not response.get("@odata.nextLink", {})
                                    }}
  - type: DeclarativeStream
    name: channel_tabs
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          channelId:
            type:
              - "null"
              - string
          configuration:
            additionalProperties: true
            properties:
              contentUrl:
                type:
                  - "null"
                  - string
              entityId:
                type:
                  - "null"
                  - string
              hasContent:
                type:
                  - "null"
                  - boolean
              removeUrl:
                type:
                  - "null"
                  - string
              websiteUrl:
                type:
                  - "null"
                  - string
              wikiDefaultTab:
                type:
                  - "null"
                  - boolean
              wikiTabId:
                type:
                  - "null"
                  - integer
            type:
              - "null"
              - object
          displayName:
            type:
              - "null"
              - string
          groupId:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          sortOrderIndex:
            type:
              - "null"
              - string
          teamsApp:
            additionalProperties: true
            properties:
              displayName:
                type:
                  - "null"
                  - string
              distributionMethod:
                type:
                  - "null"
                  - string
              id:
                type:
                  - "null"
                  - string
            type:
              - "null"
              - object
          webUrl:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          teams/{{ stream_partition.group_id }}/channels/{{
          stream_partition.channel_id }}/tabs
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  predicate: "{{ 'No Team found with Group id' in response }}"
                  http_codes:
                    - 404
                  error_message: Resource not found for group Ids
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: NoPagination
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: channel_id
              stream:
                type: DeclarativeStream
                name: channels
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type: string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      email:
                        type:
                          - "null"
                          - string
                      id:
                        type:
                          - "null"
                          - string
                      isFavoriteByDefault:
                        type:
                          - "null"
                          - boolean
                      membershipType:
                        type:
                          - "null"
                          - string
                      tenantId:
                        type:
                          - "null"
                          - string
                      webUrl:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: teams/{{ stream_partition.group_id }}/channels
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    error_handler:
                      type: CompositeErrorHandler
                      error_handlers:
                        - type: DefaultErrorHandler
                          response_filters:
                            - type: HttpResponseFilter
                              action: IGNORE
                              predicate: "{{ 'No threadId found for TeamId' in response }}"
                              http_codes:
                                - 404
                              error_message: Resource not found for team Ids
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: NoPagination
                  partition_router:
                    - type: SubstreamPartitionRouter
                      parent_stream_configs:
                        - type: ParentStreamConfig
                          parent_key: id
                          partition_field: group_id
                          stream:
                            type: DeclarativeStream
                            name: groups
                            primary_key: []
                            schema_loader:
                              type: InlineSchemaLoader
                              schema:
                                $schema: http://json-schema.org/draft-07/schema#
                                additionalProperties: true
                                properties:
                                  classification:
                                    type:
                                      - "null"
                                      - string
                                  createdDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  creationOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  deletedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  description:
                                    type:
                                      - "null"
                                      - string
                                  displayName:
                                    type:
                                      - "null"
                                      - string
                                  expirationDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  groupTypes:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  id:
                                    type:
                                      - "null"
                                      - string
                                  isAssignableToRole:
                                    type:
                                      - "null"
                                      - boolean
                                  mail:
                                    type:
                                      - "null"
                                      - string
                                  mailEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  mailNickname:
                                    type:
                                      - "null"
                                      - string
                                  membershipRule:
                                    type:
                                      - "null"
                                      - string
                                  membershipRuleProcessingState:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesDomainName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesLastSyncDateTime:
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  onPremisesNetBiosName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesProvisioningErrors:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  onPremisesSamAccountName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSecurityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSyncEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  preferredDataLocation:
                                    type:
                                      - "null"
                                      - string
                                  preferredLanguage:
                                    type:
                                      - "null"
                                      - string
                                  proxyAddresses:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  renewedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  resourceBehaviorOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  resourceProvisioningOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  securityEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  securityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  serviceProvisioningErrors:
                                    items:
                                      properties:
                                        createdDateTime:
                                          airbyte_type: timestamp_without_timezone
                                          format: date-time
                                          type:
                                            - "null"
                                            - string
                                        isResolved:
                                          type:
                                            - "null"
                                            - boolean
                                        serviceInstance:
                                          type:
                                            - "null"
                                            - string
                                      type:
                                        - "null"
                                        - object
                                    type:
                                      - "null"
                                      - array
                                  theme:
                                    type:
                                      - "null"
                                      - string
                                  visibility:
                                    type:
                                      - "null"
                                      - string
                                type:
                                  - "null"
                                  - object
                            retriever:
                              type: SimpleRetriever
                              requester:
                                type: HttpRequester
                                url_base: https://graph.microsoft.com/v1.0/
                                path: groups?$top={{ config.get('page_size', 20) }}
                                http_method: GET
                                request_parameters: {}
                                request_headers: {}
                                authenticator:
                                  type: OAuthAuthenticator
                                  client_id: "{{ config['credentials']['client_id'] }}"
                                  client_secret:
                                    "{{ config['credentials']['client_secret']
                                    }}"
                                  refresh_request_body:
                                    scope: https://graph.microsoft.com/.default
                                  token_refresh_endpoint: >-
                                    https://login.microsoftonline.com/{{
                                    config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                  grant_type: client_credentials
                                  scopes: []
                                  access_token_name: access_token
                                request_body_json: {}
                              record_selector:
                                type: RecordSelector
                                extractor:
                                  type: DpathExtractor
                                  field_path:
                                    - value
                              paginator:
                                type: DefaultPaginator
                                page_token_option:
                                  type: RequestPath
                                pagination_strategy:
                                  type: CursorPagination
                                  cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                                  stop_condition: >-
                                    {{ not response.get("@odata.nextLink", {})
                                    }}
  - type: DeclarativeStream
    name: conversation_threads
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          conversationId:
            type:
              - "null"
              - string
          groupId:
            type:
              - "null"
              - string
          hasAttachments:
            type:
              - "null"
              - boolean
          id:
            type:
              - "null"
              - string
          isLocked:
            type:
              - "null"
              - boolean
          lastDeliveredDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          preview:
            type:
              - "null"
              - string
          topic:
            type:
              - "null"
              - string
          uniqueSenders:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          groups/{{ stream_partition.group_id }}/conversations/{{
          stream_partition.conversation_id }}/threads?$top={{ config.get('page_size',
          20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  predicate: "{{ 'App Only access is not allowed' in response }}"
                  http_codes:
                    - 404
                    - 403
                  error_message: Some resources not found for parent resources
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: conversation_id
              stream:
                type: DeclarativeStream
                name: conversations
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      groupId:
                        type:
                          - "null"
                          - string
                      hasAttachments:
                        type:
                          - "null"
                          - boolean
                      id:
                        type:
                          - "null"
                          - string
                      lastDeliveredDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      preview:
                        type:
                          - "null"
                          - string
                      topic:
                        type:
                          - "null"
                          - string
                      uniqueSenders:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: >-
                      groups/{{ stream_partition.group_id
                      }}/conversations?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    error_handler:
                      type: CompositeErrorHandler
                      error_handlers:
                        - type: DefaultErrorHandler
                          response_filters:
                            - type: HttpResponseFilter
                              action: IGNORE
                              http_codes:
                                - 403
                              error_message: App only access is restricting some resources
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
                  partition_router:
                    - type: SubstreamPartitionRouter
                      parent_stream_configs:
                        - type: ParentStreamConfig
                          parent_key: id
                          partition_field: group_id
                          stream:
                            type: DeclarativeStream
                            name: groups
                            primary_key: []
                            schema_loader:
                              type: InlineSchemaLoader
                              schema:
                                $schema: http://json-schema.org/draft-07/schema#
                                additionalProperties: true
                                properties:
                                  classification:
                                    type:
                                      - "null"
                                      - string
                                  createdDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  creationOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  deletedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  description:
                                    type:
                                      - "null"
                                      - string
                                  displayName:
                                    type:
                                      - "null"
                                      - string
                                  expirationDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  groupTypes:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  id:
                                    type:
                                      - "null"
                                      - string
                                  isAssignableToRole:
                                    type:
                                      - "null"
                                      - boolean
                                  mail:
                                    type:
                                      - "null"
                                      - string
                                  mailEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  mailNickname:
                                    type:
                                      - "null"
                                      - string
                                  membershipRule:
                                    type:
                                      - "null"
                                      - string
                                  membershipRuleProcessingState:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesDomainName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesLastSyncDateTime:
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  onPremisesNetBiosName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesProvisioningErrors:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  onPremisesSamAccountName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSecurityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSyncEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  preferredDataLocation:
                                    type:
                                      - "null"
                                      - string
                                  preferredLanguage:
                                    type:
                                      - "null"
                                      - string
                                  proxyAddresses:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  renewedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  resourceBehaviorOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  resourceProvisioningOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  securityEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  securityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  serviceProvisioningErrors:
                                    items:
                                      properties:
                                        createdDateTime:
                                          airbyte_type: timestamp_without_timezone
                                          format: date-time
                                          type:
                                            - "null"
                                            - string
                                        isResolved:
                                          type:
                                            - "null"
                                            - boolean
                                        serviceInstance:
                                          type:
                                            - "null"
                                            - string
                                      type:
                                        - "null"
                                        - object
                                    type:
                                      - "null"
                                      - array
                                  theme:
                                    type:
                                      - "null"
                                      - string
                                  visibility:
                                    type:
                                      - "null"
                                      - string
                                type:
                                  - "null"
                                  - object
                            retriever:
                              type: SimpleRetriever
                              requester:
                                type: HttpRequester
                                url_base: https://graph.microsoft.com/v1.0/
                                path: groups?$top={{ config.get('page_size', 20) }}
                                http_method: GET
                                request_parameters: {}
                                request_headers: {}
                                authenticator:
                                  type: OAuthAuthenticator
                                  client_id: "{{ config['credentials']['client_id'] }}"
                                  client_secret:
                                    "{{ config['credentials']['client_secret']
                                    }}"
                                  refresh_request_body:
                                    scope: https://graph.microsoft.com/.default
                                  token_refresh_endpoint: >-
                                    https://login.microsoftonline.com/{{
                                    config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                  grant_type: client_credentials
                                  scopes: []
                                  access_token_name: access_token
                                request_body_json: {}
                              record_selector:
                                type: RecordSelector
                                extractor:
                                  type: DpathExtractor
                                  field_path:
                                    - value
                              paginator:
                                type: DefaultPaginator
                                page_token_option:
                                  type: RequestPath
                                pagination_strategy:
                                  type: CursorPagination
                                  cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                                  stop_condition: >-
                                    {{ not response.get("@odata.nextLink", {})
                                    }}
  - type: DeclarativeStream
    name: conversation_posts
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          "@odata.etag":
            type:
              - "null"
              - string
          body:
            additionalProperties: true
            properties:
              content:
                type:
                  - "null"
                  - string
              contentType:
                type:
                  - "null"
                  - string
            type:
              - "null"
              - object
          categories:
            items:
              type:
                - "null"
                - string
            type:
              - "null"
              - array
          changeKey:
            type:
              - "null"
              - string
          conversationId:
            type:
              - "null"
              - string
          createdDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          from:
            additionalProperties: true
            properties:
              emailAddress:
                properties:
                  address:
                    type:
                      - "null"
                      - string
                  name:
                    type:
                      - "null"
                      - string
                type:
                  - "null"
                  - object
            type:
              - "null"
              - object
          hasAttachments:
            type:
              - "null"
              - boolean
          id:
            type:
              - "null"
              - string
          lastModifiedDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          receivedDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          sender:
            additionalProperties: true
            properties:
              emailAddress:
                additionalProperties: true
                properties:
                  address:
                    type:
                      - "null"
                      - string
                  name:
                    type:
                      - "null"
                      - string
                type:
                  - "null"
                  - object
            type:
              - "null"
              - object
          threadId:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          groups/{{ stream_partition.group_id }}/conversations/{{
          stream_partition.conversation_id }}/threads/{{
          stream_partition.thread_id }}/posts?$top={{ config.get('page_size', 20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  predicate: "{{ 'App Only access is not allowed' in response }}"
                  http_codes:
                    - 404
                    - 403
                    - 503
                  error_message: Some resources are not allowed to extract
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: conversation_id
              stream:
                type: DeclarativeStream
                name: conversations
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      groupId:
                        type:
                          - "null"
                          - string
                      hasAttachments:
                        type:
                          - "null"
                          - boolean
                      id:
                        type:
                          - "null"
                          - string
                      lastDeliveredDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      preview:
                        type:
                          - "null"
                          - string
                      topic:
                        type:
                          - "null"
                          - string
                      uniqueSenders:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: >-
                      groups/{{ stream_partition.group_id
                      }}/conversations?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    error_handler:
                      type: CompositeErrorHandler
                      error_handlers:
                        - type: DefaultErrorHandler
                          response_filters:
                            - type: HttpResponseFilter
                              action: IGNORE
                              http_codes:
                                - 403
                              error_message: App only access is restricting some resources
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
                  partition_router:
                    - type: SubstreamPartitionRouter
                      parent_stream_configs:
                        - type: ParentStreamConfig
                          parent_key: id
                          partition_field: group_id
                          stream:
                            type: DeclarativeStream
                            name: groups
                            primary_key: []
                            schema_loader:
                              type: InlineSchemaLoader
                              schema:
                                $schema: http://json-schema.org/draft-07/schema#
                                additionalProperties: true
                                properties:
                                  classification:
                                    type:
                                      - "null"
                                      - string
                                  createdDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  creationOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  deletedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  description:
                                    type:
                                      - "null"
                                      - string
                                  displayName:
                                    type:
                                      - "null"
                                      - string
                                  expirationDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  groupTypes:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  id:
                                    type:
                                      - "null"
                                      - string
                                  isAssignableToRole:
                                    type:
                                      - "null"
                                      - boolean
                                  mail:
                                    type:
                                      - "null"
                                      - string
                                  mailEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  mailNickname:
                                    type:
                                      - "null"
                                      - string
                                  membershipRule:
                                    type:
                                      - "null"
                                      - string
                                  membershipRuleProcessingState:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesDomainName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesLastSyncDateTime:
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  onPremisesNetBiosName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesProvisioningErrors:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  onPremisesSamAccountName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSecurityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSyncEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  preferredDataLocation:
                                    type:
                                      - "null"
                                      - string
                                  preferredLanguage:
                                    type:
                                      - "null"
                                      - string
                                  proxyAddresses:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  renewedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  resourceBehaviorOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  resourceProvisioningOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  securityEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  securityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  serviceProvisioningErrors:
                                    items:
                                      properties:
                                        createdDateTime:
                                          airbyte_type: timestamp_without_timezone
                                          format: date-time
                                          type:
                                            - "null"
                                            - string
                                        isResolved:
                                          type:
                                            - "null"
                                            - boolean
                                        serviceInstance:
                                          type:
                                            - "null"
                                            - string
                                      type:
                                        - "null"
                                        - object
                                    type:
                                      - "null"
                                      - array
                                  theme:
                                    type:
                                      - "null"
                                      - string
                                  visibility:
                                    type:
                                      - "null"
                                      - string
                                type:
                                  - "null"
                                  - object
                            retriever:
                              type: SimpleRetriever
                              requester:
                                type: HttpRequester
                                url_base: https://graph.microsoft.com/v1.0/
                                path: groups?$top={{ config.get('page_size', 20) }}
                                http_method: GET
                                request_parameters: {}
                                request_headers: {}
                                authenticator:
                                  type: OAuthAuthenticator
                                  client_id: "{{ config['credentials']['client_id'] }}"
                                  client_secret:
                                    "{{ config['credentials']['client_secret']
                                    }}"
                                  refresh_request_body:
                                    scope: https://graph.microsoft.com/.default
                                  token_refresh_endpoint: >-
                                    https://login.microsoftonline.com/{{
                                    config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                  grant_type: client_credentials
                                  scopes: []
                                  access_token_name: access_token
                                request_body_json: {}
                              record_selector:
                                type: RecordSelector
                                extractor:
                                  type: DpathExtractor
                                  field_path:
                                    - value
                              paginator:
                                type: DefaultPaginator
                                page_token_option:
                                  type: RequestPath
                                pagination_strategy:
                                  type: CursorPagination
                                  cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                                  stop_condition: >-
                                    {{ not response.get("@odata.nextLink", {})
                                    }}
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: thread_id
              stream:
                type: DeclarativeStream
                name: conversation_threads
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      conversationId:
                        type:
                          - "null"
                          - string
                      groupId:
                        type:
                          - "null"
                          - string
                      hasAttachments:
                        type:
                          - "null"
                          - boolean
                      id:
                        type:
                          - "null"
                          - string
                      isLocked:
                        type:
                          - "null"
                          - boolean
                      lastDeliveredDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      preview:
                        type:
                          - "null"
                          - string
                      topic:
                        type:
                          - "null"
                          - string
                      uniqueSenders:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: >-
                      groups/{{ stream_partition.group_id }}/conversations/{{
                      stream_partition.conversation_id }}/threads?$top={{ config.get('page_size',
                      20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    error_handler:
                      type: CompositeErrorHandler
                      error_handlers:
                        - type: DefaultErrorHandler
                          response_filters:
                            - type: HttpResponseFilter
                              action: IGNORE
                              predicate: >-
                                {{ 'App Only access is not allowed' in response
                                }}
                              http_codes:
                                - 404
                                - 403
                              error_message: Some resources not found for parent resources
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
                  partition_router:
                    - type: SubstreamPartitionRouter
                      parent_stream_configs:
                        - type: ParentStreamConfig
                          parent_key: id
                          partition_field: group_id
                          stream:
                            type: DeclarativeStream
                            name: groups
                            primary_key: []
                            schema_loader:
                              type: InlineSchemaLoader
                              schema:
                                $schema: http://json-schema.org/draft-07/schema#
                                additionalProperties: true
                                properties:
                                  classification:
                                    type:
                                      - "null"
                                      - string
                                  createdDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  creationOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  deletedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  description:
                                    type:
                                      - "null"
                                      - string
                                  displayName:
                                    type:
                                      - "null"
                                      - string
                                  expirationDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  groupTypes:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  id:
                                    type:
                                      - "null"
                                      - string
                                  isAssignableToRole:
                                    type:
                                      - "null"
                                      - boolean
                                  mail:
                                    type:
                                      - "null"
                                      - string
                                  mailEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  mailNickname:
                                    type:
                                      - "null"
                                      - string
                                  membershipRule:
                                    type:
                                      - "null"
                                      - string
                                  membershipRuleProcessingState:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesDomainName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesLastSyncDateTime:
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  onPremisesNetBiosName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesProvisioningErrors:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  onPremisesSamAccountName:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSecurityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  onPremisesSyncEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  preferredDataLocation:
                                    type:
                                      - "null"
                                      - string
                                  preferredLanguage:
                                    type:
                                      - "null"
                                      - string
                                  proxyAddresses:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  renewedDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  resourceBehaviorOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  resourceProvisioningOptions:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                  securityEnabled:
                                    type:
                                      - "null"
                                      - boolean
                                  securityIdentifier:
                                    type:
                                      - "null"
                                      - string
                                  serviceProvisioningErrors:
                                    items:
                                      properties:
                                        createdDateTime:
                                          airbyte_type: timestamp_without_timezone
                                          format: date-time
                                          type:
                                            - "null"
                                            - string
                                        isResolved:
                                          type:
                                            - "null"
                                            - boolean
                                        serviceInstance:
                                          type:
                                            - "null"
                                            - string
                                      type:
                                        - "null"
                                        - object
                                    type:
                                      - "null"
                                      - array
                                  theme:
                                    type:
                                      - "null"
                                      - string
                                  visibility:
                                    type:
                                      - "null"
                                      - string
                                type:
                                  - "null"
                                  - object
                            retriever:
                              type: SimpleRetriever
                              requester:
                                type: HttpRequester
                                url_base: https://graph.microsoft.com/v1.0/
                                path: groups?$top={{ config.get('page_size', 20) }}
                                http_method: GET
                                request_parameters: {}
                                request_headers: {}
                                authenticator:
                                  type: OAuthAuthenticator
                                  client_id: "{{ config['credentials']['client_id'] }}"
                                  client_secret:
                                    "{{ config['credentials']['client_secret']
                                    }}"
                                  refresh_request_body:
                                    scope: https://graph.microsoft.com/.default
                                  token_refresh_endpoint: >-
                                    https://login.microsoftonline.com/{{
                                    config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                  grant_type: client_credentials
                                  scopes: []
                                  access_token_name: access_token
                                request_body_json: {}
                              record_selector:
                                type: RecordSelector
                                extractor:
                                  type: DpathExtractor
                                  field_path:
                                    - value
                              paginator:
                                type: DefaultPaginator
                                page_token_option:
                                  type: RequestPath
                                pagination_strategy:
                                  type: CursorPagination
                                  cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                                  stop_condition: >-
                                    {{ not response.get("@odata.nextLink", {})
                                    }}
                    - type: SubstreamPartitionRouter
                      parent_stream_configs:
                        - type: ParentStreamConfig
                          parent_key: id
                          partition_field: conversation_id
                          stream:
                            type: DeclarativeStream
                            name: conversations
                            primary_key: []
                            schema_loader:
                              type: InlineSchemaLoader
                              schema:
                                $schema: http://json-schema.org/draft-07/schema#
                                additionalProperties: true
                                properties:
                                  groupId:
                                    type:
                                      - "null"
                                      - string
                                  hasAttachments:
                                    type:
                                      - "null"
                                      - boolean
                                  id:
                                    type:
                                      - "null"
                                      - string
                                  lastDeliveredDateTime:
                                    airbyte_type: timestamp_without_timezone
                                    format: date-time
                                    type:
                                      - "null"
                                      - string
                                  preview:
                                    type:
                                      - "null"
                                      - string
                                  topic:
                                    type:
                                      - "null"
                                      - string
                                  uniqueSenders:
                                    items:
                                      type:
                                        - "null"
                                        - string
                                    type:
                                      - "null"
                                      - array
                                type:
                                  - "null"
                                  - object
                            retriever:
                              type: SimpleRetriever
                              requester:
                                type: HttpRequester
                                url_base: https://graph.microsoft.com/v1.0/
                                path: >-
                                  groups/{{ stream_partition.group_id
                                  }}/conversations?$top={{ config.get('page_size', 20) }}
                                http_method: GET
                                request_parameters: {}
                                request_headers: {}
                                authenticator:
                                  type: OAuthAuthenticator
                                  client_id: "{{ config['credentials']['client_id'] }}"
                                  client_secret:
                                    "{{ config['credentials']['client_secret']
                                    }}"
                                  refresh_request_body:
                                    scope: https://graph.microsoft.com/.default
                                  token_refresh_endpoint: >-
                                    https://login.microsoftonline.com/{{
                                    config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                  grant_type: client_credentials
                                  scopes: []
                                  access_token_name: access_token
                                error_handler:
                                  type: CompositeErrorHandler
                                  error_handlers:
                                    - type: DefaultErrorHandler
                                      response_filters:
                                        - type: HttpResponseFilter
                                          action: IGNORE
                                          http_codes:
                                            - 403
                                          error_message: >-
                                            App only access is restricting some
                                            resources
                                request_body_json: {}
                              record_selector:
                                type: RecordSelector
                                extractor:
                                  type: DpathExtractor
                                  field_path:
                                    - value
                              paginator:
                                type: DefaultPaginator
                                page_token_option:
                                  type: RequestPath
                                pagination_strategy:
                                  type: CursorPagination
                                  cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                                  stop_condition: >-
                                    {{ not response.get("@odata.nextLink", {})
                                    }}
                              partition_router:
                                - type: SubstreamPartitionRouter
                                  parent_stream_configs:
                                    - type: ParentStreamConfig
                                      parent_key: id
                                      partition_field: group_id
                                      stream:
                                        type: DeclarativeStream
                                        name: groups
                                        primary_key: []
                                        schema_loader:
                                          type: InlineSchemaLoader
                                          schema:
                                            $schema: http://json-schema.org/draft-07/schema#
                                            additionalProperties: true
                                            properties:
                                              classification:
                                                type:
                                                  - "null"
                                                  - string
                                              createdDateTime:
                                                airbyte_type: timestamp_without_timezone
                                                format: date-time
                                                type:
                                                  - "null"
                                                  - string
                                              creationOptions:
                                                items:
                                                  type:
                                                    - "null"
                                                    - string
                                                type:
                                                  - "null"
                                                  - array
                                              deletedDateTime:
                                                airbyte_type: timestamp_without_timezone
                                                format: date-time
                                                type:
                                                  - "null"
                                                  - string
                                              description:
                                                type:
                                                  - "null"
                                                  - string
                                              displayName:
                                                type:
                                                  - "null"
                                                  - string
                                              expirationDateTime:
                                                airbyte_type: timestamp_without_timezone
                                                format: date-time
                                                type:
                                                  - "null"
                                                  - string
                                              groupTypes:
                                                items:
                                                  type:
                                                    - "null"
                                                    - string
                                                type:
                                                  - "null"
                                                  - array
                                              id:
                                                type:
                                                  - "null"
                                                  - string
                                              isAssignableToRole:
                                                type:
                                                  - "null"
                                                  - boolean
                                              mail:
                                                type:
                                                  - "null"
                                                  - string
                                              mailEnabled:
                                                type:
                                                  - "null"
                                                  - boolean
                                              mailNickname:
                                                type:
                                                  - "null"
                                                  - string
                                              membershipRule:
                                                type:
                                                  - "null"
                                                  - string
                                              membershipRuleProcessingState:
                                                type:
                                                  - "null"
                                                  - string
                                              onPremisesDomainName:
                                                type:
                                                  - "null"
                                                  - string
                                              onPremisesLastSyncDateTime:
                                                format: date-time
                                                type:
                                                  - "null"
                                                  - string
                                              onPremisesNetBiosName:
                                                type:
                                                  - "null"
                                                  - string
                                              onPremisesProvisioningErrors:
                                                items:
                                                  type:
                                                    - "null"
                                                    - string
                                                type:
                                                  - "null"
                                                  - array
                                              onPremisesSamAccountName:
                                                type:
                                                  - "null"
                                                  - string
                                              onPremisesSecurityIdentifier:
                                                type:
                                                  - "null"
                                                  - string
                                              onPremisesSyncEnabled:
                                                type:
                                                  - "null"
                                                  - boolean
                                              preferredDataLocation:
                                                type:
                                                  - "null"
                                                  - string
                                              preferredLanguage:
                                                type:
                                                  - "null"
                                                  - string
                                              proxyAddresses:
                                                items:
                                                  type:
                                                    - "null"
                                                    - string
                                                type:
                                                  - "null"
                                                  - array
                                              renewedDateTime:
                                                airbyte_type: timestamp_without_timezone
                                                format: date-time
                                                type:
                                                  - "null"
                                                  - string
                                              resourceBehaviorOptions:
                                                items:
                                                  type:
                                                    - "null"
                                                    - string
                                                type:
                                                  - "null"
                                                  - array
                                              resourceProvisioningOptions:
                                                items:
                                                  type:
                                                    - "null"
                                                    - string
                                                type:
                                                  - "null"
                                                  - array
                                              securityEnabled:
                                                type:
                                                  - "null"
                                                  - boolean
                                              securityIdentifier:
                                                type:
                                                  - "null"
                                                  - string
                                              serviceProvisioningErrors:
                                                items:
                                                  properties:
                                                    createdDateTime:
                                                      airbyte_type: timestamp_without_timezone
                                                      format: date-time
                                                      type:
                                                        - "null"
                                                        - string
                                                    isResolved:
                                                      type:
                                                        - "null"
                                                        - boolean
                                                    serviceInstance:
                                                      type:
                                                        - "null"
                                                        - string
                                                  type:
                                                    - "null"
                                                    - object
                                                type:
                                                  - "null"
                                                  - array
                                              theme:
                                                type:
                                                  - "null"
                                                  - string
                                              visibility:
                                                type:
                                                  - "null"
                                                  - string
                                            type:
                                              - "null"
                                              - object
                                        retriever:
                                          type: SimpleRetriever
                                          requester:
                                            type: HttpRequester
                                            url_base: https://graph.microsoft.com/v1.0/
                                            path: groups?$top={{ config.get('page_size', 20) }}
                                            http_method: GET
                                            request_parameters: {}
                                            request_headers: {}
                                            authenticator:
                                              type: OAuthAuthenticator
                                              client_id:
                                                "{{ config['credentials']['client_id']
                                                }}"
                                              client_secret:
                                                "{{ config['credentials']['client_secret']
                                                }}"
                                              refresh_request_body:
                                                scope: https://graph.microsoft.com/.default
                                              token_refresh_endpoint: >-
                                                https://login.microsoftonline.com/{{
                                                config['credentials']['tenant_id'] }}/oauth2/v2.0/token
                                              grant_type: client_credentials
                                              scopes: []
                                              access_token_name: access_token
                                            request_body_json: {}
                                          record_selector:
                                            type: RecordSelector
                                            extractor:
                                              type: DpathExtractor
                                              field_path:
                                                - value
                                          paginator:
                                            type: DefaultPaginator
                                            page_token_option:
                                              type: RequestPath
                                            pagination_strategy:
                                              type: CursorPagination
                                              cursor_value: >-
                                                {{ response.get("@odata.nextLink", {})
                                                }}
                                              stop_condition: >-
                                                {{ not response.get("@odata.nextLink",
                                                {}) }}
  - type: DeclarativeStream
    name: team_drives
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          createdBy:
            additionalProperties: true
            properties:
              user:
                additionalProperties: true
                properties:
                  displayName:
                    type:
                      - "null"
                      - string
                type:
                  - "null"
                  - object
            type:
              - "null"
              - object
          createdDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
          driveType:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          lastModifiedBy:
            additionalProperties: true
            properties:
              displayName:
                type:
                  - "null"
                  - string
              id:
                type:
                  - "null"
                  - string
            type:
              - "null"
              - object
          lastModifiedDateTime:
            airbyte_type: timestamp_without_timezone
            format: date-time
            type:
              - "null"
              - string
          name:
            type:
              - "null"
              - string
          owner:
            additionalProperties: true
            properties:
              group:
                additionalProperties: true
                properties:
                  displayName:
                    type:
                      - "null"
                      - string
                  email:
                    type:
                      - "null"
                      - string
                  id:
                    type:
                      - "null"
                      - string
                type:
                  - "null"
                  - object
            type:
              - "null"
              - object
          quota:
            additionalProperties: true
            properties:
              deleted:
                type:
                  - "null"
                  - integer
              remaining:
                type:
                  - "null"
                  - number
              state:
                type:
                  - "null"
                  - string
              total:
                type:
                  - "null"
                  - number
              used:
                type:
                  - "null"
                  - integer
            type:
              - "null"
              - object
          webUrl:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          groups/{{ stream_partition.group_id }}/drives?$top={{ config.get('page_size',
          20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                  error_message: Some resources are not found or not allowed to access
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
      partition_router:
        - type: SubstreamPartitionRouter
          parent_stream_configs:
            - type: ParentStreamConfig
              parent_key: id
              partition_field: group_id
              stream:
                type: DeclarativeStream
                name: groups
                primary_key: []
                schema_loader:
                  type: InlineSchemaLoader
                  schema:
                    $schema: http://json-schema.org/draft-07/schema#
                    additionalProperties: true
                    properties:
                      classification:
                        type:
                          - "null"
                          - string
                      createdDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      creationOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      deletedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      description:
                        type:
                          - "null"
                          - string
                      displayName:
                        type:
                          - "null"
                          - string
                      expirationDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      groupTypes:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      id:
                        type:
                          - "null"
                          - string
                      isAssignableToRole:
                        type:
                          - "null"
                          - boolean
                      mail:
                        type:
                          - "null"
                          - string
                      mailEnabled:
                        type:
                          - "null"
                          - boolean
                      mailNickname:
                        type:
                          - "null"
                          - string
                      membershipRule:
                        type:
                          - "null"
                          - string
                      membershipRuleProcessingState:
                        type:
                          - "null"
                          - string
                      onPremisesDomainName:
                        type:
                          - "null"
                          - string
                      onPremisesLastSyncDateTime:
                        format: date-time
                        type:
                          - "null"
                          - string
                      onPremisesNetBiosName:
                        type:
                          - "null"
                          - string
                      onPremisesProvisioningErrors:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      onPremisesSamAccountName:
                        type:
                          - "null"
                          - string
                      onPremisesSecurityIdentifier:
                        type:
                          - "null"
                          - string
                      onPremisesSyncEnabled:
                        type:
                          - "null"
                          - boolean
                      preferredDataLocation:
                        type:
                          - "null"
                          - string
                      preferredLanguage:
                        type:
                          - "null"
                          - string
                      proxyAddresses:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      renewedDateTime:
                        airbyte_type: timestamp_without_timezone
                        format: date-time
                        type:
                          - "null"
                          - string
                      resourceBehaviorOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      resourceProvisioningOptions:
                        items:
                          type:
                            - "null"
                            - string
                        type:
                          - "null"
                          - array
                      securityEnabled:
                        type:
                          - "null"
                          - boolean
                      securityIdentifier:
                        type:
                          - "null"
                          - string
                      serviceProvisioningErrors:
                        items:
                          properties:
                            createdDateTime:
                              airbyte_type: timestamp_without_timezone
                              format: date-time
                              type:
                                - "null"
                                - string
                            isResolved:
                              type:
                                - "null"
                                - boolean
                            serviceInstance:
                              type:
                                - "null"
                                - string
                          type:
                            - "null"
                            - object
                        type:
                          - "null"
                          - array
                      theme:
                        type:
                          - "null"
                          - string
                      visibility:
                        type:
                          - "null"
                          - string
                    type:
                      - "null"
                      - object
                retriever:
                  type: SimpleRetriever
                  requester:
                    type: HttpRequester
                    url_base: https://graph.microsoft.com/v1.0/
                    path: groups?$top={{ config.get('page_size', 20) }}
                    http_method: GET
                    request_parameters: {}
                    request_headers: {}
                    authenticator:
                      type: OAuthAuthenticator
                      client_id: "{{ config['credentials']['client_id'] }}"
                      client_secret: "{{ config['credentials']['client_secret'] }}"
                      refresh_request_body:
                        scope: https://graph.microsoft.com/.default
                      token_refresh_endpoint: >-
                        https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
                        }}/oauth2/v2.0/token
                      grant_type: client_credentials
                      scopes: []
                      access_token_name: access_token
                    request_body_json: {}
                  record_selector:
                    type: RecordSelector
                    extractor:
                      type: DpathExtractor
                      field_path:
                        - value
                  paginator:
                    type: DefaultPaginator
                    page_token_option:
                      type: RequestPath
                    pagination_strategy:
                      type: CursorPagination
                      cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
                      stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
  - type: DeclarativeStream
    name: team_device_usage_report
    primary_key: []
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        additionalProperties: true
        properties:
          deletedDate:
            type:
              - "null"
              - string
          isDeleted:
            type:
              - "null"
              - string
          isLisenced:
            type:
              - "null"
              - string
          lastActivityDate:
            type:
              - "null"
              - string
          reportPeriod:
            type:
              - "null"
              - string
          reportRefreshDate:
            format: date
            type:
              - "null"
              - string
          usedAndroidPhone:
            type:
              - "null"
              - string
          usedChromeOS:
            type:
              - "null"
              - string
          usedIOs:
            type:
              - "null"
              - string
          usedLinux:
            type:
              - "null"
              - string
          usedMac:
            type:
              - "null"
              - string
          usedWeb:
            type:
              - "null"
              - string
          usedWindows:
            type:
              - "null"
              - string
          usedWindowsPhone:
            type:
              - "null"
              - string
          userId:
            type:
              - "null"
              - string
          userPrincipalName:
            type:
              - "null"
              - string
        type:
          - "null"
          - object
    retriever:
      type: SimpleRetriever
      requester:
        type: HttpRequester
        url_base: https://graph.microsoft.com/v1.0/
        path: >-
          reports/getTeamsDeviceUsageUserDetail(period='{{ config['period']
          }}')?$top={{ config.get('page_size', 20) }}
        http_method: GET
        request_parameters: {}
        request_headers: {}
        authenticator:
          type: OAuthAuthenticator
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_request_body:
            scope: https://graph.microsoft.com/.default
          token_refresh_endpoint: >-
            https://login.microsoftonline.com/{{ config['credentials']['tenant_id']
            }}/oauth2/v2.0/token
          grant_type: client_credentials
          scopes: []
          access_token_name: access_token
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 400
                  error_message: Personal account not supported
        request_body_json: {}
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - value
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestPath
        pagination_strategy:
          type: CursorPagination
          cursor_value: '{{ response.get("@odata.nextLink", {}) }}'
          stop_condition: '{{ not response.get("@odata.nextLink", {}) }}'
spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/microsoft-teams
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Microsoft Teams Spec
    type: object
    required:
      - period
    additionalProperties: true
    properties:
      period:
        type: string
        title: Period
        description:
          "Specifies the length of time over which the Team Device Report
          stream is aggregated. The supported values are: D7, D30, D90, and D180."
        examples:
          - D7
      credentials:
        title: Authentication mechanism
        description: Choose how to authenticate to Microsoft
        type: object
        oneOf:
          - type: object
            title: Authenticate via Microsoft (OAuth 2.0)
            required:
              - tenant_id
              - client_id
              - client_secret
              - refresh_token
            properties:
              auth_type:
                type: string
                const: Client
                enum:
                  - Client
                default: Client
                order: 0
              tenant_id:
                title: Directory (tenant) ID
                type: string
                description:
                  "A globally unique identifier (GUID) that is different
                  than your organization name or domain. Follow these steps to obtain:
                  open one of the Teams where you belong inside the Teams Application
                  -> Click on the  next to the Team title -> Click on Get link to team
                  -> Copy the link to the team and grab the tenant ID form the URL"
                airbyte_secret: true
              client_id:
                title: Client ID
                type: string
                description: The Client ID of your Microsoft Teams developer application.
              client_secret:
                title: Client Secret
                type: string
                description: The Client Secret of your Microsoft Teams developer application.
                airbyte_secret: true
              refresh_token:
                title: Refresh Token
                type: string
                description: A Refresh Token to renew the expired Access Token.
                airbyte_secret: true
          - type: object
            title: Authenticate via Microsoft
            required:
              - tenant_id
              - client_id
              - client_secret
            properties:
              auth_type:
                type: string
                const: Token
                enum:
                  - Token
                default: Token
                order: 0
              tenant_id:
                title: Directory (tenant) ID
                type: string
                description:
                  "A globally unique identifier (GUID) that is different
                  than your organization name or domain. Follow these steps to obtain:
                  open one of the Teams where you belong inside the Teams Application
                  -> Click on the  next to the Team title -> Click on Get link to team
                  -> Copy the link to the team and grab the tenant ID form the URL"
                airbyte_secret: true
              client_id:
                title: Client ID
                type: string
                description: The Client ID of your Microsoft Teams developer application.
              client_secret:
                title: Client Secret
                type: string
                description: The Client Secret of your Microsoft Teams developer application.
                airbyte_secret: true
  advanced_auth:
    auth_flow_type: oauth2.0
    predicate_key:
      - credentials
      - auth_type
    predicate_value: Client
    oauth_config_specification:
      complete_oauth_output_specification:
        type: object
        additionalProperties: false
        properties:
          refresh_token:
            type: string
            path_in_connector_config:
              - credentials
              - refresh_token
      complete_oauth_server_input_specification:
        type: object
        additionalProperties: false
        properties:
          client_id:
            type: string
          client_secret:
            type: string
      complete_oauth_server_output_specification:
        type: object
        additionalProperties: false
        properties:
          client_id:
            type: string
            path_in_connector_config:
              - credentials
              - client_id
          client_secret:
            type: string
            path_in_connector_config:
              - credentials
              - client_secret
      oauth_user_input_from_connector_config_specification:
        type: object
        additionalProperties: false
        properties:
          tenant_id:
            type: string
            path_in_connector_config:
              - credentials
              - tenant_id
metadata:
  autoImportSchema:
    users: false
    groups: false
    group_members: false
    group_owners: false
    conversations: false
    channels: false
    channel_members: false
    channel_tabs: false
    conversation_threads: false
    conversation_posts: false
    team_drives: false
    team_device_usage_report: false
