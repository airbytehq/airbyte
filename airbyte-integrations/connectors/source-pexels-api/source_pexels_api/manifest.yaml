version: "0.29.0"

definitions:
  selector:
    extractor:
      field_path: []

  requester_stream:
    request_parameters:
      query: |
        {{
          config['query']
          if parameters['name'] == 'photos_search' or parameters['name'] == 'videos_search'
          else ''
        }}
      orientation: |
        {{
          config['orientation']
          if parameters['name'] == 'photos_search' or parameters['name'] == 'videos_search'
          else ''
        }}
      size: |
        {{
          config['size']
          if parameters['name'] == 'photos_search' or parameters['name'] == 'videos_search'
          else ''
        }}
      locale: |
        {{
          config['locale']
          if parameters['name'] == 'photos_search' or parameters['name'] == 'videos_search'
          else ''
        }}
      color: |
        {{
          config['color']
          if parameters['name'] == 'photos_search'
          else ''
        }}

  requester:
    url_base: "https://api.pexels.com"
    http_method: "GET"
    request_parameters:
      $ref: "#/definitions/requester_stream/request_parameters"
    authenticator:
      type: ApiKeyAuthenticator
      header: "Authorization"
      api_token: "{{ config['api_key'] }}"
    error_handler:
      type: CompositeErrorHandler
      error_handlers:
        - type: DefaultErrorHandler
          response_filters:
            - http_codes: [500]
              action: FAIL

  retriever:
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"

  base_stream:
    retriever:
      $ref: "#/definitions/retriever"

  page_stream:
    retriever:
      record_selector:
        $ref: "#/definitions/selector"
      paginator:
        type: "DefaultPaginator"
        pagination_strategy:
          type: "PageIncrement"
          page_size: 1000
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "page"
        page_size_option:
          inject_into: "request_parameter"
          field_name: "per_page"
      requester:
        $ref: "#/definitions/requester"

  photos_search_stream:
    $ref: "#/definitions/page_stream"
    $parameters:
      name: "photos_search"
      path: "/v1/search"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        definitions: {}
        $schema: http://json-schema.org/draft-07/schema#
        $id: https://example.com/object1667402697.json
        title: Root
        type: object
        properties:
          page:
            $id: "#root/page"
            title: Page
            type: integer
            default: 0
          per_page:
            $id: "#root/per_page"
            title: Per_page
            type: integer
            default: 0
          photos:
            $id: "#root/photos"
            title: Photos
            type: array
            default: []
            items:
              $id: "#root/photos/items"
              title: Items
              type: object
              properties:
                id:
                  $id: "#root/photos/items/id"
                  title: Id
                  type: integer
                  default: 0
                width:
                  $id: "#root/photos/items/width"
                  title: Width
                  type: integer
                  default: 0
                height:
                  $id: "#root/photos/items/height"
                  title: Height
                  type: integer
                  default: 0
                url:
                  $id: "#root/photos/items/url"
                  title: Url
                  type: string
                  default: ""
                  pattern: ^.*$
                photographer:
                  $id: "#root/photos/items/photographer"
                  title: Photographer
                  type: string
                  default: ""
                  pattern: ^.*$
                photographer_url:
                  $id: "#root/photos/items/photographer_url"
                  title: Photographer_url
                  type: string
                  default: ""
                  pattern: ^.*$
                photographer_id:
                  $id: "#root/photos/items/photographer_id"
                  title: Photographer_id
                  type: integer
                  default: 0
                avg_color:
                  $id: "#root/photos/items/avg_color"
                  title: Avg_color
                  type: string
                  default: ""
                  pattern: ^.*$
                src:
                  $id: "#root/photos/items/src"
                  title: Src
                  type: object
                  properties:
                    original:
                      $id: "#root/photos/items/src/original"
                      title: Original
                      type: string
                      default: ""
                      pattern: ^.*$
                    large2x:
                      $id: "#root/photos/items/src/large2x"
                      title: Large2x
                      type: string
                      default: ""
                      pattern: ^.*$
                    large:
                      $id: "#root/photos/items/src/large"
                      title: Large
                      type: string
                      default: ""
                      pattern: ^.*$
                    medium:
                      $id: "#root/photos/items/src/medium"
                      title: Medium
                      type: string
                      default: ""
                      pattern: ^.*$
                    small:
                      $id: "#root/photos/items/src/small"
                      title: Small
                      type: string
                      default: ""
                      pattern: ^.*$
                    portrait:
                      $id: "#root/photos/items/src/portrait"
                      title: Portrait
                      type: string
                      default: ""
                      pattern: ^.*$
                    landscape:
                      $id: "#root/photos/items/src/landscape"
                      title: Landscape
                      type: string
                      default: ""
                      pattern: ^.*$
                    tiny:
                      $id: "#root/photos/items/src/tiny"
                      title: Tiny
                      type: string
                      default: ""
                      pattern: ^.*$
                liked:
                  $id: "#root/photos/items/liked"
                  title: Liked
                  type: boolean
                  default: true
                alt:
                  $id: "#root/photos/items/alt"
                  title: Alt
                  type: string
                  default: ""
                  pattern: ^.*$
          total_results:
            $id: "#root/total_results"
            title: Total_results
            type: integer
            default: 0
          next_page:
            $id: "#root/next_page"
            title: Next_page
            type: string
            default: ""
            pattern: ^.*$
  photos_curated_stream:
    $ref: "#/definitions/page_stream"
    $parameters:
      name: "photos_curated"
      path: "/v1/curated"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        definitions: {}
        $schema: http://json-schema.org/draft-07/schema#
        $id: https://example.com/object1667389456.json
        title: Root
        type: object
        properties:
          page:
            $id: "#root/page"
            title: Page
            type: integer
            default: 0
          per_page:
            $id: "#root/per_page"
            title: Per_page
            type: integer
            default: 0
          photos:
            $id: "#root/photos"
            title: Photos
            type: array
            default: []
            items:
              $id: "#root/photos/items"
              title: Items
              type: object
              properties:
                id:
                  $id: "#root/photos/items/id"
                  title: Id
                  type: integer
                  default: 0
                width:
                  $id: "#root/photos/items/width"
                  title: Width
                  type: integer
                  default: 0
                height:
                  $id: "#root/photos/items/height"
                  title: Height
                  type: integer
                  default: 0
                url:
                  $id: "#root/photos/items/url"
                  title: Url
                  type: string
                  default: ""
                  pattern: ^.*$
                photographer:
                  $id: "#root/photos/items/photographer"
                  title: Photographer
                  type: string
                  default: ""
                  pattern: ^.*$
                photographer_url:
                  $id: "#root/photos/items/photographer_url"
                  title: Photographer_url
                  type: string
                  default: ""
                  pattern: ^.*$
                photographer_id:
                  $id: "#root/photos/items/photographer_id"
                  title: Photographer_id
                  type: integer
                  default: 0
                avg_color:
                  $id: "#root/photos/items/avg_color"
                  title: Avg_color
                  type: string
                  default: ""
                  pattern: ^.*$
                src:
                  $id: "#root/photos/items/src"
                  title: Src
                  type: object
                  properties:
                    original:
                      $id: "#root/photos/items/src/original"
                      title: Original
                      type: string
                      default: ""
                      pattern: ^.*$
                    large2x:
                      $id: "#root/photos/items/src/large2x"
                      title: Large2x
                      type: string
                      default: ""
                      pattern: ^.*$
                    large:
                      $id: "#root/photos/items/src/large"
                      title: Large
                      type: string
                      default: ""
                      pattern: ^.*$
                    medium:
                      $id: "#root/photos/items/src/medium"
                      title: Medium
                      type: string
                      default: ""
                      pattern: ^.*$
                    small:
                      $id: "#root/photos/items/src/small"
                      title: Small
                      type: string
                      default: ""
                      pattern: ^.*$
                    portrait:
                      $id: "#root/photos/items/src/portrait"
                      title: Portrait
                      type: string
                      default: ""
                      pattern: ^.*$
                    landscape:
                      $id: "#root/photos/items/src/landscape"
                      title: Landscape
                      type: string
                      default: ""
                      pattern: ^.*$
                    tiny:
                      $id: "#root/photos/items/src/tiny"
                      title: Tiny
                      type: string
                      default: ""
                      pattern: ^.*$
                liked:
                  $id: "#root/photos/items/liked"
                  title: Liked
                  type: boolean
                  default: true
                alt:
                  $id: "#root/photos/items/alt"
                  title: Alt
                  type: string
                  default: ""
                  pattern: ^.*$
          total_results:
            $id: "#root/total_results"
            title: Total_results
            type: integer
            default: 0
          next_page:
            $id: "#root/next_page"
            title: Next_page
            type: string
            default: ""
            pattern: ^.*$
  videos_search_stream:
    $ref: "#/definitions/page_stream"
    $parameters:
      name: "videos_search"
      path: "/videos/search"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        definitions: {}
        $schema: http://json-schema.org/draft-07/schema#
        $id: https://example.com/object1667389704.json
        title: Root
        type: object
        properties:
          page:
            $id: "#root/page"
            title: Page
            type: integer
            default: 0
          per_page:
            $id: "#root/per_page"
            title: Per_page
            type: integer
            default: 0
          total_results:
            $id: "#root/total_results"
            title: Total_results
            type: integer
            default: 0
          url:
            $id: "#root/url"
            title: Url
            type: string
            default: ""
            pattern: ^.*$
          videos:
            $id: "#root/videos"
            title: Videos
            type: array
            default: []
            items:
              $id: "#root/videos/items"
              title: Items
              type: object
              properties:
                id:
                  $id: "#root/videos/items/id"
                  title: Id
                  type: integer
                  default: 0
                width:
                  $id: "#root/videos/items/width"
                  title: Width
                  type:
                    - "null"
                    - number
                    - integer
                  default: 0
                height:
                  $id: "#root/videos/items/height"
                  title: Height
                  type:
                    - "null"
                    - number
                    - integer
                  default: 0
                url:
                  $id: "#root/videos/items/url"
                  title: Url
                  type: string
                  default: ""
                  pattern: ^.*$
                image:
                  $id: "#root/videos/items/image"
                  title: Image
                  type: string
                  default: ""
                  pattern: ^.*$
                duration:
                  $id: "#root/videos/items/duration"
                  title: Duration
                  type: integer
                  default: 0
                user:
                  $id: "#root/videos/items/user"
                  title: User
                  type: object
                  properties:
                    id:
                      $id: "#root/videos/items/user/id"
                      title: Id
                      type: integer
                      default: 0
                    name:
                      $id: "#root/videos/items/user/name"
                      title: Name
                      type: string
                      default: ""
                      pattern: ^.*$
                    url:
                      $id: "#root/videos/items/user/url"
                      title: Url
                      type: string
                      default: ""
                      pattern: ^.*$
                video_files:
                  $id: "#root/videos/items/video_files"
                  title: Video_files
                  type: array
                  default: []
                  items:
                    $id: "#root/videos/items/video_files/items"
                    title: Items
                    type: object
                    properties:
                      id:
                        $id: "#root/videos/items/video_files/items/id"
                        title: Id
                        type: integer
                        default: 0
                      quality:
                        $id: "#root/videos/items/video_files/items/quality"
                        title: Quality
                        type: string
                        default: ""
                        pattern: ^.*$
                      file_type:
                        $id: "#root/videos/items/video_files/items/file_type"
                        title: File_type
                        type: string
                        default: ""
                        pattern: ^.*$
                      width:
                        $id: "#root/videos/items/video_files/items/width"
                        title: Width
                        type:
                          - "null"
                          - number
                          - integer
                        default: 0
                      height:
                        $id: "#root/videos/items/video_files/items/height"
                        title: Height
                        type:
                          - "null"
                          - number
                          - integer
                        default: 0
                      link:
                        $id: "#root/videos/items/video_files/items/link"
                        title: Link
                        type: string
                        default: ""
                        pattern: ^.*$
                video_pictures:
                  $id: "#root/videos/items/video_pictures"
                  title: Video_pictures
                  type: array
                  default: []
                  items:
                    $id: "#root/videos/items/video_pictures/items"
                    title: Items
                    type: object
                    properties:
                      id:
                        $id: "#root/videos/items/video_pictures/items/id"
                        title: Id
                        type: integer
                        default: 0
                      picture:
                        $id: "#root/videos/items/video_pictures/items/picture"
                        title: Picture
                        type:
                          - "null"
                          - string
                        default: ""
                        pattern: ^.*$
                      nr:
                        $id: "#root/videos/items/video_pictures/items/nr"
                        title: Nr
                        type: integer
                        default: 0
  videos_popular_stream:
    $ref: "#/definitions/page_stream"
    $parameters:
      name: "videos_popular"
      path: "/videos/popular"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        definitions: {}
        $schema: http://json-schema.org/draft-07/schema#
        $id: https://example.com/object1667389811.json
        title: Root
        type: object
        properties:
          page:
            $id: "#root/page"
            title: Page
            type: integer
            default: 0
          per_page:
            $id: "#root/per_page"
            title: Per_page
            type: integer
            default: 0
          total_results:
            $id: "#root/total_results"
            title: Total_results
            type: integer
            default: 0
          url:
            $id: "#root/url"
            title: Url
            type: string
            default: ""
            pattern: ^.*$
          videos:
            $id: "#root/videos"
            title: Videos
            type: array
            default: []
            items:
              $id: "#root/videos/items"
              title: Items
              type: object
              properties:
                id:
                  $id: "#root/videos/items/id"
                  title: Id
                  type: integer
                  default: 0
                width:
                  $id: "#root/videos/items/width"
                  title: Width
                  type:
                    - number
                    - integer
                    - "null"
                  default: 0
                height:
                  $id: "#root/videos/items/height"
                  title: Height
                  type:
                    - number
                    - integer
                    - "null"
                  default: 0
                url:
                  $id: "#root/videos/items/url"
                  title: Url
                  type: string
                  default: ""
                  pattern: ^.*$
                image:
                  $id: "#root/videos/items/image"
                  title: Image
                  type: string
                  default: ""
                  pattern: ^.*$
                duration:
                  $id: "#root/videos/items/duration"
                  title: Duration
                  type: integer
                  default: 0
                user:
                  $id: "#root/videos/items/user"
                  title: User
                  type: object
                  properties:
                    id:
                      $id: "#root/videos/items/user/id"
                      title: Id
                      type: integer
                      default: 0
                    name:
                      $id: "#root/videos/items/user/name"
                      title: Name
                      type: string
                      default: ""
                      pattern: ^.*$
                    url:
                      $id: "#root/videos/items/user/url"
                      title: Url
                      type: string
                      default: ""
                      pattern: ^.*$
                video_files:
                  $id: "#root/videos/items/video_files"
                  title: Video_files
                  type: array
                  default: []
                  items:
                    $id: "#root/videos/items/video_files/items"
                    title: Items
                    type: object
                    properties:
                      id:
                        $id: "#root/videos/items/video_files/items/id"
                        title: Id
                        type: integer
                        default: 0
                      quality:
                        $id: "#root/videos/items/video_files/items/quality"
                        title: Quality
                        type: string
                        default: ""
                        pattern: ^.*$
                      file_type:
                        $id: "#root/videos/items/video_files/items/file_type"
                        title: File_type
                        type: string
                        default: ""
                        pattern: ^.*$
                      width:
                        $id: "#root/videos/items/video_files/items/width"
                        title: Width
                        type:
                          - number
                          - integer
                          - "null"
                        default: 0
                      height:
                        $id: "#root/videos/items/video_files/items/height"
                        title: Height
                        type:
                          - number
                          - integer
                          - "null"
                        default: 0
                      link:
                        $id: "#root/videos/items/video_files/items/link"
                        title: Link
                        type: string
                        default: ""
                        pattern: ^.*$
                video_pictures:
                  $id: "#root/videos/items/video_pictures"
                  title: Video_pictures
                  type: array
                  default: []
                  items:
                    $id: "#root/videos/items/video_pictures/items"
                    title: Items
                    type: object
                    properties:
                      id:
                        $id: "#root/videos/items/video_pictures/items/id"
                        title: Id
                        type: integer
                        default: 0
                      picture:
                        $id: "#root/videos/items/video_pictures/items/picture"
                        title: Picture
                        type: string
                        default: ""
                        pattern: ^.*$
                      nr:
                        $id: "#root/videos/items/video_pictures/items/nr"
                        title: Nr
                        type: integer
                        default: 0
  collection_featured_stream:
    $ref: "#/definitions/page_stream"
    $parameters:
      name: "collection_featured"
      path: "/v1/collections/featured"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        definitions: {}
        $schema: http://json-schema.org/draft-07/schema#
        $id: https://example.com/object1667390893.json
        title: Root
        type: object
        properties:
          collections:
            $id: "#root/collections"
            title: Collections
            type: array
            default: []
            items:
              $id: "#root/collections/items"
              title: Items
              type: object
              properties:
                id:
                  $id: "#root/collections/items/id"
                  title: Id
                  type: string
                  default: ""
                  pattern: ^.*$
                title:
                  $id: "#root/collections/items/title"
                  title: Title
                  type: string
                  default: ""
                  pattern: ^.*$
                description:
                  $id: "#root/collections/items/description"
                  title: Description
                  type:
                    - string
                    - "null"
                  default:
                private:
                  $id: "#root/collections/items/private"
                  title: Private
                  type: boolean
                  default: true
                media_count:
                  $id: "#root/collections/items/media_count"
                  title: Media_count
                  type: integer
                  default: 0
                photos_count:
                  $id: "#root/collections/items/photos_count"
                  title: Photos_count
                  type: integer
                  default: 0
                videos_count:
                  $id: "#root/collections/items/videos_count"
                  title: Videos_count
                  type: integer
                  default: 0
          page:
            $id: "#root/page"
            title: Page
            type: integer
            default: 0
          per_page:
            $id: "#root/per_page"
            title: Per_page
            type: integer
            default: 0
          total_results:
            $id: "#root/total_results"
            title: Total_results
            type: integer
            default: 0
          next_page:
            $id: "#root/next_page"
            title: Next_page
            type: string
            default: ""
            pattern: ^.*$
          prev_page:
            $id: "#root/prev_page"
            title: Prev_page
            type: string
            default: ""
            pattern: ^.*$
streams:
  - "#/definitions/photos_search_stream"
  - "#/definitions/photos_curated_stream"
  - "#/definitions/collection_featured_stream"
  - "#/definitions/videos_search_stream"
  - "#/definitions/videos_popular_stream"

check:
  stream_names:
    - "videos_popular"
