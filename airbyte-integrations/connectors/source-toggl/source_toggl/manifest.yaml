version: "0.29.0"

definitions:
  selector:
    extractor:
      field_path: []
  data_selector:
    extractor:
      field_path: ["data"]
  requester:
    url_base: "https://api.track.toggl.com"
    http_method: "GET"
    request_parameters:
      start_date: "{{ config['start_date'] }}"
      end_date: "{{ config['end_date'] }}"
    authenticator:
      type: BasicHttpAuthenticator
      username: "{{ config['api_token'] }}"
      password: "api_token"
  increment_paginator:
    type: "DefaultPaginator"
    page_size_option:
      inject_into: "request_parameter"
      field_name: "per_page"
    pagination_strategy:
      type: "PageIncrement"
      page_size: 50
    page_token_option:
      type: RequestOption
      inject_into: "request_parameter"
      field_name: "page"
  retriever:
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"
  base_stream:
    retriever:
      $ref: "#/definitions/retriever"
  time_entries_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "time_entries"
      primary_key: "id"
      path: "/api/v9/me/time_entries"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          at:
            type: string
          billable:
            type: boolean
          description:
            type:
              - "null"
              - string
          duration:
            type: integer
          duronly:
            type: boolean
          id:
            type: integer
          pid:
            type: integer
          project_id:
            type:
              - "null"
              - integer
          server_deleted_at:
            type:
              - "null"
              - string
          start:
            type: string
          stop:
            type: string
          tag_ids:
            type:
              - "null"
              - array
          tags:
            type:
              - "null"
              - array
          task_id:
            type:
              - "null"
              - integer
          tid:
            type: integer
          uid:
            type: integer
          user_id:
            type: integer
          wid:
            type: integer
          workspace_id:
            type: integer
  organizations_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "organizations"
      primary_key: "id"
      path: "/api/v9/organizations/{{ config['organization_id'] }}"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          admin:
            type: boolean
          at:
            type: string
          created_at:
            type: string
          id:
            type: integer
          is_chargify:
            type: boolean
          is_multi_workspace_enabled:
            type: boolean
          is_unified:
            type: boolean
          max_workspaces:
            type: integer
          name:
            type: string
          owner:
            type: boolean
          payment_methods:
            type: string
          pricing_plan_id:
            type: integer
          server_deleted_at:
            type:
              - "null"
              - string
          suspended_at:
            type:
              - "null"
              - string
          trial_info:
            type: object
          user_count:
            type: integer
  organizations_users_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "organizations_users"
      primary_key: "id"
      path: "/api/v9/organizations/{{ config['organization_id'] }}/users"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          admin:
            type: boolean
          avatar_url:
            type: string
          can_edit_email:
            type: boolean
          email:
            type: string
          groups:
            type:
              - "null"
              - array
          id:
            type: integer
          inactive:
            type: boolean
          invitation_code:
            type:
              - "null"
              - string
          joined:
            type: boolean
          name:
            type: string
          owner:
            type: boolean
          user_id:
            type: integer
          workspaces:
            type: array
  organizations_groups_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "organizations_groups"
      primary_key: "group_id"
      path: "/api/v9/organizations/{{ config['organization_id'] }}/groups"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          at:
            type: string
          group_id:
            type: integer
          name:
            type: string
          users:
            type:
              - "null"
              - array
          workspaces:
            type: array
  workspace_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "workspace"
      primary_key: ""
      path: "/api/v9/workspaces/{{ config['workspace_id'] }}/statistics"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          admins:
            type: array
          groups_count:
            type: integer
          members_count:
            type: integer
  workspace_clients_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "workspace_clients"
      primary_key: "id"
      path: "/api/v9/workspaces/{{ config['workspace_id'] }}/clients"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          archived:
            type: boolean
          at:
            type: string
          id:
            type: integer
          name:
            type: string
          server_deleted_at:
            type: string
          wid:
            type: integer
  workspace_projects_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "workspace_projects"
      primary_key: "id"
      path: "/api/v9/workspaces/{{ config['workspace_id'] }}/projects"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          active:
            type: boolean
          actual_hours:
            type:
              - "null"
              - integer
          at:
            type: string
          auto_estimates:
            type:
              - "null"
              - boolean
          billable:
            type:
              - "null"
              - boolean
          cid:
            type:
              - "null"
              - integer
          client_id:
            type:
              - "null"
              - integer
          color:
            type: string
          created_at:
            type: string
          currency:
            type:
              - "null"
              - string
          current_period:
            type:
              - "null"
              - object
          estimated_hours:
            type:
              - "null"
              - integer
          first_time_entry:
            type: string
          fixed_fee:
            type:
              - "null"
              - number
          id:
            type: integer
          is_private:
            type: boolean
          name:
            type: string
          rate:
            type:
              - "null"
              - number
          rate_last_updated:
            type:
              - "null"
              - string
          recurring:
            type: boolean
          recurring_parameters:
            type:
              - "null"
              - array
          server_deleted_at:
            type:
              - "null"
              - string
          template:
            type:
              - "null"
              - boolean
          wid:
            type: integer
          workspace_id:
            type: integer
  workspace_tasks_stream:
    retriever:
      record_selector:
        $ref: "#/definitions/data_selector"
      paginator:
        $ref: "#/definitions/increment_paginator"
      requester:
        $ref: "#/definitions/requester"
        request_parameters: ""
    $parameters:
      name: "workspace_tasks"
      primary_key: "id"
      path: "/api/v9/workspaces/{{ config['workspace_id'] }}/tasks"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        properties:
          active:
            type: boolean
          at:
            type: string
          estimated_seconds:
            type:
              - "null"
              - integer
          id:
            type: integer
          name:
            type: string
          project_id:
            type: integer
          recurring:
            type: boolean
          server_deleted_at:
            type:
              - "null"
              - string
          tracked_seconds:
            type: integer
          user_id:
            type:
              - "null"
              - integer
          workspace_id:
            type: integer
streams:
  - "#/definitions/time_entries_stream"
  - "#/definitions/organizations_stream"
  - "#/definitions/organizations_users_stream"
  - "#/definitions/organizations_groups_stream"
  - "#/definitions/workspace_stream"
  - "#/definitions/workspace_clients_stream"
  - "#/definitions/workspace_projects_stream"
  - "#/definitions/workspace_tasks_stream"

check:
  stream_names:
    - "time_entries"
