version: "0.29.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: []

  oauth_authenticator:
    type: OAuthAuthenticator
    class_name: source_my_hours.auth.MyHoursAuthenticator
    token_refresh_endpoint: "https://api2.myhours.com/api/token/refresh"
    client_id: ""
    client_secret: ""
    refresh_token: ""
    email: "{{ config['credentials']['email'] }}"
    password: "{{ config['credentials']['password'] }}"

  bearer_authenticator:
    type: BearerAuthenticator
    api_token: "{{ config['credentials']['access_token'] }}"

  requester:
    type: HttpRequester
    url_base: "https://api2.myhours.com/api"
    http_method: "GET"
    authenticator:
      class_name: source_my_hours.components.Authenticator
      bearer: "#/definitions/bearer_authenticator"
      oauth: "#/definitions/oauth_authenticator"

  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"
      
  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"

  clients_stream:
    $ref: "#/definitions/base_stream"
    name: "clients"
    primary_key: "id"
    $parameters:
      path: "/Clients"

  projects_stream:
    $ref: "#/definitions/base_stream"
    name: "projects"
    primary_key: "id"
    $parameters:
      path: "/Projects/getAll"

  tags_stream:
    $ref: "#/definitions/base_stream"
    name: "tags"
    primary_key: "id"
    $parameters:
      path: "/Tags"

  time_logs_stream:
    $ref: "#/definitions/base_stream"
    name: "time_logs"
    primary_key: "logId"
    $parameters:
      path: "/Reports/activity"

  users_stream:
    $ref: "#/definitions/base_stream"
    name: "users"
    primary_key: "id"
    $parameters:
      path: "/Users/getAll"

streams:
  - "#/definitions/clients_stream"
  - "#/definitions/projects_stream"
  - "#/definitions/tags_stream"
  - "#/definitions/time_logs_stream"
  - "#/definitions/users_stream"

check:
  type: CheckStream
  stream_names:
    - "clients"
    - "projects"
    - "tags"
    - "time_logs"
    - "users"

