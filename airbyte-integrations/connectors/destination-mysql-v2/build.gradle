plugins {
    id 'application'
    id 'airbyte-bulk-connector'
    id "io.airbyte.gradle.docker"
    id 'airbyte-connector-docker-convention'
}

airbyteBulkConnector {
    core = 'load'
    toolkits = ['load-db']
}

java {
    compileJava {
        options.compilerArgs += "-Xlint:-this-escape"
    }
}

application {
    mainClass = 'io.airbyte.integrations.destination.mysql.MySQLDestinationKt'
    applicationDefaultJvmArgs = ['-XX:+ExitOnOutOfMemoryError', '-XX:MaxRAMPercentage=75.0',
                                 '-XX:NativeMemoryTracking=detail', '-XX:+UnlockDiagnosticVMOptions',
                                 '-XX:GCLockerRetryAllocationCount=100']
}

dependencies {
    // MySQL JDBC driver
    implementation 'com.mysql:mysql-connector-j:8.3.0'

    // HikariCP for connection pooling
    implementation 'com.zaxxer:HikariCP:5.1.0'

    // Test dependencies
    testImplementation("io.mockk:mockk:1.14.2")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.10.2")

    // Integration test dependencies
    integrationTestImplementation 'org.testcontainers:mysql:1.19.8'
}
