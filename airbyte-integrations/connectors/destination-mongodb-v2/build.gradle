plugins {
    id 'application'
    id 'airbyte-bulk-connector'
    id "io.airbyte.gradle.docker"
    id 'airbyte-connector-docker-convention'
}

airbyteBulkConnector {
    core = 'load'
    toolkits = ['load-db']
}

java {
    compileJava {
        options.compilerArgs += "-Xlint:-this-escape"
    }
}

application {
    mainClass = 'io.airbyte.integrations.destination.mongodb_v2.MongodbDestinationKt'
    applicationDefaultJvmArgs = ['-XX:+ExitOnOutOfMemoryError', '-XX:MaxRAMPercentage=75.0']
}

dependencies {
    // MongoDB Kotlin Coroutine Driver
    implementation 'org.mongodb:mongodb-driver-kotlin-coroutine:5.2.1'

    // BSON support
    implementation 'org.mongodb:bson:5.2.1'

    testImplementation("io.mockk:mockk:1.14.2")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.10.2")

    // Testcontainers for MongoDB integration tests
    integrationTestImplementation 'org.testcontainers:mongodb:1.21.1'
}
