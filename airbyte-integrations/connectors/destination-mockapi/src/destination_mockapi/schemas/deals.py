# Copyright (c) 2025 Airbyte, Inc., all rights reserved.

from typing import Any, Dict


def map_to_deal_schema(record: Dict[str, Any]) -> Dict[str, Any]:
    """
    Map incoming record to MockAPI deal schema
    MockAPI deal structure: {id, createdAt, name, avatar}
    Note: Your deals use 'name' not 'title' and include 'avatar'
    """
    mapped_deal = {}

    # Map name (required field) - deals use 'name' not 'title' in your API
    if "name" in record:
        mapped_deal["name"] = str(record["name"])
    elif "title" in record:
        mapped_deal["name"] = str(record["title"])
    elif "deal_name" in record:
        mapped_deal["name"] = str(record["deal_name"])
    elif "deal_title" in record:
        mapped_deal["name"] = str(record["deal_title"])
    else:
        mapped_deal["name"] = "Unknown Deal"

    # Map avatar (deal image/logo)
    if "avatar" in record:
        mapped_deal["avatar"] = str(record["avatar"])
    elif "image" in record:
        mapped_deal["avatar"] = str(record["image"])
    elif "logo" in record:
        mapped_deal["avatar"] = str(record["logo"])
    elif "picture" in record:
        mapped_deal["avatar"] = str(record["picture"])

    # Note: createdAt and id will be auto-generated by MockAPI
    # Other fields like amount, stage, etc. are not in your MockAPI schema

    return mapped_deal


def validate_deal_data(deal_data: Dict[str, Any]) -> bool:
    """
    Validate deal data before sending to API
    MockAPI requires at least a name field
    """
    return bool(deal_data.get("name"))
