version: "0.44.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: CustomRecordExtractor
      class_name: source_outreach.components.CustomExtractor

  requester:
    type: HttpRequester
    url_base: https://api.outreach.io/api/v2
    http_method: GET
    request_parameters:
      count: 'false'
      sort: updatedAt
      page[size]: '1000'
    request_headers: {}
    authenticator:
      type: OAuthAuthenticator
      client_id: '{{ config[''client_id''] }}'
      client_secret: '{{ config[''client_secret''] }}'
      refresh_token: '{{ config[''refresh_token''] }}'
      refresh_request_body: {}
      token_refresh_endpoint: https://api.outreach.io/oauth/token
      grant_type: refresh_token
      scopes:
        - >-
          accounts.all audits.read calls.all callDispositions.all
          complianceRequests.all callPurposes.all contentCategories.all
          contentCategoryMemberships.all contentCategoryOwnerships.all
          customDuties.write duties.read emailAddresses.all events.all
          jobRoles.all mailboxes.all favorites.all mailings.all
          mailAliases.read opportunities.all opportunityProspectRoles.all
          opportunityStages.all orgSettings.all personas.all
          phoneNumbers.all profiles.all prospects.all recipients.all
          recordActorAssignments.all roles.all rulesets.all sequences.all
          sequenceStates.all sequenceSteps.all sequenceTemplates.all
          snippets.all stages.all tasks.all taskPriorities.read teams.all
          templates.all users.all webhooks.all

  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: DefaultPaginator
      page_token_option:
        type: RequestPath
      pagination_strategy:
        type: CursorPagination
        cursor_value: '{{ response.get("links", {}).get("next", {}) }}'
        stop_condition: '{{ not response.get("links", {}).get("next", {}) }}'
    requester:
      $ref: "#/definitions/requester"

  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"
    incremental_sync:
      type: CustomIncrementalSync
      class_name: source_outreach.components.CustomIncrementalSync
      datetime_format: '%Y-%m-%dT%H:%M:%S.%fZ'
      cursor_field: updatedAt
      is_data_feed: true
      start_datetime:
        type: MinMaxDatetime
        datetime: '{{ config[''start_date''] }}'
        datetime_format: '%Y-%m-%dT%H:%M:%SZ'

streams:
  - $ref: "#/definitions/base_stream"
    name: "accounts"
    primary_key: "id"
    $parameters:
      path: "/accounts"

  - $ref: "#/definitions/base_stream"
    name: "calls"
    primary_key: "id"
    $parameters:
      path: "/calls"

  - $ref: "#/definitions/base_stream"
    name: "call_dispositions"
    primary_key: "id"
    $parameters:
      path: "/callDispositions"

  - $ref: "#/definitions/base_stream"
    name: "call_purposes"
    primary_key: "id"
    $parameters:
      path: "/callPurposes"

  - $ref: "#/definitions/base_stream"
    name: "mailings"
    primary_key: "id"
    $parameters:
      path: "/mailings"

  - $ref: "#/definitions/base_stream"
    name: "mailboxes"
    primary_key: "id"
    $parameters:
      path: "/mailboxes"

  - $ref: "#/definitions/base_stream"
    name: "opportunities"
    primary_key: "id"
    $parameters:
      path: "/opportunities"

  - $ref: "#/definitions/base_stream"
    name: "personas"
    primary_key: "id"
    $parameters:
      path: "/personas"

  - $ref: "#/definitions/base_stream"
    name: "prospects"
    primary_key: "id"
    $parameters:
      path: "/prospects"

  - $ref: "#/definitions/base_stream"
    name: "sequences"
    primary_key: "id"
    $parameters:
      path: "/sequences"

  - $ref: "#/definitions/base_stream"
    name: "sequence_states"
    primary_key: "id"
    $parameters:
      path: "/sequenceStates"

  - $ref: "#/definitions/base_stream"
    name: "sequence_steps"
    primary_key: "id"
    $parameters:
      path: "/sequenceSteps"

  - $ref: "#/definitions/base_stream"
    name: "snippets"
    primary_key: "id"
    $parameters:
      path: "/snippets"

  - $ref: "#/definitions/base_stream"
    name: "stages"
    primary_key: "id"
    $parameters:
      path: "/stages"

  - $ref: "#/definitions/base_stream"
    name: "tasks"
    primary_key: "id"
    $parameters:
      path: "/tasks"

  - $ref: "#/definitions/base_stream"
    name: "templates"
    primary_key: "id"
    $parameters:
      path: "/templates"

  - $ref: "#/definitions/base_stream"
    name: "users"
    primary_key: "id"
    $parameters:
      path: "/users"

check:
  type: CheckStream
  stream_names:
    - "accounts"

spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/outreach
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Source Outreach Spec
    type: object
    required:
    - client_id
    - client_secret
    - refresh_token
    - redirect_uri
    - start_date
    additionalProperties: true
    properties:
      client_id:
        type: string
        title: Client ID
        description: The Client ID of your Outreach developer application.
      client_secret:
        type: string
        title: Client Secret
        description: The Client Secret of your Outreach developer application.
        airbyte_secret: true
      refresh_token:
        type: string
        title: Refresh Token
        description: The token for obtaining the new access token.
        airbyte_secret: true
      redirect_uri:
        type: string
        title: Redirect URI
        description: A Redirect URI is the location where the authorization server sends
          the user once the app has been successfully authorized and granted an authorization
          code or access token.
      start_date:
        type: string
        title: Start Date
        description: The date from which you'd like to replicate data for Outreach API,
          in the format YYYY-MM-DDT00:00:00Z. All data generated after this date will
          be replicated.
        examples:
        - '2020-11-16T00:00:00Z'
        pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
