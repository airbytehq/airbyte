plugins {
    id 'application'
    id 'airbyte-bulk-connector'
}

airbyteBulkConnector {
    core = 'load'
    toolkits = ['load-gcs', 'load-db']
    cdk = 'local'
}

java {
    // TODO: rewrite code to avoid javac wornings in the first place
    compileJava {
        options.compilerArgs += "-Xlint:-this-escape"
    }
}

application {
    mainClass = 'io.airbyte.integrations.destination.bigquery.BigQueryDestinationKt'
    applicationDefaultJvmArgs = ['-XX:+ExitOnOutOfMemoryError', '-XX:MaxRAMPercentage=75.0',
                                 '-XX:NativeMemoryTracking=detail', '-XX:+UnlockDiagnosticVMOptions',
                                 '-XX:GCLockerRetryAllocationCount=100',
//            '-Djava.rmi.server.hostname=localhost',
//            '-Dcom.sun.management.jmxremote=true',
//            '-Dcom.sun.management.jmxremote.port=6000',
//            '-Dcom.sun.management.jmxremote.rmi.port=6000',
//            '-Dcom.sun.management.jmxremote.local.only=false',
//            '-Dcom.sun.management.jmxremote.authenticate=false',
//            '-Dcom.sun.management.jmxremote.ssl=false'
    ]
}

dependencies {
    implementation 'org.apache.commons:commons-text:1.12.0'

    // old CDK dependencies
    implementation 'io.airbyte.cdk:airbyte-cdk-core:0.46.0'
    implementation 'io.airbyte.cdk:airbyte-cdk-datastore-bigquery:0.46.0'
    implementation 'io.airbyte.cdk:airbyte-cdk-db-destinations:0.46.0'
    implementation 'io.airbyte.cdk:airbyte-cdk-dependencies:0.46.0'
    implementation 'io.airbyte.cdk:airbyte-cdk-gcs-destinations:0.46.0'
    implementation 'io.airbyte.cdk:airbyte-cdk-typing-deduping:0.46.0'

    // TODO these should probably be in integrationTestLegacy
    integrationTestImplementation 'io.airbyte.cdk:airbyte-cdk-core:0.46.0'
    integrationTestImplementation 'io.airbyte.cdk:airbyte-cdk-datastore-bigquery:0.46.0'
    integrationTestImplementation 'io.airbyte.cdk:airbyte-cdk-db-destinations:0.46.0'
    integrationTestImplementation 'io.airbyte.cdk:airbyte-cdk-dependencies:0.46.0'
    integrationTestImplementation 'io.airbyte.cdk:airbyte-cdk-gcs-destinations:0.46.0'
    integrationTestImplementation 'io.airbyte.cdk:airbyte-cdk-typing-deduping:0.46.0'
    integrationTestImplementation testFixtures('io.airbyte.cdk:airbyte-cdk-core:0.46.0')
    integrationTestImplementation testFixtures('io.airbyte.cdk:airbyte-cdk-datastore-bigquery:0.46.0')
    integrationTestImplementation testFixtures('io.airbyte.cdk:airbyte-cdk-db-destinations:0.46.0')
    integrationTestImplementation testFixtures('io.airbyte.cdk:airbyte-cdk-dependencies:0.46.0')
    integrationTestImplementation testFixtures('io.airbyte.cdk:airbyte-cdk-gcs-destinations:0.46.0')
    integrationTestImplementation testFixtures('io.airbyte.cdk:airbyte-cdk-typing-deduping:0.46.0')

    integrationTestImplementation 'org.mockito:mockito-junit-jupiter:5.11.0'
    integrationTestImplementation 'org.assertj:assertj-core:3.25.3'
    integrationTestImplementation("com.github.spotbugs:spotbugs-annotations:4.9.0")
}
