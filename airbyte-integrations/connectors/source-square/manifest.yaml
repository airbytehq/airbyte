version: "4.3.0"
definitions:
  oauth_authenticator:
    type: OAuthAuthenticator
    token_refresh_endpoint: https://connect.squareup.com/oauth2/token
    client_id: "{{ config['credentials']['client_id'] }}"
    client_secret: "{{ config['credentials']['client_secret'] }}"
    refresh_token: "{{ config['credentials']['refresh_token'] }}"
    token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
    expires_in_name: expires_at
  bearer_authenticator:
    type: BearerAuthenticator
    api_token: "{{ config['credentials']['api_key'] }}"
  selector:
    extractor:
      field_path:
        - "{{ parameters['name'] }}"
  requester:
    url_base:
      "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
      else 'https://connect.squareup.com/v2' }}"
    http_method: "GET"
    authenticator:
      type: SelectiveAuthenticator
      authenticator_selection_path:
        - "credentials"
        - "auth_type"
      authenticators:
        API Key:
          type: BearerAuthenticator
          api_token: "{{ config['credentials']['api_key'] }}"
        OAuth:
          type: OAuthAuthenticator
          token_refresh_endpoint: https://connect.squareup.com/oauth2/token
          client_id: "{{ config['credentials']['client_id'] }}"
          client_secret: "{{ config['credentials']['client_secret'] }}"
          refresh_token: "{{ config['credentials']['refresh_token'] }}"
          token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
          expires_in_name: expires_at
    request_headers:
      Square-Version: "2022-10-19"
      Content-Type: "application/json"
    error_handler:
      type: CompositeErrorHandler
      error_handlers:
        - type: DefaultErrorHandler
          backoff_strategies:
            - type: "ConstantBackoffStrategy"
              backoff_time_in_seconds: 30
          response_filters:
            - type: HttpResponseFilter
              action: IGNORE
              http_codes:
                - 404
                - 403
            - type: HttpResponseFilter
              action: FAIL
              http_codes:
                - 401
              error_message:
                Failed to authorize request. Please update your access token
                to continue using the source.
            - type: HttpResponseFilter
              action: RETRY
              http_codes:
                - 429
  retriever:
    record_selector:
      extractor:
        field_path:
          - "{{ parameters['name'] }}"
    requester:
      url_base:
        "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
        else 'https://connect.squareup.com/v2' }}"
      http_method: "GET"
      authenticator:
        type: SelectiveAuthenticator
        authenticator_selection_path:
          - "credentials"
          - "auth_type"
        authenticators:
          API Key:
            type: BearerAuthenticator
            api_token: "{{ config['credentials']['api_key'] }}"
          OAuth:
            type: OAuthAuthenticator
            token_refresh_endpoint: https://connect.squareup.com/oauth2/token
            client_id: "{{ config['credentials']['client_id'] }}"
            client_secret: "{{ config['credentials']['client_secret'] }}"
            refresh_token: "{{ config['credentials']['refresh_token'] }}"
            token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
            expires_in_name: expires_at
      request_headers:
        Square-Version: "2022-10-19"
        Content-Type: "application/json"
      error_handler:
        type: CompositeErrorHandler
        error_handlers:
          - type: DefaultErrorHandler
            backoff_strategies:
              - type: "ConstantBackoffStrategy"
                backoff_time_in_seconds: 30
            response_filters:
              - type: HttpResponseFilter
                action: IGNORE
                http_codes:
                  - 404
                  - 403
              - type: HttpResponseFilter
                action: FAIL
                http_codes:
                  - 401
                error_message:
                  Failed to authorize request. Please update your access
                  token to continue using the source.
              - type: HttpResponseFilter
                action: RETRY
                http_codes:
                  - 429
  base_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
  base_incremental_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "created_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          sort_order: "ASC"
          sort_field: "CREATED_AT"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 100
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
  base_catalog_objects_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
  base_stream_page_json_limit:
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
  customers_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_parameters:
          sort_order: ASC
          sort_field: CREATED_AT
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          cards:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                card_brand:
                  type:
                    - "null"
                    - string
                last_4:
                  type:
                    - "null"
                    - string
                exp_month:
                  type:
                    - "null"
                    - integer
                exp_year:
                  type:
                    - "null"
                    - integer
                cardholder_name:
                  type:
                    - "null"
                    - string
                billing_address:
                  type:
                    - "null"
                    - object
                  properties:
                    postal_code:
                      type:
                        - "null"
                        - string
          given_name:
            type:
              - "null"
              - string
          family_name:
            type:
              - "null"
              - string
          email_address:
            type:
              - "null"
              - string
          address:
            type:
              - "null"
              - object
            properties:
              address_line_1:
                type:
                  - "null"
                  - string
              address_line_2:
                type:
                  - "null"
                  - string
              locality:
                type:
                  - "null"
                  - string
              administrative_district_level_1:
                type:
                  - "null"
                  - string
              postal_code:
                type:
                  - "null"
                  - string
          phone_number:
            type:
              - "null"
              - string
          reference_id:
            type:
              - "null"
              - string
          company_name:
            type:
              - "null"
              - string
          preferences:
            type:
              - "null"
              - object
            properties:
              email_unsubscribed:
                type: boolean
          creation_source:
            type:
              - "null"
              - string
          birthday:
            type:
              - "null"
              - string
          segment_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          group_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          version:
            type:
              - "null"
              - integer
  shifts_stream:
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        pagination_strategy:
          page_size: 200
        page_size_option:
          inject_into: "body_json"
          field_name: "limit"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          employee_id:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          timezone:
            type:
              - "null"
              - string
          start_at:
            type:
              - "null"
              - string
          end_at:
            type:
              - "null"
              - string
          wage:
            type:
              - "null"
              - object
            properties:
              title:
                type:
                  - "null"
                  - string
              hourly_rate:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
          breaks:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                start_at:
                  type:
                    - "null"
                    - string
                end_at:
                  type:
                    - "null"
                    - string
                break_type_id:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                expected_duration:
                  type:
                    - "null"
                    - string
                is_paid:
                  type:
                    - "null"
                    - boolean
          status:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          team_member_id:
            type:
              - "null"
              - string
  team_members_stream:
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          is_owner:
            type:
              - "null"
              - boolean
          status:
            type:
              - "null"
              - string
          given_name:
            type:
              - "null"
              - string
          family_name:
            type:
              - "null"
              - string
          email_address:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          assigned_locations:
            type:
              - "null"
              - object
            properties:
              assignment_type:
                type:
                  - "null"
                  - string
          reference_id:
            type:
              - "null"
              - string
          phone_number:
            type:
              - "null"
              - string
  inventory_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "counts"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          limit: "{{ 500 }}"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Inventory Schema
        additionalProperties: true
        type: object
        properties:
          catalog_object_id:
            type:
              - string
              - "null"
          catalog_object_type:
            type:
              - string
              - "null"
          state:
            type:
              - string
              - "null"
          location_id:
            type:
              - string
              - "null"
          quantity:
            type:
              - string
              - "null"
          calculated_at:
            type:
              - string
              - "null"
  team_member_wages_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_parameters:
          sort_order: ASC
          sort_field: CREATED_AT
      paginator:
        pagination_strategy:
          page_size: 200
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          team_member_id:
            type:
              - "null"
              - string
          title:
            type:
              - "null"
              - string
          hourly_rate:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
  locations_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          name:
            type:
              - "null"
              - string
          address:
            type:
              - "null"
              - object
            properties:
              address_line_1:
                type:
                  - "null"
                  - string
              locality:
                type:
                  - "null"
                  - string
              administrative_district_level_1:
                type:
                  - "null"
                  - string
              postal_code:
                type:
                  - "null"
                  - string
              country:
                type:
                  - "null"
                  - string
          timezone:
            type:
              - "null"
              - string
          capabilities:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          status:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          merchant_id:
            type:
              - "null"
              - string
          country:
            type:
              - "null"
              - string
          language_code:
            type:
              - "null"
              - string
          currency:
            type:
              - "null"
              - string
          phone_number:
            type:
              - "null"
              - string
          business_name:
            type:
              - "null"
              - string
          type:
            type:
              - "null"
              - string
          website_url:
            type:
              - "null"
              - string
          business_hours:
            type:
              - "null"
              - object
          business_email:
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
          twitter_username:
            type:
              - "null"
              - string
          instagram_username:
            type:
              - "null"
              - string
          facebook_url:
            type:
              - "null"
              - string
          mcc:
            type:
              - "null"
              - string
  locations_partition_router:
    type: SubstreamPartitionRouter
    parent_stream_configs:
      - stream:
          type: DeclarativeStream
          retriever:
            record_selector:
              extractor:
                field_path:
                  - "{{ parameters['name'] }}"
            requester:
              url_base:
                "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
                else 'https://connect.squareup.com/v2' }}"
              http_method: "GET"
              authenticator:
                type: SelectiveAuthenticator
                authenticator_selection_path:
                  - "credentials"
                  - "auth_type"
                authenticators:
                  API Key:
                    type: BearerAuthenticator
                    api_token: "{{ config['credentials']['api_key'] }}"
                  OAuth:
                    type: OAuthAuthenticator
                    token_refresh_endpoint: https://connect.squareup.com/oauth2/token
                    client_id: "{{ config['credentials']['client_id'] }}"
                    client_secret: "{{ config['credentials']['client_secret'] }}"
                    refresh_token: "{{ config['credentials']['refresh_token'] }}"
                    token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
                    expires_in_name: expires_at
              request_headers:
                Square-Version: "2022-10-19"
                Content-Type: "application/json"
              error_handler:
                type: CompositeErrorHandler
                error_handlers:
                  - type: DefaultErrorHandler
                    backoff_strategies:
                      - type: "ConstantBackoffStrategy"
                        backoff_time_in_seconds: 30
                    response_filters:
                      - type: HttpResponseFilter
                        action: IGNORE
                        http_codes:
                          - 404
                          - 403
                      - type: HttpResponseFilter
                        action: FAIL
                        http_codes:
                          - 401
                        error_message:
                          Failed to authorize request. Please update your access
                          token to continue using the source.
                      - type: HttpResponseFilter
                        action: RETRY
                        http_codes:
                          - 429
            paginator:
              type: DefaultPaginator
              pagination_strategy:
                type: "CursorPagination"
                cursor_value: "{{ response['cursor'] }}"
                stop_condition: "{{ 'cursor' not in response }}"
                page_size: 100
              page_size_option:
                inject_into: "request_parameter"
                field_name: "limit"
              page_token_option:
                type: RequestOption
                inject_into: "request_parameter"
                field_name: "cursor"
          schema_loader:
            type: InlineSchemaLoader
            schema:
              type: object
              properties:
                id:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                address:
                  type:
                    - "null"
                    - object
                  properties:
                    address_line_1:
                      type:
                        - "null"
                        - string
                    locality:
                      type:
                        - "null"
                        - string
                    administrative_district_level_1:
                      type:
                        - "null"
                        - string
                    postal_code:
                      type:
                        - "null"
                        - string
                    country:
                      type:
                        - "null"
                        - string
                timezone:
                  type:
                    - "null"
                    - string
                capabilities:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - string
                status:
                  type:
                    - "null"
                    - string
                created_at:
                  type:
                    - "null"
                    - string
                merchant_id:
                  type:
                    - "null"
                    - string
                country:
                  type:
                    - "null"
                    - string
                language_code:
                  type:
                    - "null"
                    - string
                currency:
                  type:
                    - "null"
                    - string
                phone_number:
                  type:
                    - "null"
                    - string
                business_name:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                website_url:
                  type:
                    - "null"
                    - string
                business_hours:
                  type:
                    - "null"
                    - object
                business_email:
                  type:
                    - "null"
                    - string
                description:
                  type:
                    - "null"
                    - string
                twitter_username:
                  type:
                    - "null"
                    - string
                instagram_username:
                  type:
                    - "null"
                    - string
                facebook_url:
                  type:
                    - "null"
                    - string
                mcc:
                  type:
                    - "null"
                    - string
        parent_key: "id"
        partition_field: "location_id"
  cash_drawers_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "cash_drawer_shifts"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_parameters:
          location_id: "{{ stream_partition.location_id }}"
      partition_router:
        type: SubstreamPartitionRouter
        parent_stream_configs:
          - stream:
              type: DeclarativeStream
              retriever:
                record_selector:
                  extractor:
                    field_path:
                      - "{{ parameters['name'] }}"
                requester:
                  url_base:
                    "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
                    else 'https://connect.squareup.com/v2' }}"
                  http_method: "GET"
                  authenticator:
                    type: SelectiveAuthenticator
                    authenticator_selection_path:
                      - "credentials"
                      - "auth_type"
                    authenticators:
                      API Key:
                        type: BearerAuthenticator
                        api_token: "{{ config['credentials']['api_key'] }}"
                      OAuth:
                        type: OAuthAuthenticator
                        token_refresh_endpoint: https://connect.squareup.com/oauth2/token
                        client_id: "{{ config['credentials']['client_id'] }}"
                        client_secret: "{{ config['credentials']['client_secret'] }}"
                        refresh_token: "{{ config['credentials']['refresh_token'] }}"
                        token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
                        expires_in_name: expires_at
                  request_headers:
                    Square-Version: "2022-10-19"
                    Content-Type: "application/json"
                  error_handler:
                    type: CompositeErrorHandler
                    error_handlers:
                      - type: DefaultErrorHandler
                        backoff_strategies:
                          - type: "ConstantBackoffStrategy"
                            backoff_time_in_seconds: 30
                        response_filters:
                          - type: HttpResponseFilter
                            action: IGNORE
                            http_codes:
                              - 404
                              - 403
                          - type: HttpResponseFilter
                            action: FAIL
                            http_codes:
                              - 401
                            error_message:
                              Failed to authorize request. Please update your
                              access token to continue using the source.
                          - type: HttpResponseFilter
                            action: RETRY
                            http_codes:
                              - 429
                paginator:
                  type: DefaultPaginator
                  pagination_strategy:
                    type: "CursorPagination"
                    cursor_value: "{{ response['cursor'] }}"
                    stop_condition: "{{ 'cursor' not in response }}"
                    page_size: 100
                  page_size_option:
                    inject_into: "request_parameter"
                    field_name: "limit"
                  page_token_option:
                    type: RequestOption
                    inject_into: "request_parameter"
                    field_name: "cursor"
              schema_loader:
                type: InlineSchemaLoader
                schema:
                  type: object
                  properties:
                    id:
                      type:
                        - "null"
                        - string
                    name:
                      type:
                        - "null"
                        - string
                    address:
                      type:
                        - "null"
                        - object
                      properties:
                        address_line_1:
                          type:
                            - "null"
                            - string
                        locality:
                          type:
                            - "null"
                            - string
                        administrative_district_level_1:
                          type:
                            - "null"
                            - string
                        postal_code:
                          type:
                            - "null"
                            - string
                        country:
                          type:
                            - "null"
                            - string
                    timezone:
                      type:
                        - "null"
                        - string
                    capabilities:
                      type:
                        - "null"
                        - array
                      items:
                        type:
                          - "null"
                          - string
                    status:
                      type:
                        - "null"
                        - string
                    created_at:
                      type:
                        - "null"
                        - string
                    merchant_id:
                      type:
                        - "null"
                        - string
                    country:
                      type:
                        - "null"
                        - string
                    language_code:
                      type:
                        - "null"
                        - string
                    currency:
                      type:
                        - "null"
                        - string
                    phone_number:
                      type:
                        - "null"
                        - string
                    business_name:
                      type:
                        - "null"
                        - string
                    type:
                      type:
                        - "null"
                        - string
                    website_url:
                      type:
                        - "null"
                        - string
                    business_hours:
                      type:
                        - "null"
                        - object
                    business_email:
                      type:
                        - "null"
                        - string
                    description:
                      type:
                        - "null"
                        - string
                    twitter_username:
                      type:
                        - "null"
                        - string
                    instagram_username:
                      type:
                        - "null"
                        - string
                    facebook_url:
                      type:
                        - "null"
                        - string
                    mcc:
                      type:
                        - "null"
                        - string
            parent_key: "id"
            partition_field: "location_id"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Cash Drawer Shifts Schema
        additionalProperties: true
        type: object
        properties:
          id:
            type:
              - string
              - "null"
          state:
            type:
              - string
              - "null"
          opened_at:
            type:
              - string
              - "null"
          ended_at:
            type:
              - string
              - "null"
          closed_at:
            type:
              - string
              - "null"
          description:
            type:
              - string
              - "null"
          opened_cash_money:
            type:
              - object
              - "null"
            properties:
              amount:
                type:
                  - number
                  - "null"
              currency:
                type:
                  - string
                  - "null"
          expected_cash_money:
            type:
              - object
              - "null"
            properties:
              amount:
                type:
                  - number
                  - "null"
              currency:
                type:
                  - string
                  - "null"
          closed_cash_money:
            type:
              - object
              - "null"
            properties:
              amount:
                type:
                  - number
                  - "null"
              currency:
                type:
                  - string
                  - "null"
  categories_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          category_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
  items_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          custom_attribute_values:
            type:
              - "null"
              - object
          present_at_all_locations:
            type:
              - "null"
              - boolean
          item_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              description:
                type:
                  - "null"
                  - string
              visibility:
                type:
                  - "null"
                  - string
              category_id:
                type:
                  - "null"
                  - string
              modifier_list_info:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    modifier_list_id:
                      type:
                        - "null"
                        - string
                    visibility:
                      type:
                        - "null"
                        - string
                    min_selected_modifiers:
                      type:
                        - "null"
                        - integer
                    max_selected_modifiers:
                      type:
                        - "null"
                        - integer
                    enabled:
                      type:
                        - "null"
                        - boolean
              variations:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    type:
                      type:
                        - "null"
                        - string
                    id:
                      type:
                        - "null"
                        - string
                    updated_at:
                      type:
                        - "null"
                        - string
                    version:
                      type:
                        - "null"
                        - integer
                    is_deleted:
                      type:
                        - "null"
                        - boolean
                    present_at_all_locations:
                      type:
                        - "null"
                        - boolean
                    item_variation_data:
                      type:
                        - "null"
                        - object
                      properties:
                        item_id:
                          type:
                            - "null"
                            - string
                        name:
                          type:
                            - "null"
                            - string
                        sku:
                          type:
                            - "null"
                            - string
                        ordinal:
                          type:
                            - "null"
                            - integer
                        pricing_type:
                          type:
                            - "null"
                            - string
                        price_money:
                          type:
                            - "null"
                            - object
                          properties:
                            amount:
                              type:
                                - "null"
                                - integer
                            currency:
                              type:
                                - "null"
                                - string
                        location_overrides:
                          type:
                            - "null"
                            - array
                          items:
                            type:
                              - "null"
                              - object
                            properties:
                              location_id:
                                type:
                                  - "null"
                                  - string
                              track_inventory:
                                type:
                                  - "null"
                                  - boolean
                        item_option_values:
                          type:
                            - "null"
                            - array
                          items:
                            type:
                              - "null"
                              - object
                            properties:
                              item_option_id:
                                type:
                                  - "null"
                                  - string
                              item_option_value_id:
                                type:
                                  - "null"
                                  - string
                    present_at_location_ids:
                      type:
                        - "null"
                        - array
                      items:
                        type:
                          - "null"
                          - string
              product_type:
                type:
                  - "null"
                  - string
              skip_modifier_screen:
                type:
                  - "null"
                  - boolean
              item_options:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    item_option_id:
                      type:
                        - "null"
                        - string
              ecom_visibility:
                type:
                  - "null"
                  - string
              tax_ids:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - string
          image_id:
            type:
              - "null"
              - string
          present_at_location_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
  discounts_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          present_at_location_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          discount_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              discount_type:
                type:
                  - "null"
                  - string
              percentage:
                type:
                  - "null"
                  - string
              application_method:
                type:
                  - "null"
                  - string
              modify_tax_basis:
                type:
                  - "null"
                  - string
              amount_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              pin_required:
                type:
                  - "null"
                  - boolean
  taxes_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          tax_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              calculation_phase:
                type:
                  - "null"
                  - string
              inclusion_type:
                type:
                  - "null"
                  - string
              percentage:
                type:
                  - "null"
                  - string
              applies_to_custom_amounts:
                type:
                  - "null"
                  - boolean
              enabled:
                type:
                  - "null"
                  - boolean
              tax_type_id:
                type:
                  - "null"
                  - string
              tax_type_name:
                type:
                  - "null"
                  - string
          absent_at_location_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
  modifier_list_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          modifier_list_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              selection_type:
                type:
                  - "null"
                  - string
              modifiers:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    type:
                      type:
                        - "null"
                        - string
                    id:
                      type:
                        - "null"
                        - string
                    updated_at:
                      type:
                        - "null"
                        - string
                    version:
                      type:
                        - "null"
                        - integer
                    is_deleted:
                      type:
                        - "null"
                        - boolean
                    present_at_all_locations:
                      type:
                        - "null"
                        - boolean
                    modifier_data:
                      type:
                        - "null"
                        - object
                      properties:
                        name:
                          type:
                            - "null"
                            - string
                        price_money:
                          type:
                            - "null"
                            - object
                          properties:
                            amount:
                              type:
                                - "null"
                                - integer
                            currency:
                              type:
                                - "null"
                                - string
                        on_by_default:
                          type:
                            - "null"
                            - boolean
                        ordinal:
                          type:
                            - "null"
                            - integer
                        modifier_list_id:
                          type:
                            - "null"
                            - string
  refunds_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "created_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          sort_order: "ASC"
          sort_field: "CREATED_AT"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 100
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          status:
            type:
              - "null"
              - string
          amount_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
            required:
              - amount
              - currency
          payment_id:
            type:
              - "null"
              - string
          order_id:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          reason:
            type:
              - "null"
              - string
          processing_fee:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                effective_at:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
  payments_stream:
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "created_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          sort_order: "ASC"
          sort_field: "CREATED_AT"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 100
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          amount_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          customer_id:
            type:
              - "null"
              - string
          status:
            type:
              - "null"
              - string
          delay_duration:
            type:
              - "null"
              - string
          source_type:
            type:
              - "null"
              - string
          card_details:
            type:
              - "null"
              - object
            properties:
              status:
                type:
                  - "null"
                  - string
              card:
                type:
                  - "null"
                  - object
                properties:
                  card_brand:
                    type:
                      - "null"
                      - string
                  last_4:
                    type:
                      - "null"
                      - string
                  exp_month:
                    type:
                      - "null"
                      - integer
                  exp_year:
                    type:
                      - "null"
                      - integer
                  fingerprint:
                    type:
                      - "null"
                      - string
                  card_type:
                    type:
                      - "null"
                      - string
                  prepaid_type:
                    type:
                      - "null"
                      - string
                  bin:
                    type:
                      - "null"
                      - string
              entry_method:
                type:
                  - "null"
                  - string
              cvv_status:
                type:
                  - "null"
                  - string
              avs_status:
                type:
                  - "null"
                  - string
              statement_description:
                type:
                  - "null"
                  - string
              card_payment_timeline:
                type:
                  - "null"
                  - object
                properties:
                  authorized_at:
                    type:
                      - "null"
                      - string
                  captured_at:
                    type:
                      - "null"
                      - string
                  voided_at:
                    type:
                      - "null"
                      - string
          location_id:
            type:
              - "null"
              - string
          order_id:
            type:
              - "null"
              - string
          risk_evaluation:
            type:
              - "null"
              - object
            properties:
              created_at:
                type:
                  - "null"
                  - string
              risk_level:
                type:
                  - "null"
                  - string
          processing_fee:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                effective_at:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
          total_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          approved_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          receipt_number:
            type:
              - "null"
              - string
          receipt_url:
            type:
              - "null"
              - string
          delay_action:
            type:
              - "null"
              - string
          delayed_until:
            type:
              - "null"
              - string
          version_token:
            type:
              - "null"
              - string
          note:
            type:
              - "null"
              - string
          employee_id:
            type:
              - "null"
              - string
          refunded_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          refund_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
  loyalty_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "loyalty_accounts"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          limit: "{{ 200 }}"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Loyalty schema
        type: object
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          mapping:
            type:
              - object
              - "null"
            properties:
              id:
                type:
                  - string
                  - "null"
              phone_number:
                type:
                  - string
                  - "null"
              created_at:
                type:
                  - string
                  - "null"
          program_id:
            type:
              - string
              - "null"
          balance:
            type:
              - number
              - "null"
          lifetime_points:
            type:
              - number
              - "null"
          customer_id:
            type:
              - string
              - "null"
          created_at:
            type:
              - string
              - "null"
          updated_at:
            type:
              - string
              - "null"
  orders_stream:
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          limit: "{{ 500 }}"
          filter:
            date_time_filter:
              updated_at:
                start_at: "{{ stream_slice.start_time }}"
          sort:
            sort_field: "UPDATED_AT"
            sort_order: "ASC"
          location_ids: "{{ [ stream_slice.location_ids ] }}"
      partition_router:
        type: "SubstreamPartitionRouter"
        parent_stream_configs:
          - stream:
              type: DeclarativeStream
              retriever:
                record_selector:
                  extractor:
                    field_path:
                      - "{{ parameters['name'] }}"
                requester:
                  url_base:
                    "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
                    else 'https://connect.squareup.com/v2' }}"
                  http_method: "GET"
                  authenticator:
                    type: SelectiveAuthenticator
                    authenticator_selection_path:
                      - "credentials"
                      - "auth_type"
                    authenticators:
                      API Key:
                        type: BearerAuthenticator
                        api_token: "{{ config['credentials']['api_key'] }}"
                      OAuth:
                        type: OAuthAuthenticator
                        token_refresh_endpoint: https://connect.squareup.com/oauth2/token
                        client_id: "{{ config['credentials']['client_id'] }}"
                        client_secret: "{{ config['credentials']['client_secret'] }}"
                        refresh_token: "{{ config['credentials']['refresh_token'] }}"
                        token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
                        expires_in_name: expires_at
                  request_headers:
                    Square-Version: "2022-10-19"
                    Content-Type: "application/json"
                  error_handler:
                    type: CompositeErrorHandler
                    error_handlers:
                      - type: DefaultErrorHandler
                        backoff_strategies:
                          - type: "ConstantBackoffStrategy"
                            backoff_time_in_seconds: 30
                        response_filters:
                          - type: HttpResponseFilter
                            action: IGNORE
                            http_codes:
                              - 404
                              - 403
                          - type: HttpResponseFilter
                            action: FAIL
                            http_codes:
                              - 401
                            error_message:
                              Failed to authorize request. Please update your
                              access token to continue using the source.
                          - type: HttpResponseFilter
                            action: RETRY
                            http_codes:
                              - 429
                paginator:
                  type: DefaultPaginator
                  pagination_strategy:
                    type: "CursorPagination"
                    cursor_value: "{{ response['cursor'] }}"
                    stop_condition: "{{ 'cursor' not in response }}"
                    page_size: 100
                  page_size_option:
                    inject_into: "request_parameter"
                    field_name: "limit"
                  page_token_option:
                    type: RequestOption
                    inject_into: "request_parameter"
                    field_name: "cursor"
              schema_loader:
                type: InlineSchemaLoader
                schema:
                  type: object
                  properties:
                    id:
                      type:
                        - "null"
                        - string
                    name:
                      type:
                        - "null"
                        - string
                    address:
                      type:
                        - "null"
                        - object
                      properties:
                        address_line_1:
                          type:
                            - "null"
                            - string
                        locality:
                          type:
                            - "null"
                            - string
                        administrative_district_level_1:
                          type:
                            - "null"
                            - string
                        postal_code:
                          type:
                            - "null"
                            - string
                        country:
                          type:
                            - "null"
                            - string
                    timezone:
                      type:
                        - "null"
                        - string
                    capabilities:
                      type:
                        - "null"
                        - array
                      items:
                        type:
                          - "null"
                          - string
                    status:
                      type:
                        - "null"
                        - string
                    created_at:
                      type:
                        - "null"
                        - string
                    merchant_id:
                      type:
                        - "null"
                        - string
                    country:
                      type:
                        - "null"
                        - string
                    language_code:
                      type:
                        - "null"
                        - string
                    currency:
                      type:
                        - "null"
                        - string
                    phone_number:
                      type:
                        - "null"
                        - string
                    business_name:
                      type:
                        - "null"
                        - string
                    type:
                      type:
                        - "null"
                        - string
                    website_url:
                      type:
                        - "null"
                        - string
                    business_hours:
                      type:
                        - "null"
                        - object
                    business_email:
                      type:
                        - "null"
                        - string
                    description:
                      type:
                        - "null"
                        - string
                    twitter_username:
                      type:
                        - "null"
                        - string
                    instagram_username:
                      type:
                        - "null"
                        - string
                    facebook_url:
                      type:
                        - "null"
                        - string
                    mcc:
                      type:
                        - "null"
                        - string
            parent_key: "id"
            partition_field: "location_ids"
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: P30D
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          customer_id:
            type:
              - "null"
              - string
          line_items:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                catalog_object_id:
                  type:
                    - "null"
                    - string
                quantity:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                variation_name:
                  type:
                    - "null"
                    - string
                base_price_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                gross_sales_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_tax_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_discount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                variation_total_price_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                item_type:
                  type:
                    - "null"
                    - string
                modifiers:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      base_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      name:
                        type:
                          - "null"
                          - string
                      catalog_object_id:
                        type:
                          - "null"
                          - string
                applied_discounts:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      discount_uid:
                        type:
                          - "null"
                          - string
                      applied_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                applied_taxes:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      tax_uid:
                        type:
                          - "null"
                          - string
                      applied_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                note:
                  type:
                    - "null"
                    - string
          fulfillments:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                state:
                  type:
                    - "null"
                    - string
                pickup_details:
                  type:
                    - "null"
                    - object
                  properties:
                    expires_at:
                      type:
                        - "null"
                        - string
                    pickup_at:
                      type:
                        - "null"
                        - string
                    note:
                      type:
                        - "null"
                        - string
                    placed_at:
                      type:
                        - "null"
                        - string
                    accepted_at:
                      type:
                        - "null"
                        - string
                    ready_at:
                      type:
                        - "null"
                        - string
                    schedule_type:
                      type:
                        - "null"
                        - string
                    recipient:
                      type:
                        - "null"
                        - object
                      properties:
                        display_name:
                          type:
                            - "null"
                            - string
                        phone_number:
                          type:
                            - "null"
                            - string
                    auto_complete_duration:
                      type:
                        - "null"
                        - string
                    picked_up_at:
                      type:
                        - "null"
                        - string
                shipment_details:
                  type:
                    - "null"
                    - object
                  properties:
                    recipient:
                      type:
                        - "null"
                        - object
                      properties:
                        display_name:
                          type:
                            - "null"
                            - string
                        phone_number:
                          type:
                            - "null"
                            - string
                        address:
                          type:
                            - "null"
                            - object
                          properties:
                            address_line_1:
                              type:
                                - "null"
                                - string
                            locality:
                              type:
                                - "null"
                                - string
                            administrative_district_level_1:
                              type:
                                - "null"
                                - string
                            postal_code:
                              type:
                                - "null"
                                - string
                    carrier:
                      type:
                        - "null"
                        - string
                    tracking_number:
                      type:
                        - "null"
                        - string
                    placed_at:
                      type:
                        - "null"
                        - string
                    packaged_at:
                      type:
                        - "null"
                        - string
                    shipped_at:
                      type:
                        - "null"
                        - string
                    expected_shipped_at:
                      type:
                        - "null"
                        - string
                    in_progress_at:
                      type:
                        - "null"
                        - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          state:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          total_tax_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          total_discount_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          total_tip_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          total_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          closed_at:
            type:
              - "null"
              - string
          tenders:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                location_id:
                  type:
                    - "null"
                    - string
                transaction_id:
                  type:
                    - "null"
                    - string
                created_at:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                type:
                  type:
                    - "null"
                    - string
                card_details:
                  type:
                    - "null"
                    - object
                  properties:
                    status:
                      type:
                        - "null"
                        - string
                    card:
                      type:
                        - "null"
                        - object
                      properties:
                        card_brand:
                          type:
                            - "null"
                            - string
                        last_4:
                          type:
                            - "null"
                            - string
                        fingerprint:
                          type:
                            - "null"
                            - string
                    entry_method:
                      type:
                        - "null"
                        - string
                payment_id:
                  type:
                    - "null"
                    - string
                cash_details:
                  type:
                    - "null"
                    - object
                  properties:
                    buyer_tendered_money:
                      type:
                        - "null"
                        - object
                      properties:
                        amount:
                          type:
                            - "null"
                            - integer
                        currency:
                          type:
                            - "null"
                            - string
                    change_back_money:
                      type:
                        - "null"
                        - object
                      properties:
                        amount:
                          type:
                            - "null"
                            - integer
                        currency:
                          type:
                            - "null"
                            - string
                note:
                  type:
                    - "null"
                    - string
          total_service_charge_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          net_amounts:
            type:
              - "null"
              - object
            properties:
              total_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tax_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              discount_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tip_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              service_charge_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
          source:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
          returns:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                source_order_id:
                  type:
                    - "null"
                    - string
                return_line_items:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      quantity:
                        type:
                          - "null"
                          - string
                      item_type:
                        type:
                          - "null"
                          - string
                      base_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      variation_total_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      gross_return_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_tax_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_discount_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
          return_amounts:
            type:
              - "null"
              - object
            properties:
              total_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tax_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              discount_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tip_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              service_charge_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
          refunds:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                location_id:
                  type:
                    - "null"
                    - string
                transaction_id:
                  type:
                    - "null"
                    - string
                tender_id:
                  type:
                    - "null"
                    - string
                created_at:
                  type:
                    - "null"
                    - string
                reason:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                status:
                  type:
                    - "null"
                    - string
          service_charges:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                applied_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                calculation_phase:
                  type:
                    - "null"
                    - string
                taxable:
                  type:
                    - "null"
                    - boolean
                total_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_tax_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
          discounts:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                percentage:
                  type:
                    - "null"
                    - string
                applied_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                type:
                  type:
                    - "null"
                    - string
                scope:
                  type:
                    - "null"
                    - string
          taxes:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                catalog_object_id:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                percentage:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                applied_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                scope:
                  type:
                    - "null"
                    - string
  bank_accounts_stream:
    type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          id:
            type:
              - "null"
              - string
          account_number_suffix:
            type:
              - "null"
              - string
          country:
            type:
              - "null"
              - string
          currency:
            type:
              - "null"
              - string
          account_type:
            type:
              - "null"
              - string
          holder_name:
            type:
              - "null"
              - string
          primary_bank_identification_number:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          status:
            type:
              - "null"
              - string
          creditable:
            type:
              - "null"
              - boolean
          debitable:
            type:
              - "null"
              - boolean
          version:
            type:
              - "null"
              - integer
          bank_name:
            type:
              - "null"
              - string
streams:
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_parameters:
          sort_order: ASC
          sort_field: CREATED_AT
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          cards:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                card_brand:
                  type:
                    - "null"
                    - string
                last_4:
                  type:
                    - "null"
                    - string
                exp_month:
                  type:
                    - "null"
                    - integer
                exp_year:
                  type:
                    - "null"
                    - integer
                cardholder_name:
                  type:
                    - "null"
                    - string
                billing_address:
                  type:
                    - "null"
                    - object
                  properties:
                    postal_code:
                      type:
                        - "null"
                        - string
          given_name:
            type:
              - "null"
              - string
          family_name:
            type:
              - "null"
              - string
          email_address:
            type:
              - "null"
              - string
          address:
            type:
              - "null"
              - object
            properties:
              address_line_1:
                type:
                  - "null"
                  - string
              address_line_2:
                type:
                  - "null"
                  - string
              locality:
                type:
                  - "null"
                  - string
              administrative_district_level_1:
                type:
                  - "null"
                  - string
              postal_code:
                type:
                  - "null"
                  - string
          phone_number:
            type:
              - "null"
              - string
          reference_id:
            type:
              - "null"
              - string
          company_name:
            type:
              - "null"
              - string
          preferences:
            type:
              - "null"
              - object
            properties:
              email_unsubscribed:
                type: boolean
          creation_source:
            type:
              - "null"
              - string
          birthday:
            type:
              - "null"
              - string
          segment_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          group_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          version:
            type:
              - "null"
              - integer
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          name:
            type:
              - "null"
              - string
          address:
            type:
              - "null"
              - object
            properties:
              address_line_1:
                type:
                  - "null"
                  - string
              locality:
                type:
                  - "null"
                  - string
              administrative_district_level_1:
                type:
                  - "null"
                  - string
              postal_code:
                type:
                  - "null"
                  - string
              country:
                type:
                  - "null"
                  - string
          timezone:
            type:
              - "null"
              - string
          capabilities:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          status:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          merchant_id:
            type:
              - "null"
              - string
          country:
            type:
              - "null"
              - string
          language_code:
            type:
              - "null"
              - string
          currency:
            type:
              - "null"
              - string
          phone_number:
            type:
              - "null"
              - string
          business_name:
            type:
              - "null"
              - string
          type:
            type:
              - "null"
              - string
          website_url:
            type:
              - "null"
              - string
          business_hours:
            type:
              - "null"
              - object
          business_email:
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
          twitter_username:
            type:
              - "null"
              - string
          instagram_username:
            type:
              - "null"
              - string
          facebook_url:
            type:
              - "null"
              - string
          mcc:
            type:
              - "null"
              - string
  - retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        pagination_strategy:
          page_size: 200
        page_size_option:
          inject_into: "body_json"
          field_name: "limit"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          employee_id:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          timezone:
            type:
              - "null"
              - string
          start_at:
            type:
              - "null"
              - string
          end_at:
            type:
              - "null"
              - string
          wage:
            type:
              - "null"
              - object
            properties:
              title:
                type:
                  - "null"
                  - string
              hourly_rate:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
          breaks:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                start_at:
                  type:
                    - "null"
                    - string
                end_at:
                  type:
                    - "null"
                    - string
                break_type_id:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                expected_duration:
                  type:
                    - "null"
                    - string
                is_paid:
                  type:
                    - "null"
                    - boolean
          status:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          team_member_id:
            type:
              - "null"
              - string
  - retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          is_owner:
            type:
              - "null"
              - boolean
          status:
            type:
              - "null"
              - string
          given_name:
            type:
              - "null"
              - string
          family_name:
            type:
              - "null"
              - string
          email_address:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          assigned_locations:
            type:
              - "null"
              - object
            properties:
              assignment_type:
                type:
                  - "null"
                  - string
          reference_id:
            type:
              - "null"
              - string
          phone_number:
            type:
              - "null"
              - string
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_parameters:
          sort_order: ASC
          sort_field: CREATED_AT
      paginator:
        pagination_strategy:
          page_size: 200
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          team_member_id:
            type:
              - "null"
              - string
          title:
            type:
              - "null"
              - string
          hourly_rate:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          custom_attribute_values:
            type:
              - "null"
              - object
          present_at_all_locations:
            type:
              - "null"
              - boolean
          item_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              description:
                type:
                  - "null"
                  - string
              visibility:
                type:
                  - "null"
                  - string
              category_id:
                type:
                  - "null"
                  - string
              modifier_list_info:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    modifier_list_id:
                      type:
                        - "null"
                        - string
                    visibility:
                      type:
                        - "null"
                        - string
                    min_selected_modifiers:
                      type:
                        - "null"
                        - integer
                    max_selected_modifiers:
                      type:
                        - "null"
                        - integer
                    enabled:
                      type:
                        - "null"
                        - boolean
              variations:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    type:
                      type:
                        - "null"
                        - string
                    id:
                      type:
                        - "null"
                        - string
                    updated_at:
                      type:
                        - "null"
                        - string
                    version:
                      type:
                        - "null"
                        - integer
                    is_deleted:
                      type:
                        - "null"
                        - boolean
                    present_at_all_locations:
                      type:
                        - "null"
                        - boolean
                    item_variation_data:
                      type:
                        - "null"
                        - object
                      properties:
                        item_id:
                          type:
                            - "null"
                            - string
                        name:
                          type:
                            - "null"
                            - string
                        sku:
                          type:
                            - "null"
                            - string
                        ordinal:
                          type:
                            - "null"
                            - integer
                        pricing_type:
                          type:
                            - "null"
                            - string
                        price_money:
                          type:
                            - "null"
                            - object
                          properties:
                            amount:
                              type:
                                - "null"
                                - integer
                            currency:
                              type:
                                - "null"
                                - string
                        location_overrides:
                          type:
                            - "null"
                            - array
                          items:
                            type:
                              - "null"
                              - object
                            properties:
                              location_id:
                                type:
                                  - "null"
                                  - string
                              track_inventory:
                                type:
                                  - "null"
                                  - boolean
                        item_option_values:
                          type:
                            - "null"
                            - array
                          items:
                            type:
                              - "null"
                              - object
                            properties:
                              item_option_id:
                                type:
                                  - "null"
                                  - string
                              item_option_value_id:
                                type:
                                  - "null"
                                  - string
                    present_at_location_ids:
                      type:
                        - "null"
                        - array
                      items:
                        type:
                          - "null"
                          - string
              product_type:
                type:
                  - "null"
                  - string
              skip_modifier_screen:
                type:
                  - "null"
                  - boolean
              item_options:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    item_option_id:
                      type:
                        - "null"
                        - string
              ecom_visibility:
                type:
                  - "null"
                  - string
              tax_ids:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - string
          image_id:
            type:
              - "null"
              - string
          present_at_location_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          category_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          present_at_location_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
          discount_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              discount_type:
                type:
                  - "null"
                  - string
              percentage:
                type:
                  - "null"
                  - string
              application_method:
                type:
                  - "null"
                  - string
              modify_tax_basis:
                type:
                  - "null"
                  - string
              amount_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              pin_required:
                type:
                  - "null"
                  - boolean
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          tax_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              calculation_phase:
                type:
                  - "null"
                  - string
              inclusion_type:
                type:
                  - "null"
                  - string
              percentage:
                type:
                  - "null"
                  - string
              applies_to_custom_amounts:
                type:
                  - "null"
                  - boolean
              enabled:
                type:
                  - "null"
                  - boolean
              tax_type_id:
                type:
                  - "null"
                  - string
              tax_type_name:
                type:
                  - "null"
                  - string
          absent_at_location_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "objects"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          include_related_objects: "{{ False }}"
          include_deleted_objects: "{{ config['include_deleted_objects'] }}"
          object_types: "{{ [parameters['object_type']] }}"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 1000
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          type:
            type:
              - "null"
              - string
          id:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          is_deleted:
            type:
              - "null"
              - boolean
          present_at_all_locations:
            type:
              - "null"
              - boolean
          modifier_list_data:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              selection_type:
                type:
                  - "null"
                  - string
              modifiers:
                type:
                  - "null"
                  - array
                items:
                  type:
                    - "null"
                    - object
                  properties:
                    type:
                      type:
                        - "null"
                        - string
                    id:
                      type:
                        - "null"
                        - string
                    updated_at:
                      type:
                        - "null"
                        - string
                    version:
                      type:
                        - "null"
                        - integer
                    is_deleted:
                      type:
                        - "null"
                        - boolean
                    present_at_all_locations:
                      type:
                        - "null"
                        - boolean
                    modifier_data:
                      type:
                        - "null"
                        - object
                      properties:
                        name:
                          type:
                            - "null"
                            - string
                        price_money:
                          type:
                            - "null"
                            - object
                          properties:
                            amount:
                              type:
                                - "null"
                                - integer
                            currency:
                              type:
                                - "null"
                                - string
                        on_by_default:
                          type:
                            - "null"
                            - boolean
                        ordinal:
                          type:
                            - "null"
                            - integer
                        modifier_list_id:
                          type:
                            - "null"
                            - string
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "created_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          sort_order: "ASC"
          sort_field: "CREATED_AT"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 100
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          status:
            type:
              - "null"
              - string
          amount_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
            required:
              - amount
              - currency
          payment_id:
            type:
              - "null"
              - string
          order_id:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          reason:
            type:
              - "null"
              - string
          processing_fee:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                effective_at:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "counts"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          limit: "{{ 500 }}"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Inventory Schema
        additionalProperties: true
        type: object
        properties:
          catalog_object_id:
            type:
              - string
              - "null"
          catalog_object_type:
            type:
              - string
              - "null"
          state:
            type:
              - string
              - "null"
          location_id:
            type:
              - string
              - "null"
          quantity:
            type:
              - string
              - "null"
          calculated_at:
            type:
              - string
              - "null"
  - incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      end_datetime:
        datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%S.%fZ') }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: "P30D"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "created_at"
      start_time_option:
        field_name: begin_time
        inject_into: body_json
      end_time_option:
        field_name: end_time
        inject_into: body_json
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          sort_order: "ASC"
          sort_field: "CREATED_AT"
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          page_size: 100
          type: "CursorPagination"
          cursor_value: "{{ response.cursor }}"
          stop_condition: "{{ 'cursor' not in response }}"
        page_token_option:
          type: RequestOption
          field_name: "cursor"
          inject_into: "body_json"
        page_size_option:
          field_name: "limit"
          inject_into: "body_json"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          amount_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          customer_id:
            type:
              - "null"
              - string
          status:
            type:
              - "null"
              - string
          delay_duration:
            type:
              - "null"
              - string
          source_type:
            type:
              - "null"
              - string
          card_details:
            type:
              - "null"
              - object
            properties:
              status:
                type:
                  - "null"
                  - string
              card:
                type:
                  - "null"
                  - object
                properties:
                  card_brand:
                    type:
                      - "null"
                      - string
                  last_4:
                    type:
                      - "null"
                      - string
                  exp_month:
                    type:
                      - "null"
                      - integer
                  exp_year:
                    type:
                      - "null"
                      - integer
                  fingerprint:
                    type:
                      - "null"
                      - string
                  card_type:
                    type:
                      - "null"
                      - string
                  prepaid_type:
                    type:
                      - "null"
                      - string
                  bin:
                    type:
                      - "null"
                      - string
              entry_method:
                type:
                  - "null"
                  - string
              cvv_status:
                type:
                  - "null"
                  - string
              avs_status:
                type:
                  - "null"
                  - string
              statement_description:
                type:
                  - "null"
                  - string
              card_payment_timeline:
                type:
                  - "null"
                  - object
                properties:
                  authorized_at:
                    type:
                      - "null"
                      - string
                  captured_at:
                    type:
                      - "null"
                      - string
                  voided_at:
                    type:
                      - "null"
                      - string
          location_id:
            type:
              - "null"
              - string
          order_id:
            type:
              - "null"
              - string
          risk_evaluation:
            type:
              - "null"
              - object
            properties:
              created_at:
                type:
                  - "null"
                  - string
              risk_level:
                type:
                  - "null"
                  - string
          processing_fee:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                effective_at:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
          total_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          approved_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          receipt_number:
            type:
              - "null"
              - string
          receipt_url:
            type:
              - "null"
              - string
          delay_action:
            type:
              - "null"
              - string
          delayed_until:
            type:
              - "null"
              - string
          version_token:
            type:
              - "null"
              - string
          note:
            type:
              - "null"
              - string
          employee_id:
            type:
              - "null"
              - string
          refunded_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          refund_ids:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - string
  - retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          limit: "{{ 500 }}"
          filter:
            date_time_filter:
              updated_at:
                start_at: "{{ stream_slice.start_time }}"
          sort:
            sort_field: "UPDATED_AT"
            sort_order: "ASC"
          location_ids: "{{ [ stream_slice.location_ids ] }}"
      partition_router:
        type: "SubstreamPartitionRouter"
        parent_stream_configs:
          - stream:
              type: DeclarativeStream
              retriever:
                record_selector:
                  extractor:
                    field_path:
                      - "{{ parameters['name'] }}"
                requester:
                  url_base:
                    "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
                    else 'https://connect.squareup.com/v2' }}"
                  http_method: "GET"
                  authenticator:
                    type: SelectiveAuthenticator
                    authenticator_selection_path:
                      - "credentials"
                      - "auth_type"
                    authenticators:
                      API Key:
                        type: BearerAuthenticator
                        api_token: "{{ config['credentials']['api_key'] }}"
                      OAuth:
                        type: OAuthAuthenticator
                        token_refresh_endpoint: https://connect.squareup.com/oauth2/token
                        client_id: "{{ config['credentials']['client_id'] }}"
                        client_secret: "{{ config['credentials']['client_secret'] }}"
                        refresh_token: "{{ config['credentials']['refresh_token'] }}"
                        token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
                        expires_in_name: expires_at
                  request_headers:
                    Square-Version: "2022-10-19"
                    Content-Type: "application/json"
                  error_handler:
                    type: CompositeErrorHandler
                    error_handlers:
                      - type: DefaultErrorHandler
                        backoff_strategies:
                          - type: "ConstantBackoffStrategy"
                            backoff_time_in_seconds: 30
                        response_filters:
                          - type: HttpResponseFilter
                            action: IGNORE
                            http_codes:
                              - 404
                              - 403
                          - type: HttpResponseFilter
                            action: FAIL
                            http_codes:
                              - 401
                            error_message:
                              Failed to authorize request. Please update your
                              access token to continue using the source.
                          - type: HttpResponseFilter
                            action: RETRY
                            http_codes:
                              - 429
                paginator:
                  type: DefaultPaginator
                  pagination_strategy:
                    type: "CursorPagination"
                    cursor_value: "{{ response['cursor'] }}"
                    stop_condition: "{{ 'cursor' not in response }}"
                    page_size: 100
                  page_size_option:
                    inject_into: "request_parameter"
                    field_name: "limit"
                  page_token_option:
                    type: RequestOption
                    inject_into: "request_parameter"
                    field_name: "cursor"
              schema_loader:
                type: InlineSchemaLoader
                schema:
                  type: object
                  properties:
                    id:
                      type:
                        - "null"
                        - string
                    name:
                      type:
                        - "null"
                        - string
                    address:
                      type:
                        - "null"
                        - object
                      properties:
                        address_line_1:
                          type:
                            - "null"
                            - string
                        locality:
                          type:
                            - "null"
                            - string
                        administrative_district_level_1:
                          type:
                            - "null"
                            - string
                        postal_code:
                          type:
                            - "null"
                            - string
                        country:
                          type:
                            - "null"
                            - string
                    timezone:
                      type:
                        - "null"
                        - string
                    capabilities:
                      type:
                        - "null"
                        - array
                      items:
                        type:
                          - "null"
                          - string
                    status:
                      type:
                        - "null"
                        - string
                    created_at:
                      type:
                        - "null"
                        - string
                    merchant_id:
                      type:
                        - "null"
                        - string
                    country:
                      type:
                        - "null"
                        - string
                    language_code:
                      type:
                        - "null"
                        - string
                    currency:
                      type:
                        - "null"
                        - string
                    phone_number:
                      type:
                        - "null"
                        - string
                    business_name:
                      type:
                        - "null"
                        - string
                    type:
                      type:
                        - "null"
                        - string
                    website_url:
                      type:
                        - "null"
                        - string
                    business_hours:
                      type:
                        - "null"
                        - object
                    business_email:
                      type:
                        - "null"
                        - string
                    description:
                      type:
                        - "null"
                        - string
                    twitter_username:
                      type:
                        - "null"
                        - string
                    instagram_username:
                      type:
                        - "null"
                        - string
                    facebook_url:
                      type:
                        - "null"
                        - string
                    mcc:
                      type:
                        - "null"
                        - string
            parent_key: "id"
            partition_field: "location_ids"
    incremental_sync:
      type: DatetimeBasedCursor
      start_datetime:
        datetime:
          "{{ format_datetime(config['start_date'], '%Y-%m-%dT%H:%M:%S.%fZ')
          }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      step: P30D
      datetime_format: "%Y-%m-%dT%H:%M:%S.%fZ"
      cursor_granularity: "PT0.000001S"
      cursor_field: "updated_at"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        properties:
          id:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          customer_id:
            type:
              - "null"
              - string
          line_items:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                catalog_object_id:
                  type:
                    - "null"
                    - string
                quantity:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                variation_name:
                  type:
                    - "null"
                    - string
                base_price_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                gross_sales_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_tax_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_discount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                variation_total_price_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                item_type:
                  type:
                    - "null"
                    - string
                modifiers:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      base_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      name:
                        type:
                          - "null"
                          - string
                      catalog_object_id:
                        type:
                          - "null"
                          - string
                applied_discounts:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      discount_uid:
                        type:
                          - "null"
                          - string
                      applied_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                applied_taxes:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      tax_uid:
                        type:
                          - "null"
                          - string
                      applied_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                note:
                  type:
                    - "null"
                    - string
          fulfillments:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                state:
                  type:
                    - "null"
                    - string
                pickup_details:
                  type:
                    - "null"
                    - object
                  properties:
                    expires_at:
                      type:
                        - "null"
                        - string
                    pickup_at:
                      type:
                        - "null"
                        - string
                    note:
                      type:
                        - "null"
                        - string
                    placed_at:
                      type:
                        - "null"
                        - string
                    accepted_at:
                      type:
                        - "null"
                        - string
                    ready_at:
                      type:
                        - "null"
                        - string
                    schedule_type:
                      type:
                        - "null"
                        - string
                    recipient:
                      type:
                        - "null"
                        - object
                      properties:
                        display_name:
                          type:
                            - "null"
                            - string
                        phone_number:
                          type:
                            - "null"
                            - string
                    auto_complete_duration:
                      type:
                        - "null"
                        - string
                    picked_up_at:
                      type:
                        - "null"
                        - string
                shipment_details:
                  type:
                    - "null"
                    - object
                  properties:
                    recipient:
                      type:
                        - "null"
                        - object
                      properties:
                        display_name:
                          type:
                            - "null"
                            - string
                        phone_number:
                          type:
                            - "null"
                            - string
                        address:
                          type:
                            - "null"
                            - object
                          properties:
                            address_line_1:
                              type:
                                - "null"
                                - string
                            locality:
                              type:
                                - "null"
                                - string
                            administrative_district_level_1:
                              type:
                                - "null"
                                - string
                            postal_code:
                              type:
                                - "null"
                                - string
                    carrier:
                      type:
                        - "null"
                        - string
                    tracking_number:
                      type:
                        - "null"
                        - string
                    placed_at:
                      type:
                        - "null"
                        - string
                    packaged_at:
                      type:
                        - "null"
                        - string
                    shipped_at:
                      type:
                        - "null"
                        - string
                    expected_shipped_at:
                      type:
                        - "null"
                        - string
                    in_progress_at:
                      type:
                        - "null"
                        - string
          created_at:
            type:
              - "null"
              - string
          updated_at:
            type:
              - "null"
              - string
          state:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - integer
          total_tax_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          total_discount_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          total_tip_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          total_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          closed_at:
            type:
              - "null"
              - string
          tenders:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                location_id:
                  type:
                    - "null"
                    - string
                transaction_id:
                  type:
                    - "null"
                    - string
                created_at:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                type:
                  type:
                    - "null"
                    - string
                card_details:
                  type:
                    - "null"
                    - object
                  properties:
                    status:
                      type:
                        - "null"
                        - string
                    card:
                      type:
                        - "null"
                        - object
                      properties:
                        card_brand:
                          type:
                            - "null"
                            - string
                        last_4:
                          type:
                            - "null"
                            - string
                        fingerprint:
                          type:
                            - "null"
                            - string
                    entry_method:
                      type:
                        - "null"
                        - string
                payment_id:
                  type:
                    - "null"
                    - string
                cash_details:
                  type:
                    - "null"
                    - object
                  properties:
                    buyer_tendered_money:
                      type:
                        - "null"
                        - object
                      properties:
                        amount:
                          type:
                            - "null"
                            - integer
                        currency:
                          type:
                            - "null"
                            - string
                    change_back_money:
                      type:
                        - "null"
                        - object
                      properties:
                        amount:
                          type:
                            - "null"
                            - integer
                        currency:
                          type:
                            - "null"
                            - string
                note:
                  type:
                    - "null"
                    - string
          total_service_charge_money:
            type:
              - "null"
              - object
            properties:
              amount:
                type:
                  - "null"
                  - integer
              currency:
                type:
                  - "null"
                  - string
          net_amounts:
            type:
              - "null"
              - object
            properties:
              total_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tax_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              discount_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tip_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              service_charge_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
          source:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
          returns:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                source_order_id:
                  type:
                    - "null"
                    - string
                return_line_items:
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      uid:
                        type:
                          - "null"
                          - string
                      quantity:
                        type:
                          - "null"
                          - string
                      item_type:
                        type:
                          - "null"
                          - string
                      base_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      variation_total_price_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      gross_return_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_tax_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_discount_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
                      total_money:
                        type:
                          - "null"
                          - object
                        properties:
                          amount:
                            type:
                              - "null"
                              - integer
                          currency:
                            type:
                              - "null"
                              - string
          return_amounts:
            type:
              - "null"
              - object
            properties:
              total_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tax_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              discount_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              tip_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
              service_charge_money:
                type:
                  - "null"
                  - object
                properties:
                  amount:
                    type:
                      - "null"
                      - integer
                  currency:
                    type:
                      - "null"
                      - string
          refunds:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                id:
                  type:
                    - "null"
                    - string
                location_id:
                  type:
                    - "null"
                    - string
                transaction_id:
                  type:
                    - "null"
                    - string
                tender_id:
                  type:
                    - "null"
                    - string
                created_at:
                  type:
                    - "null"
                    - string
                reason:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                status:
                  type:
                    - "null"
                    - string
          service_charges:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                amount_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                applied_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                calculation_phase:
                  type:
                    - "null"
                    - string
                taxable:
                  type:
                    - "null"
                    - boolean
                total_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                total_tax_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
          discounts:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                percentage:
                  type:
                    - "null"
                    - string
                applied_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                type:
                  type:
                    - "null"
                    - string
                scope:
                  type:
                    - "null"
                    - string
          taxes:
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                uid:
                  type:
                    - "null"
                    - string
                catalog_object_id:
                  type:
                    - "null"
                    - string
                name:
                  type:
                    - "null"
                    - string
                percentage:
                  type:
                    - "null"
                    - string
                type:
                  type:
                    - "null"
                    - string
                applied_money:
                  type:
                    - "null"
                    - object
                  properties:
                    amount:
                      type:
                        - "null"
                        - integer
                    currency:
                      type:
                        - "null"
                        - string
                scope:
                  type:
                    - "null"
                    - string
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "{{ parameters['name'] }}"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
      paginator:
        type: DefaultPaginator
        pagination_strategy:
          type: "CursorPagination"
          cursor_value: "{{ response['cursor'] }}"
          stop_condition: "{{ 'cursor' not in response }}"
          page_size: 100
        page_size_option:
          inject_into: "request_parameter"
          field_name: "limit"
        page_token_option:
          type: RequestOption
          inject_into: "request_parameter"
          field_name: "cursor"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          id:
            type:
              - "null"
              - string
          account_number_suffix:
            type:
              - "null"
              - string
          country:
            type:
              - "null"
              - string
          currency:
            type:
              - "null"
              - string
          account_type:
            type:
              - "null"
              - string
          holder_name:
            type:
              - "null"
              - string
          primary_bank_identification_number:
            type:
              - "null"
              - string
          location_id:
            type:
              - "null"
              - string
          status:
            type:
              - "null"
              - string
          creditable:
            type:
              - "null"
              - boolean
          debitable:
            type:
              - "null"
              - boolean
          version:
            type:
              - "null"
              - integer
          bank_name:
            type:
              - "null"
              - string
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "cash_drawer_shifts"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "GET"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_parameters:
          location_id: "{{ stream_partition.location_id }}"
      partition_router:
        type: SubstreamPartitionRouter
        parent_stream_configs:
          - stream:
              type: DeclarativeStream
              retriever:
                record_selector:
                  extractor:
                    field_path:
                      - "{{ parameters['name'] }}"
                requester:
                  url_base:
                    "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
                    else 'https://connect.squareup.com/v2' }}"
                  http_method: "GET"
                  authenticator:
                    type: SelectiveAuthenticator
                    authenticator_selection_path:
                      - "credentials"
                      - "auth_type"
                    authenticators:
                      API Key:
                        type: BearerAuthenticator
                        api_token: "{{ config['credentials']['api_key'] }}"
                      OAuth:
                        type: OAuthAuthenticator
                        token_refresh_endpoint: https://connect.squareup.com/oauth2/token
                        client_id: "{{ config['credentials']['client_id'] }}"
                        client_secret: "{{ config['credentials']['client_secret'] }}"
                        refresh_token: "{{ config['credentials']['refresh_token'] }}"
                        token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
                        expires_in_name: expires_at
                  request_headers:
                    Square-Version: "2022-10-19"
                    Content-Type: "application/json"
                  error_handler:
                    type: CompositeErrorHandler
                    error_handlers:
                      - type: DefaultErrorHandler
                        backoff_strategies:
                          - type: "ConstantBackoffStrategy"
                            backoff_time_in_seconds: 30
                        response_filters:
                          - type: HttpResponseFilter
                            action: IGNORE
                            http_codes:
                              - 404
                              - 403
                          - type: HttpResponseFilter
                            action: FAIL
                            http_codes:
                              - 401
                            error_message:
                              Failed to authorize request. Please update your
                              access token to continue using the source.
                          - type: HttpResponseFilter
                            action: RETRY
                            http_codes:
                              - 429
                paginator:
                  type: DefaultPaginator
                  pagination_strategy:
                    type: "CursorPagination"
                    cursor_value: "{{ response['cursor'] }}"
                    stop_condition: "{{ 'cursor' not in response }}"
                    page_size: 100
                  page_size_option:
                    inject_into: "request_parameter"
                    field_name: "limit"
                  page_token_option:
                    type: RequestOption
                    inject_into: "request_parameter"
                    field_name: "cursor"
              schema_loader:
                type: InlineSchemaLoader
                schema:
                  type: object
                  properties:
                    id:
                      type:
                        - "null"
                        - string
                    name:
                      type:
                        - "null"
                        - string
                    address:
                      type:
                        - "null"
                        - object
                      properties:
                        address_line_1:
                          type:
                            - "null"
                            - string
                        locality:
                          type:
                            - "null"
                            - string
                        administrative_district_level_1:
                          type:
                            - "null"
                            - string
                        postal_code:
                          type:
                            - "null"
                            - string
                        country:
                          type:
                            - "null"
                            - string
                    timezone:
                      type:
                        - "null"
                        - string
                    capabilities:
                      type:
                        - "null"
                        - array
                      items:
                        type:
                          - "null"
                          - string
                    status:
                      type:
                        - "null"
                        - string
                    created_at:
                      type:
                        - "null"
                        - string
                    merchant_id:
                      type:
                        - "null"
                        - string
                    country:
                      type:
                        - "null"
                        - string
                    language_code:
                      type:
                        - "null"
                        - string
                    currency:
                      type:
                        - "null"
                        - string
                    phone_number:
                      type:
                        - "null"
                        - string
                    business_name:
                      type:
                        - "null"
                        - string
                    type:
                      type:
                        - "null"
                        - string
                    website_url:
                      type:
                        - "null"
                        - string
                    business_hours:
                      type:
                        - "null"
                        - object
                    business_email:
                      type:
                        - "null"
                        - string
                    description:
                      type:
                        - "null"
                        - string
                    twitter_username:
                      type:
                        - "null"
                        - string
                    instagram_username:
                      type:
                        - "null"
                        - string
                    facebook_url:
                      type:
                        - "null"
                        - string
                    mcc:
                      type:
                        - "null"
                        - string
            parent_key: "id"
            partition_field: "location_id"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Cash Drawer Shifts Schema
        additionalProperties: true
        type: object
        properties:
          id:
            type:
              - string
              - "null"
          state:
            type:
              - string
              - "null"
          opened_at:
            type:
              - string
              - "null"
          ended_at:
            type:
              - string
              - "null"
          closed_at:
            type:
              - string
              - "null"
          description:
            type:
              - string
              - "null"
          opened_cash_money:
            type:
              - object
              - "null"
            properties:
              amount:
                type:
                  - number
                  - "null"
              currency:
                type:
                  - string
                  - "null"
          expected_cash_money:
            type:
              - object
              - "null"
            properties:
              amount:
                type:
                  - number
                  - "null"
              currency:
                type:
                  - string
                  - "null"
          closed_cash_money:
            type:
              - object
              - "null"
            properties:
              amount:
                type:
                  - number
                  - "null"
              currency:
                type:
                  - string
                  - "null"
  - type: DeclarativeStream
    retriever:
      record_selector:
        extractor:
          field_path:
            - "loyalty_accounts"
      requester:
        url_base:
          "{{ 'https://connect.squareupsandbox.com/v2' if config['is_sandbox']
          else 'https://connect.squareup.com/v2' }}"
        http_method: "POST"
        authenticator:
          type: SelectiveAuthenticator
          authenticator_selection_path:
            - "credentials"
            - "auth_type"
          authenticators:
            API Key:
              type: BearerAuthenticator
              api_token: "{{ config['credentials']['api_key'] }}"
            OAuth:
              type: OAuthAuthenticator
              token_refresh_endpoint: https://connect.squareup.com/oauth2/token
              client_id: "{{ config['credentials']['client_id'] }}"
              client_secret: "{{ config['credentials']['client_secret'] }}"
              refresh_token: "{{ config['credentials']['refresh_token'] }}"
              token_expiry_date_format: "YYYY-MM-DDTHH:mm:ss[Z]"
              expires_in_name: expires_at
        request_headers:
          Square-Version: "2022-10-19"
          Content-Type: "application/json"
        error_handler:
          type: CompositeErrorHandler
          error_handlers:
            - type: DefaultErrorHandler
              backoff_strategies:
                - type: "ConstantBackoffStrategy"
                  backoff_time_in_seconds: 30
              response_filters:
                - type: HttpResponseFilter
                  action: IGNORE
                  http_codes:
                    - 404
                    - 403
                - type: HttpResponseFilter
                  action: FAIL
                  http_codes:
                    - 401
                  error_message:
                    Failed to authorize request. Please update your access
                    token to continue using the source.
                - type: HttpResponseFilter
                  action: RETRY
                  http_codes:
                    - 429
        request_body_json:
          limit: "{{ 200 }}"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Loyalty schema
        type: object
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          mapping:
            type:
              - object
              - "null"
            properties:
              id:
                type:
                  - string
                  - "null"
              phone_number:
                type:
                  - string
                  - "null"
              created_at:
                type:
                  - string
                  - "null"
          program_id:
            type:
              - string
              - "null"
          balance:
            type:
              - number
              - "null"
          lifetime_points:
            type:
              - number
              - "null"
          customer_id:
            type:
              - string
              - "null"
          created_at:
            type:
              - string
              - "null"
          updated_at:
            type:
              - string
              - "null"
check:
  stream_names:
    - "locations"
spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/square
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Square Spec
    type: object
    required:
      - is_sandbox
    additionalProperties: true
    properties:
      credentials:
        title: Authentication
        description: Choose how to authenticate to Square.
        type: object
        order: 0
        oneOf:
          - title: Oauth authentication
            type: object
            required:
              - auth_type
              - client_id
              - client_secret
              - refresh_token
            properties:
              auth_type:
                type: string
                const: OAuth
                order: 0
              client_id:
                type: string
                title: Client ID
                description: The Square-issued ID of your application
                airbyte_secret: true
              client_secret:
                type: string
                title: Client Secret
                description: The Square-issued application secret for your application
                airbyte_secret: true
              refresh_token:
                title: Refresh Token
                type: string
                description:
                  A refresh token generated using the above client ID and
                  secret
                airbyte_secret: true
          - title: API key
            type: object
            required:
              - auth_type
              - api_key
            properties:
              auth_type:
                type: string
                const: API Key
                order: 1
              api_key:
                type: string
                title: API key token
                description: The API key for a Square application
                airbyte_secret: true
      is_sandbox:
        type: boolean
        description: Determines whether to use the sandbox or production environment.
        title: Sandbox
        default: false
        order: 1
      start_date:
        type: string
        description:
          UTC date in the format YYYY-MM-DD. Any data before this date
          will not be replicated. If not set, all data will be replicated.
        title: Start Date
        default: "2021-01-01"
        pattern: ^[0-9]{4}-[0-9]{2}-[0-9]{2}$
        order: 2
        format: date
      include_deleted_objects:
        type: boolean
        description:
          In some streams there is an option to include deleted objects
          (Items, Categories, Discounts, Taxes)
        title: Include Deleted Objects
        default: false
        order: 3
  advanced_auth:
    auth_flow_type: oauth2.0
    predicate_key:
      - credentials
      - auth_type
    predicate_value: OAuth
    oauth_config_specification:
      complete_oauth_output_specification:
        type: object
        additionalProperties: false
        properties:
          refresh_token:
            type: string
            path_in_connector_config:
              - credentials
              - refresh_token
      complete_oauth_server_input_specification:
        type: object
        additionalProperties: false
        properties:
          client_id:
            type: string
          client_secret:
            type: string
      complete_oauth_server_output_specification:
        type: object
        additionalProperties: false
        properties:
          client_id:
            type: string
            path_in_connector_config:
              - credentials
              - client_id
          client_secret:
            type: string
            path_in_connector_config:
              - credentials
              - client_secret
