checker:
  type: HttpRequestChecker
  requester:
    type: HttpRequester
    url: https://track.customer.io/api/v1/accounts/region
    method: GET
    authenticator:
      type: BasicAccessAuthenticator
      username: '{{ config["credentials"]["siteId"] }}'
      password: '{{ config["credentials"]["apiKey"] }}'
spec:
  connection_specification:
    "$schema": http://json-schema.org/draft-07/schema#
    title: Customer Io Specification
    type: object
    additionalProperties: true
    properties:
      credentials:
        description: Enter the site ID and API key to authenticate.
        title: Credentials
        order: 0
        type: object
        additionalProperties: true
        properties:
          siteId:
            type: string
            description:
              Enter your Customer IO <a href="https://docs.customer.io/integrations/sdk/ios/getting-started/auth/#get-your-api-key">Site
              ID</a>.
            title: Site ID
            airbyte_secret: true
            always_show: true
            order: 1
          apiKey:
            type: string
            description:
              Enter your Customer IO <a href="https://docs.customer.io/integrations/sdk/ios/getting-started/auth/#get-your-api-key">API
              Key</a>.
            title: API Key
            airbyte_secret: true
            always_show: true
            order: 2
        required:
          - siteId
          - apiKey
    required:
      - credentials
discover:
  type: CompositeCatalogOperations
  operations:
    - type: StaticCatalogOperation
      object_name: person_identify
      destination_import_mode:
        type: Upsert
      schema:
        type: object
        additionalProperties: true
        properties:
          person_email:
            type: string
      matching_keys:
        - - person_email
    - type: StaticCatalogOperation
      object_name: person_event
      destination_import_mode:
        type: Insert
      schema:
        type: object
        required:
          - person_email
          - event_name
        additionalProperties: true
        properties:
          person_email:
            type: string
          event_name:
            type: string
          event_id:
            type: string
          timestamp:
            type: integer
