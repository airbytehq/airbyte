version: "0.29.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: ["data"]

  requester:
    type: HttpRequester
    url_base: "https://{{ config['wrike_instance'] }}/api/v4/"
    http_method: "GET"
    authenticator:
      type: BearerAuthenticator
      api_token: "{{ config['access_token'] }}"

  base_paginator:
    type: "DefaultPaginator"
    pagination_strategy:
      type: "CursorPagination"
      cursor_value: "{{ last_records['nextPageToken'] }}"
    page_token_option:
      type: "RequestPath"
      field_name: "nextPageToken"
      inject_into: "request_parameter"

  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      $ref: "#/definitions/base_paginator"
    requester:
      $ref: "#/definitions/requester"

  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"

  customfields_stream:
    $ref: "#/definitions/base_stream"
    name: "customfields"
    primary_key: "id"
    $parameters:
      path: "customfields"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - object
          - "null"
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          accountId:
            type:
              - string
              - "null"
          type:
            type:
              - string
              - "null"
          title:
            type:
              - string
              - "null"
          spaceId:
            type:
              - "null"
              - string
          sharedIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
          settings:
            type:
              - object
              - "null"
            properties:
              inheritanceType:
                type:
                  - string
                  - "null"
              values:
                type:
                  - array
                  - "null"
                items:
                  type:
                    - string
                    - integer
                    - number
                    - boolean
                    - "null"
              decimalPlaces:
                type:
                  - integer
                  - "null"
              useThousandsSeparator:
                type:
                  - boolean
                  - "null"
              readOnly:
                type:
                  - boolean
                  - "null"
              allowTime:
                type:
                  - boolean
                  - "null"
              allowOtherValues:
                type:
                  - boolean
                  - "null"
              aggregation:
                type:
                  - string
                  - "null"
              currency:
                type:
                  - string
                  - "null"
  contacts_stream:
    $ref: "#/definitions/base_stream"
    primary_key: "id"
    $parameters:
      name: "contacts"
      path: "contacts"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - object
          - "null"
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          firstName:
            type:
              - string
              - "null"
          lastName:
            type:
              - string
              - "null"
          avatarUrl:
            type:
              - string
              - "null"
          timezone:
            type:
              - string
              - "null"
          locale:
            type:
              - string
              - "null"
          deleted:
            type:
              - boolean
              - "null"
          type:
            type:
              - string
              - "null"
          profiles:
            type:
              - array
              - "null"
            items:
              type:
                - object
                - "null"
              properties:
                accountId:
                  type:
                    - string
                    - "null"
                role:
                  type:
                    - string
                    - "null"
                external:
                  type:
                    - boolean
                    - "null"
                admin:
                  type:
                    - boolean
                    - "null"
                owner:
                  type:
                    - boolean
                    - "null"
                email:
                  type:
                    - string
                    - "null"
          title:
            type:
              - "null"
              - string
          me:
            type:
              - "null"
              - boolean
          companyName:
            type:
              - "null"
              - string
          phone:
            type:
              - "null"
              - string
          myTeam:
            type:
              - "null"
              - boolean
          memberIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
  workflows_stream:
    $ref: "#/definitions/base_stream"
    name: "workflows"
    primary_key: "id"
    $parameters:
      path: "workflows"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - object
          - "null"
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          name:
            type:
              - string
              - "null"
          standard:
            type:
              - string
              - "null"
          hidden:
            type:
              - string
              - "null"
          customStatuses:
            type:
              - array
              - "null"
            items:
              type:
                - object
                - "null"
              properties:
                id:
                  type:
                    - string
                    - "null"
                name:
                  type:
                    - string
                    - "null"
                standardName:
                  type:
                    - boolean
                    - "null"
                color:
                  type:
                    - string
                    - "null"
                standard:
                  type:
                    - string
                    - "null"
                group:
                  type:
                    - string
                    - "null"
                hidden:
                  type:
                    - string
                    - "null"
          title:
            type:
              - string
              - "null"
  comments_stream:
    $ref: "#/definitions/base_stream"
    name: "comments"
    primary_key: "id"
    $parameters:
      path: "comments"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - object
          - "null"
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          authorId:
            type:
              - string
              - "null"
          text:
            type:
              - string
              - "null"
          taskId:
            type:
              - string
              - "null"
          createdDate:
            type:
              - string
              - "null"
            format: date-time
          updatedDate:
            type:
              - "null"
              - string
            format: date-time
  folders_stream:
    $ref: "#/definitions/base_stream"
    name: "folders"
    primary_key: "id"
    $parameters:
      path: "folders"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - object
          - "null"
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          scope:
            type:
              - string
              - "null"
          createdDate:
            type:
              - "null"
              - string
            format: date-time
          childIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
          space:
            type:
              - boolean
              - "null"
          title:
            type:
              - string
              - "null"
          project:
            type:
              - object
              - "null"
            properties:
              authorId:
                type:
                  - string
                  - "null"
              customStatusId:
                type:
                  - string
                  - "null"
              createdDate:
                type:
                  - "null"
                  - string
                format: date-time
              ownerIds:
                type:
                  - array
                  - "null"
                items:
                  type:
                    - string
                    - "null"
  tasks_stream:
    $ref: "#/definitions/base_stream"
    name: "tasks"
    primary_key: "id"
    $parameters:
      path: "tasks"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - object
          - "null"
        additionalProperties: true
        properties:
          id:
            type:
              - string
              - "null"
          accountId:
            type:
              - string
              - "null"
          title:
            type:
              - string
              - "null"
          status:
            type:
              - string
              - "null"
          importance:
            type:
              - string
              - "null"
          scope:
            type:
              - string
              - "null"
          briefDescription:
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
          customStatusId:
            type:
              - string
              - "null"
          permalink:
            type:
              - string
              - "null"
          priority:
            type:
              - string
              - "null"
          createdDate:
            type:
              - string
              - "null"
            format: date-time
          responsibleIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
          parentIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
          superTaskIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
          authorIds:
            type:
              - array
              - "null"
            items:
              type:
                - string
                - "null"
          customFields:
            type:
              - array
              - "null"
            items:
              type:
                - object
                - "null"
              properties:
                id:
                  type:
                    - string
                    - "null"
                value:
                  type:
                    - string
                    - "null"
          dates:
            type:
              - object
              - "null"
            properties:
              type:
                type:
                  - string
                  - "null"
          updatedDate:
            type: string
            format: date-time
          completedDate:
            type: string
            format: date-time
streams:
  - "#/definitions/customfields_stream"
  - "#/definitions/contacts_stream"
  - "#/definitions/workflows_stream"
  - "#/definitions/comments_stream"
  - "#/definitions/folders_stream"
  - "#/definitions/tasks_stream"

check:
  type: CheckStream
  stream_names:
    - "customfields"
    - "contacts"
    - "folders"
    - "tasks"
    - "workflows"
