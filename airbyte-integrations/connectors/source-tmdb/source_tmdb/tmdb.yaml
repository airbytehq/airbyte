version: "0.1.0"

definitions:
  selector:
    extractor:
      field_pointer: []
  requester:
    url_base: "https://api.themoviedb.org/3/"
    http_method: "GET"
    authenticator:
      type: ApiKeyAuthenticator
      header: "apikey"
      api_token: "{{ config['api_key'] }}"
  retriever:
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: NoPagination
    requester:
      $ref: "*ref(definitions.requester)"
  base_stream:
    retriever:
      $ref: "*ref(definitions.retriever)"

  movies_details_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_details"
      path: "/movie/{{ config['movie_id'] }}?api_key={{ config['api_key'] }}"

  movies_alternative_titles_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_alternative_titles"
      path: "/movie/{{ config['movie_id'] }}/alternative_titles?api_key={{ config['api_key'] }}"

  movies_changes_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_changes"
      path: "/movie/{{ config['movie_id'] }}/changes?api_key={{ config['api_key'] }}"

  movies_credits_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_credits"
      path: "/movie/{{ config['movie_id'] }}/credits?api_key={{ config['api_key'] }}"

  movies_external_ids_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_external_ids"
      path: "/movie/{{ config['movie_id'] }}/external_ids?api_key={{ config['api_key'] }}"

  movies_images_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_images"
      path: "/movie/{{ config['movie_id'] }}/images?api_key={{ config['api_key'] }}"

  movies_keywords_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_keywords"
      path: "/movie/{{ config['movie_id'] }}/keywords?api_key={{ config['api_key'] }}"
  
  movies_lists_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_lists"
      path: "/movie/{{ config['movie_id'] }}/lists?api_key={{ config['api_key'] }}"
      
  movies_recommendations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_recommendations"
      path: "/movie/{{ config['movie_id'] }}/recommendations?api_key={{ config['api_key'] }}"

  movies_releases_dates_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_releases_dates"
      path: "/movie/{{ config['movie_id'] }}/release_dates?api_key={{ config['api_key'] }}"
      
  movies_reviews_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_reviews"
      path: "/movie/{{ config['movie_id'] }}/reviews?api_key={{ config['api_key'] }}"

  movies_similar_movies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_similar_movies"
      path: "/movie/{{ config['movie_id'] }}/similar?api_key={{ config['api_key'] }}"
  
  movies_translations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_translations"
      path: "/movie/{{ config['movie_id'] }}/translations?api_key={{ config['api_key'] }}"

  movies_videos_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_videos"
      path: "/movie/{{ config['movie_id'] }}/videos?api_key={{ config['api_key'] }}"

  movies_watch_providers_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_watch_providers"
      path: "/movie/{{ config['movie_id'] }}/watch/providers?api_key={{ config['api_key'] }}"

  movies_latest_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_latest"
      path: "/movie/latest?api_key={{ config['api_key'] }}"

  movies_now_playing_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_now_playing"
      path: "/movie/now_playing?api_key={{ config['api_key'] }}"

  movies_popular_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_popular"
      path: "/movie/popular?api_key={{ config['api_key'] }}"
      
  movies_top_rated_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_top_rated"
      path: "/movie/top_rated?api_key={{ config['api_key'] }}"

  movies_upcoming_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_upcoming"
      path: "/movie/upcoming?api_key={{ config['api_key'] }}"


streams:
  - "*ref(definitions.movies_details_stream)"
  - "*ref(definitions.movies_alternative_titles_stream)"
  - "*ref(definitions.movies_changes_stream)"
  - "*ref(definitions.movies_credits_stream)"
  - "*ref(definitions.movies_external_ids_stream)"
  - "*ref(definitions.movies_images_stream)"
  - "*ref(definitions.movies_keywords_stream)"
  - "*ref(definitions.movies_latest_stream)"
  - "*ref(definitions.movies_lists_stream)"
  - "*ref(definitions.movies_now_playing_stream)"
  - "*ref(definitions.movies_popular_stream)"
  - "*ref(definitions.movies_recommendations_stream)"
  - "*ref(definitions.movies_releases_dates_stream)"
  - "*ref(definitions.movies_reviews_stream)"
  - "*ref(definitions.movies_similar_movies_stream)"
  - "*ref(definitions.movies_top_rated_stream)"
  - "*ref(definitions.movies_translations_stream)"
  - "*ref(definitions.movies_upcoming_stream)"
  - "*ref(definitions.movies_videos_stream)"
  - "*ref(definitions.movies_watch_providers_stream)"

check:
  stream_names:
    - "movies_details"
    - "movies_alternative_titles"
    - "movies_changes"
    - "movies_credits"
    - "movies_external_ids"
    - "movies_images"
    - "movies_keywords"
    - "movies_latest"
    - "movies_lists"
    - "movies_now_playing"
    - "movies_popular"
    - "movies_recommendations"
    - "movies_releases_dates"
    - "movies_reviews"
    - "movies_similar_movies"
    - "movies_top_rated"
    - "movies_translations"
    - "movies_upcoming"
    - "movies_videos"
    - "movies_watch_providers"
