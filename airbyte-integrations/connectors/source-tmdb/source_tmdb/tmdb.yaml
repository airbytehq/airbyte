version: "0.1.0"

definitions:
  selector:
    extractor:
      field_pointer: []
  requester:
    url_base: "https://api.themoviedb.org/3/"
    http_method: "GET"
    authenticator:
      type: ApiKeyAuthenticator
      header: "apikey"
      api_token: "{{ config['api_key'] }}"
  retriever:
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: NoPagination
    requester:
      $ref: "*ref(definitions.requester)"
  base_stream:
    schema_loader:
      type: JsonSchema
      file_path: "./source_tmdb/schemas/{{ options['name'] }}.json"
    retriever:
      $ref: "*ref(definitions.retriever)"

  certification_movie_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "certification_movie"
      path: "/certification/movie/list?api_key={{ config['api_key'] }}"

  certification_tv_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "certification_tv"
      path: "/certification/tv/list?api_key={{ config['api_key'] }}"

  changes_movie_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "changes_movie"
      path: "/movie/changes?api_key={{ config['api_key'] }}&page=1"

  changes_tv_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "changes_tv"
      path: "/tv/changes?api_key={{ config['api_key'] }}&page=1"

  changes_person_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "changes_person"
      path: "/person/changes?api_key={{ config['api_key'] }}&page=1"

  movies_details_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_details"
      path: "/movie/{{ config['movie_id'] or '550' }}?api_key={{ config['api_key'] }}"

  movies_alternative_titles_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_alternative_titles"
      path: "/movie/{{ config['movie_id'] or '550' }}/alternative_titles?api_key={{ config['api_key'] }}"

  movies_changes_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_changes"
      path: "/movie/{{ config['movie_id'] or '550' }}/changes?api_key={{ config['api_key'] }}"

  movies_credits_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_credits"
      path: "/movie/{{ config['movie_id'] or '550' }}/credits?api_key={{ config['api_key'] }}"

  movies_external_ids_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_external_ids"
      path: "/movie/{{ config['movie_id'] or '550' }}/external_ids?api_key={{ config['api_key'] }}"

  movies_images_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_images"
      path: "/movie/{{ config['movie_id'] or '550' }}/images?api_key={{ config['api_key'] }}"

  movies_keywords_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_keywords"
      path: "/movie/{{ config['movie_id'] or '550' }}/keywords?api_key={{ config['api_key'] }}"
  
  movies_lists_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_lists"
      path: "/movie/{{ config['movie_id'] or '550' }}/lists?api_key={{ config['api_key'] }}"
      
  movies_recommendations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_recommendations"
      path: "/movie/{{ config['movie_id'] or '550' }}/recommendations?api_key={{ config['api_key'] }}"

  movies_releases_dates_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_releases_dates"
      path: "/movie/{{ config['movie_id'] or '550' }}/release_dates?api_key={{ config['api_key'] }}"
      
  movies_reviews_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_reviews"
      path: "/movie/{{ config['movie_id'] or '550' }}/reviews?api_key={{ config['api_key'] }}"

  movies_similar_movies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_similar_movies"
      path: "/movie/{{ config['movie_id'] or '550' }}/similar?api_key={{ config['api_key'] }}"
  
  movies_translations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_translations"
      path: "/movie/{{ config['movie_id'] or '550' }}/translations?api_key={{ config['api_key'] }}"

  movies_videos_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_videos"
      path: "/movie/{{ config['movie_id'] or '550' }}/videos?api_key={{ config['api_key'] }}"

  movies_watch_providers_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_watch_providers"
      path: "/movie/{{ config['movie_id'] or '550' }}/watch/providers?api_key={{ config['api_key'] }}"

  movies_latest_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_latest"
      path: "/movie/latest?api_key={{ config['api_key'] }}"

  movies_now_playing_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_now_playing"
      path: "/movie/now_playing?api_key={{ config['api_key'] }}"

  movies_popular_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_popular"
      path: "/movie/popular?api_key={{ config['api_key'] }}"
      
  movies_top_rated_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_top_rated"
      path: "/movie/top_rated?api_key={{ config['api_key'] }}"

  movies_upcoming_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_upcoming"
      path: "/movie/upcoming?api_key={{ config['api_key'] }}"

  trending_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "trending"
      path: "/trending/all/day?api_key={{ config['api_key'] }}"

  search_companies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_companies"
      path: "/search/company?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&page=1"

  search_collections_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_collections"
      path: "/search/collection?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&language={{ config['language'] or 'en-US' }}&page=1"

  search_keywords_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_keywords"
      path: "/search/keyword?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&page=1"

  search_movies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_movies"
      path: "/search/movie?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&language={{ config['language'] or 'en-US' }}&page=1&include_adult=false"

  search_multi_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_multi"
      path: "/search/multi?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&language={{ config['language'] or 'en-US' }}&page=1&include_adult=false"

  search_people_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_people"
      path: "/search/person?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&language={{ config['language'] or 'en-US' }}&page=1&include_adult=false"

  search_tv_shows_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_tv_shows"
      path: "/search/tv?query={{ config['api_key'] or 'Marvel'}}&api_key={{ config['api_key'] }}&language={{ config['language'] or 'en-US' }}&page=1&include_adult=false"


streams:
  - "*ref(definitions.certification_movie_stream)"
  - "*ref(definitions.certification_tv_stream)"
  - "*ref(definitions.changes_movie_stream)"
  - "*ref(definitions.changes_tv_stream)"
  - "*ref(definitions.changes_person_stream)"
  - "*ref(definitions.movies_details_stream)"
  - "*ref(definitions.movies_alternative_titles_stream)"
  - "*ref(definitions.movies_changes_stream)"
  - "*ref(definitions.movies_credits_stream)"
  - "*ref(definitions.movies_external_ids_stream)"
  - "*ref(definitions.movies_images_stream)"
  - "*ref(definitions.movies_keywords_stream)"
  - "*ref(definitions.movies_latest_stream)"
  - "*ref(definitions.movies_lists_stream)"
  - "*ref(definitions.movies_now_playing_stream)"
  - "*ref(definitions.movies_popular_stream)"
  - "*ref(definitions.movies_recommendations_stream)"
  - "*ref(definitions.movies_releases_dates_stream)"
  - "*ref(definitions.movies_reviews_stream)"
  - "*ref(definitions.movies_similar_movies_stream)"
  - "*ref(definitions.movies_top_rated_stream)"
  - "*ref(definitions.movies_translations_stream)"
  - "*ref(definitions.movies_upcoming_stream)"
  - "*ref(definitions.movies_videos_stream)"
  - "*ref(definitions.movies_watch_providers_stream)"
  - "*ref(definitions.trending_stream)"
  - "*ref(definitions.search_collections_stream)"
  - "*ref(definitions.search_companies_stream)"
  - "*ref(definitions.search_keywords_stream)"
  - "*ref(definitions.search_movies_stream)"
  - "*ref(definitions.search_multi_stream)"
  - "*ref(definitions.search_people_stream)"
  - "*ref(definitions.search_tv_shows_stream)"

check:
  stream_names:
    - "certification_movie"
    - "certification_tv"
    - "changes_movie"
    - "changes_tv"
    - "changes_person"
    - "movies_details"
    - "movies_alternative_titles"
    - "movies_changes"
    - "movies_credits"
    - "movies_external_ids"
    - "movies_images"
    - "movies_keywords"
    - "movies_latest"
    - "movies_lists"
    - "movies_now_playing"
    - "movies_popular"
    - "movies_recommendations"
    - "movies_releases_dates"
    - "movies_reviews"
    - "movies_similar_movies"
    - "movies_top_rated"
    - "movies_translations"
    - "movies_upcoming"
    - "movies_videos"
    - "movies_watch_providers"
    - "trending"
    - "search_collections"
    - "search_companies"
    - "search_keywords"
    - "search_movies"
    - "search_multi"
    - "search_people"
    - "search_tv_shows"
