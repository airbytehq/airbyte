version: "0.1.0"

definitions:
  selector:
    extractor:
      field_pointer: []
  requester:
    url_base: "https://api.themoviedb.org/3/"
    http_method: "GET"
    request_options_provider:
      request_parameters:
        api_key: "{{ config['api_key'] }}"
  retriever:
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: NoPagination
    requester:
      $ref: "*ref(definitions.requester)"
  base_stream:
    schema_loader:
      type: JsonSchema
      file_path: "./source_tmdb/schemas/{{ options['name'] }}.json"
    retriever:
      $ref: "*ref(definitions.retriever)"

  certification_movie_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "certification_movie"
      path: "/certification/movie/list"

  certification_tv_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "certification_tv"
      path: "/certification/tv/list"

  changes_movie_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "changes_movie"
      path: "/movie/changes?page=1"

  changes_tv_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "changes_tv"
      path: "/tv/changes?page=1"

  changes_person_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "changes_person"
      path: "/person/changes?page=1"

  movies_details_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_details"
      path: "/movie/{{ config['movie_id'] }}"

  movies_alternative_titles_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_alternative_titles"
      path: "/movie/{{ config['movie_id'] }}/alternative_titles"

  movies_changes_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_changes"
      path: "/movie/{{ config['movie_id'] }}/changes"

  movies_credits_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_credits"
      path: "/movie/{{ config['movie_id'] }}/credits"

  movies_external_ids_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_external_ids"
      path: "/movie/{{ config['movie_id'] }}/external_ids"

  movies_images_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_images"
      path: "/movie/{{ config['movie_id'] }}/images"

  movies_keywords_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_keywords"
      path: "/movie/{{ config['movie_id'] }}/keywords"
  
  movies_lists_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_lists"
      path: "/movie/{{ config['movie_id'] }}/lists"
      
  movies_recommendations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_recommendations"
      path: "/movie/{{ config['movie_id'] }}/recommendations"

  movies_releases_dates_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_releases_dates"
      path: "/movie/{{ config['movie_id'] }}/release_dates"
      
  movies_reviews_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_reviews"
      path: "/movie/{{ config['movie_id'] }}/reviews"

  movies_similar_movies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_similar_movies"
      path: "/movie/{{ config['movie_id'] }}/similar"
  
  movies_translations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_translations"
      path: "/movie/{{ config['movie_id'] }}/translations"

  movies_videos_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_videos"
      path: "/movie/{{ config['movie_id'] }}/videos"

  movies_watch_providers_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_watch_providers"
      path: "/movie/{{ config['movie_id'] }}/watch/providers"

  movies_latest_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_latest"
      path: "/movie/latest"

  movies_now_playing_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_now_playing"
      path: "/movie/now_playing"

  movies_popular_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_popular"
      path: "/movie/popular"
      
  movies_top_rated_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_top_rated"
      path: "/movie/top_rated"

  movies_upcoming_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "movies_upcoming"
      path: "/movie/upcoming"

  trending_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "trending"
      path: "/trending/all/day"

  search_companies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_companies"
      path: "/search/company?query={{ config['query'] }}"

  search_collections_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_collections"
      path: "/search/collection?query={{ config['query'] }}&language={{ config['language'] or 'en-US' }}"

  search_keywords_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_keywords"
      path: "/search/keyword?query={{ config['query'] }}"

  search_movies_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_movies"
      path: "/search/movie?query={{ config['query'] }}&language={{ config['language'] or 'en-US' }}&include_adult=false"

  search_multi_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_multi"
      path: "/search/multi?query={{ config['query'] }}&language={{ config['language'] or 'en-US' }}&include_adult=false"

  search_people_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_people"
      path: "/search/person?query={{ config['query'] }}&language={{ config['language'] or 'en-US' }}&include_adult=false"

  search_tv_shows_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "search_tv_shows"
      path: "/search/tv?query={{ config['query'] }}&language={{ config['language'] or 'en-US' }}&include_adult=false"


streams:
  - "*ref(definitions.certification_movie_stream)"
  - "*ref(definitions.certification_tv_stream)"
  - "*ref(definitions.changes_movie_stream)"
  - "*ref(definitions.changes_tv_stream)"
  - "*ref(definitions.changes_person_stream)"
  - "*ref(definitions.movies_details_stream)"
  - "*ref(definitions.movies_alternative_titles_stream)"
  - "*ref(definitions.movies_changes_stream)"
  - "*ref(definitions.movies_credits_stream)"
  - "*ref(definitions.movies_external_ids_stream)"
  - "*ref(definitions.movies_images_stream)"
  - "*ref(definitions.movies_keywords_stream)"
  - "*ref(definitions.movies_latest_stream)"
  - "*ref(definitions.movies_lists_stream)"
  - "*ref(definitions.movies_now_playing_stream)"
  - "*ref(definitions.movies_popular_stream)"
  - "*ref(definitions.movies_recommendations_stream)"
  - "*ref(definitions.movies_releases_dates_stream)"
  - "*ref(definitions.movies_reviews_stream)"
  - "*ref(definitions.movies_similar_movies_stream)"
  - "*ref(definitions.movies_top_rated_stream)"
  - "*ref(definitions.movies_translations_stream)"
  - "*ref(definitions.movies_upcoming_stream)"
  - "*ref(definitions.movies_videos_stream)"
  - "*ref(definitions.movies_watch_providers_stream)"
  - "*ref(definitions.trending_stream)"
  - "*ref(definitions.search_collections_stream)"
  - "*ref(definitions.search_companies_stream)"
  - "*ref(definitions.search_keywords_stream)"
  - "*ref(definitions.search_movies_stream)"
  - "*ref(definitions.search_multi_stream)"
  - "*ref(definitions.search_people_stream)"
  - "*ref(definitions.search_tv_shows_stream)"

check:
  stream_names:
    - "certification_movie"
    - "certification_tv"
    - "changes_movie"
    - "changes_tv"
    - "changes_person"
    - "movies_details"
    - "movies_alternative_titles"
    - "movies_changes"
    - "movies_credits"
    - "movies_external_ids"
    - "movies_images"
    - "movies_keywords"
    - "movies_latest"
    - "movies_lists"
    - "movies_now_playing"
    - "movies_popular"
    - "movies_recommendations"
    - "movies_releases_dates"
    - "movies_reviews"
    - "movies_similar_movies"
    - "movies_top_rated"
    - "movies_translations"
    - "movies_upcoming"
    - "movies_videos"
    - "movies_watch_providers"
    - "trending"
    - "search_collections"
    - "search_companies"
    - "search_keywords"
    - "search_movies"
    - "search_multi"
    - "search_people"
    - "search_tv_shows"
