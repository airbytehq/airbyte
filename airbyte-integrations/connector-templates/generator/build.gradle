plugins {
    id "base"
    id "com.github.node-gradle.node" version "2.2.4"
}

node {
    download = true
    version = "14.11.0"
}

assemble.dependsOn(npmInstall)

def addScaffoldTask(name) {
    def taskName = "generate_${name}"
    def outputDir = "airbyte-integrations/connectors/source-scaffold-${name}"

    def task = tasks.create(taskName) {
        inputs.files rootProject.fileTree("airbyte-integrations/connector-templates/${name}")

        exec {
            workingDir rootDir
            commandLine 'rm', '-rf', outputDir
        }
        exec {
            workingDir rootDir
            commandLine './tools/integrations/manage.sh', 'scaffold', name, "scaffold-${name}"
        }

        outputs.dir rootProject.file(outputDir)

    }

    project(":${outputDir.replace('/', ':')}") {
        build.dependsOn task
    }
}

addScaffoldTask('source-python')
addScaffoldTask('source-python-singer')
