plugins {
    id "base"
    id "com.github.node-gradle.node" version "2.2.4"
}

node {
    download = true
    version = "14.11.0"
}

assemble.dependsOn(npmInstall)

task generateSourcePythonScaffold {
    def outputDir = 'airbyte-integrations/connectors/source-scaffold-source-python'

    inputs.files rootProject.fileTree('airbyte-integrations/connector-templates/source-python')

    doLast {
        exec {
            workingDir rootDir
            commandLine 'rm', '-rf', outputDir
        }
        exec {
            workingDir rootDir
            commandLine './tools/integrations/manage.sh', 'scaffold', 'source-python', 'scaffold-source-python'
        }
    }

    outputs.dir rootProject.file(outputDir)
}

project(":airbyte-integrations:connectors:source-scaffold-source-python") {
    build.dependsOn generateSourcePythonScaffold
}
