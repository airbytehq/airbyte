plugins {
    id "base"
    id "com.github.node-gradle.node" version "2.2.4"
}

node {
    download = true
    version = "14.11.0"
}

assemble.dependsOn(npmInstall)

task generateSourcePythonScaffold {
    def name = 'source-python'

    def outputDir = "airbyte-integrations/connectors/source-scaffold-${name}"

    project(":${outputDir.replace('/', ':')}") {
        build.dependsOn generateSourcePythonScaffold
    }

    inputs.files rootProject.fileTree("airbyte-integrations/connector-templates/${name}")

    // Ensures it runs during the configuration phase
    exec {
        workingDir rootDir
        commandLine 'rm', '-rf', outputDir
    }
    exec {
        workingDir rootDir
        commandLine './tools/integrations/manage.sh', 'scaffold', name, "scaffold-${name}"
    }

    outputs.dir rootProject.file(outputDir)
}

