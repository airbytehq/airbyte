apiVersion: v1
kind: Pod
metadata:
  name: NAME
spec:
  restartPolicy: Never
  initContainers:
    - name: init
      image: busybox:1.28
      command: ["sh", "-c", "mkfifo /pipes/stdout"]
      volumeMounts:
        - name: airbyte-pipes
          mountPath: /pipes
  containers:
    - name: main
      image: IMAGE
      # imagePullPolicy: Always  -> prevents local images from working
      command: ["sh", "-c", "ENTRYPOINT > /pipes/stdout"]
      volumeMounts:
        - name: airbyte-pipes
          mountPath: /pipes
    - name: relay-stdout
      image: alpine/socat:1.7.4.1-r1
      command: [
          "sh",
          "-c",
          "cat /pipes/stdout | socat -d -d -d - TCP:WORKER_IP:STDOUT_PORT",
      ]
      volumeMounts:
        - name: airbyte-pipes
          mountPath: /pipes
  volumes:
    - name: airbyte-pipes
      emptyDir: {}
